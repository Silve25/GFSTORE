<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GF Store ‚Äî Accueil</title>
  <meta name="description" content="GF Store ‚Äî √âlectronique premium. Livraison 24‚Äë48h, assistance 24/7, paiement s√©curis√©." />

  <style>
    :root{
      --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --text:#0f172a; --accent:#0ea5a4; --danger:#ef4444;
      --glass: rgba(255,255,255,0.6); --shadow: 0 10px 30px rgba(15,23,42,0.10);
    }
    [data-theme="dark"]{
      --bg:#071026; --card:#071827; --muted:#9aa4b2; --text:#e6eef7; --accent:#34d399; --danger:#f87171;
      --glass: rgba(255,255,255,0.03); --shadow: 0 14px 40px rgba(0,0,0,0.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:linear-gradient(180deg,var(--bg), #e9eef6 160%); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* Topbar */
    .topbar{display:flex;align-items:center;justify-content:space-between;padding:18px 28px;backdrop-filter: blur(8px);background:var(--glass);box-shadow:var(--shadow);position:sticky;top:0;z-index:50}
    .brand{display:flex;gap:12px;align-items:center}
    .brand .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
    .search{flex:1;margin:0 20px}
    .search input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:var(--text)}
    .actions{display:flex;gap:12px;align-items:center}
    .btn{padding:10px 14px;border-radius:12px;border:0;background:var(--card);box-shadow:var(--shadow);cursor:pointer}
    .icon-btn{display:inline-flex;align-items:center;gap:8px}

    /* Hero */
    .hero{display:grid;grid-template-columns:1fr 420px;gap:24px;padding:32px}
    .hero-card{background:var(--card);padding:22px;border-radius:16px;box-shadow:var(--shadow)}
    .promo{display:flex;gap:12px;align-items:center}
    .promo .badge{background:linear-gradient(90deg,#ff7a59,#ffb86b);color:#fff;padding:6px 10px;border-radius:10px;font-weight:800}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:18px;padding:20px}
    .product{background:var(--card);padding:12px;border-radius:14px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:12px;transition:transform .18s ease, box-shadow .18s ease}
    .product:hover{transform:translateY(-2px)}
    .product img{width:100%;height:170px;object-fit:contain;border-radius:10px;background:linear-gradient(180deg, rgba(0,0,0,0.03), rgba(0,0,0,0.01))}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .title{font-weight:700}
    .price{font-size:1.06rem;font-weight:800}
    .old{color:var(--muted);text-decoration:line-through;font-size:0.9rem;margin-left:8px}
    .badges{display:flex;gap:6px;flex-wrap:wrap}
    .badge-small{background:rgba(14,165,164,0.12);color:var(--accent);padding:6px;border-radius:8px;font-weight:700;font-size:0.8rem}

    .cta{display:flex;gap:8px}
    .add{flex:1;padding:10px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#06b6d4);color:white;border:0;cursor:pointer}
    .info{padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:transparent;cursor:pointer}

    /* Mini cart */
    .minicart{position:fixed;right:18px;bottom:18px;background:var(--card);padding:12px;border-radius:14px;box-shadow:var(--shadow);width:340px;max-height:70vh;overflow:auto}
    .minicart h4{margin:0 0 10px 0}
    .cart-item{display:flex;gap:10px;align-items:center;padding:8px 0;border-bottom:1px dashed rgba(0,0,0,0.06)}
    .cart-item img{width:48px;height:48px;object-fit:contain}

    /* Footer */
    footer{padding:18px 28px;color:var(--muted);font-size:0.95rem}

    /* Modal (product quick view) */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:20px}
    .modal.open{display:flex}
    .modal-card{background:var(--card);max-width:920px;width:100%;border-radius:16px;box-shadow:var(--shadow);padding:16px}
    .modal-body{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .thumbs{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px}
    .thumbs img{width:100%;height:70px;object-fit:contain;border:1px solid rgba(0,0,0,.06);border-radius:8px;cursor:pointer}

    /* Skeleton */
    .skeleton{background:linear-gradient(90deg, rgba(0,0,0,0.06), rgba(0,0,0,0.02), rgba(0,0,0,0.06));background-size:200% 100%;animation:shimmer 1.2s infinite;}
    @keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}

    /* Responsive */
    @media (max-width:900px){.hero{grid-template-columns:1fr;}.topbar{flex-wrap:wrap}.search{order:3;width:100%;margin:10px 0}.modal-body{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="logo">GF</div>
      <div>
        <div style="font-weight:800">GF Store</div>
        <div style="font-size:12px;color:var(--muted)">√âlectronique premium ‚Äî Livraison 24‚Äë48h</div>
      </div>
    </div>

    <div class="search">
      <input id="searchInput" placeholder="Rechercher : iPhone, AirPods, PC‚Ä¶" />
    </div>

    <div class="actions">
      <button class="btn icon-btn" id="themeToggle" title="Basculer th√®me">üåô / ‚òÄÔ∏è</button>
      <button class="btn icon-btn" id="accountBtn">Compte</button>
      <button class="btn icon-btn" id="cartBtn">Panier (<span id="cartCount">0</span>)</button>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="hero-card">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:16px;flex-wrap:wrap">
          <div style="min-width:260px">
            <h1 style="margin:0">GF Store ‚Äî Boutique high‚Äëtech</h1>
            <p style="margin:6px 0;color:var(--muted)">Produits premium. Assistance 24/7. Paiement s√©curis√©. Garantie 1 an min.</p>

            <div class="promo" style="margin-top:12px">
              <div class="badge">Offre flash -20%</div>
              <div id="flashTimer" style="font-weight:800;color:var(--danger)">Chargement‚Ä¶</div>
            </div>

            <div style="margin-top:14px">
              <button class="btn" id="openCatalog">Voir le catalogue</button>
              <button class="btn" id="openBundles">Bundles</button>
            </div>
          </div>

          <aside style="width:340px;min-width:260px">
            <div style="background:linear-gradient(180deg,#fff,#f1f7fb);padding:14px;border-radius:12px">
              <h3 style="margin:0">Livraison rapide</h3>
              <p style="margin:6px 0;color:var(--muted)">24‚Äë48h sur la majorit√© des produits.</p>
              <ul style="margin:0;padding-left:18px;color:var(--muted)">
                <li>Assistance 24/7</li>
                <li>Paiement 100% s√©curis√©</li>
                <li>Garantie l√©gale respect√©e</li>
              </ul>
            </div>
          </aside>
        </div>
      </div>

      <div class="hero-card">
        <h3>Top ventes</h3>
        <div id="topList" style="display:grid;gap:10px;margin-top:10px"></div>
      </div>
    </section>

    <section style="padding:12px 20px">
      <h2 style="margin:8px 0">Nos produits</h2>
      <div class="grid" id="productsGrid">
        <!-- skeletons -->
        <article class="product skeleton" style="height:270px"></article>
        <article class="product skeleton" style="height:270px"></article>
        <article class="product skeleton" style="height:270px"></article>
        <article class="product skeleton" style="height:270px"></article>
      </div>
      <div id="sourceNote" style="margin:10px 20px;color:var(--muted);font-size:12px"></div>
    </section>
  </main>

  <div id="minicart" class="minicart" hidden>
    <h4>Panier</h4>
    <div id="cartItems"></div>
    <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
      <div><strong>Total:</strong> <span id="cartTotal">0 ‚Ç¨</span></div>
      <div>
        <button class="btn" id="goCheckout">Commander</button>
      </div>
    </div>
  </div>

  <!-- Quick view modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-card">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
        <h3 id="modalTitle" style="margin:0"></h3>
        <button class="btn" id="modalClose">Fermer</button>
      </div>
      <div class="modal-body">
        <div>
          <img id="modalImage" src="" alt="" style="width:100%;height:300px;object-fit:contain;border-radius:10px" />
          <div id="modalThumbs" class="thumbs"></div>
        </div>
        <div>
          <div id="modalPrice" class="price"></div>
          <p id="modalDesc" style="color:var(--muted)"></p>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="add" id="modalAdd">Ajouter au panier</button>
            <button class="info" id="modalInfo">D√©tails</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    ¬© GF Store ‚Äî Tous droits r√©serv√©s ‚Ä¢ Paiement s√©curis√© ‚Ä¢ Assistance 24/7
  </footer>

  <script>
    /*********************** Configuration ************************/
    // IMPORTANT : ce loader est volontairement robuste. Il reprend l'id√©e du script "qui marche".
    const CANDIDATES = [
      './produits.json', './products.json', './products.cleaned.json',
      './data/produits.json', './data/products.json', './data/products.cleaned.json',
      '/GFSTORE/produits.json', '/GFSTORE/data/produits.json', '/GFSTORE/data/products.json'
    ];

    const FLASH_HOURS = 24;

    /*********************** Utilitaires **************************/
    const $ = sel => document.querySelector(sel);
    const $all = sel => Array.from(document.querySelectorAll(sel));
    const fmt = val => (typeof val === 'number' ? val.toFixed(2).replace('.',',') + ' ‚Ç¨' : (val||''));

    const PLACEHOLDER = 'https://via.placeholder.com/600x400?text=GF+Store';
    const firstImage = (p) => p?.imageCover || (Array.isArray(p?.images) && p.images[0]) || p?.image || PLACEHOLDER;

    function safeImg(img){
      img.loading = 'lazy';
      img.decoding = 'async';
      img.referrerPolicy = 'no-referrer';
      img.onerror = () => { img.onerror = null; img.src = PLACEHOLDER; };
    }

    /*********************** Th√®me ********************************/
    const themeToggle = document.getElementById('themeToggle');
    const userTheme = localStorage.getItem('gf_theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light');
    document.documentElement.setAttribute('data-theme', userTheme === 'dark' ? 'dark' : 'light');
    themeToggle.addEventListener('click', ()=>{
      const cur = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', cur);
      localStorage.setItem('gf_theme', cur);
    });

    /*********************** Panier ********************************/
    const CART_KEY = 'gf_cart_v1';
    const loadCart = ()=>{ try{ return JSON.parse(localStorage.getItem(CART_KEY) || '[]') }catch(e){return []} };
    const saveCart = (c)=>{ localStorage.setItem(CART_KEY, JSON.stringify(c)); renderCartCount(); };
    function addToCart(id, p){ const cart = loadCart(); const it = cart.find(i=>i.id===id); if(it){ it.qty++; } else { cart.push({id, title:p.name, price:p.price, image:firstImage(p), qty:1}); } saveCart(cart); openMiniCart(); }
    function renderCartCount(){ const cart = loadCart(); const total = cart.reduce((s,i)=>s+i.qty,0); $('#cartCount').textContent = total; }
    function renderMiniCart(){ const items = loadCart(); const ctn = $('#cartItems'); ctn.innerHTML=''; if(items.length===0){ ctn.innerHTML='<div style="color:var(--muted)">Votre panier est vide.</div>'; $('#cartTotal').textContent = '0 ‚Ç¨'; return; }
      let total = 0; items.forEach(it=>{ total += it.price * it.qty; const d = document.createElement('div'); d.className='cart-item'; d.innerHTML = `
        <img src="${it.image}" alt="" />
        <div style="flex:1"><div style="font-weight:700">${it.title}</div><div style="font-size:.9rem;color:var(--muted)">${it.qty} x ${fmt(it.price)}</div></div>
        <div style="display:flex;flex-direction:column;gap:6px"><button class="info" onclick="window.__gf_changeQty('${it.id}',1)">+</button><button class="info" onclick="window.__gf_changeQty('${it.id}',-1)">-</button></div>`; ctn.appendChild(d); });
      $('#cartTotal').textContent = fmt(total);
    }
    window.__gf_changeQty = (id,delta)=>{ const cart = loadCart(); const i = cart.findIndex(x=>x.id===id); if(i===-1) return; cart[i].qty += delta; if(cart[i].qty<=0) cart.splice(i,1); saveCart(cart); renderMiniCart(); };
    function openMiniCart(){ $('#minicart').hidden=false; renderMiniCart(); }
    $('#cartBtn').addEventListener('click', openMiniCart);
    $('#goCheckout').addEventListener('click', ()=>alert('Page checkout non impl√©ment√©e dans ce fichier.'));
    renderCartCount();

    /*********************** Produits ******************************/
    let PRODUCTS = [];

    async function tryFetch(url){
      try{
        const r = await fetch(url, {cache:'no-store'});
        if(!r.ok) throw new Error('HTTP '+r.status);
        const data = await r.json();
        if(Array.isArray(data)) return data; if(Array.isArray(data.products)) return data.products; return null;
      }catch(e){ return null }
    }

    async function loadProducts(){
      let used = null; let data = null;
      for(const u of CANDIDATES){ data = await tryFetch(u); if(data){ used = u; break; } }
      if(!data){
        console.warn('Aucun produits.json trouv√© ‚Äî fallback d√©mo.');
        PRODUCTS = [
          {id:'demo-1', name:'AirPods (d√©mo)', category:'Audio', price:199, stock:8, images:[PLACEHOLDER]},
          {id:'demo-2', name:'iPhone (d√©mo)', category:'Smartphones', price:999, oldPrice:1099, stock:2, images:[PLACEHOLDER]},
          {id:'demo-3', name:'MacBook (d√©mo)', category:'Informatique', price:2499, stock:4, images:[PLACEHOLDER]},
        ];
        $('#sourceNote').textContent = '‚ö†Ô∏è Placez "produits.json" pr√®s de index.html (ou dans ./data).';
        return;
      }
      PRODUCTS = data.map((p,idx)=>({
        // Normalisation minimale sans d√©naturer les donn√©es d‚Äôorigine
        id: p.id || p.slug || 'p-'+idx,
        name: p.name || p.title || 'Produit',
        price: p.price ?? p.prix ?? 0,
        oldPrice: p.oldPrice || p.compareAtPrice || null,
        category: p.category || p.categorie || '',
        imageCover: p.imageCover || undefined,
        images: Array.isArray(p.images) ? p.images : (p.image ? [p.image] : []),
        description: p.description || '' ,
        rating: p.rating || p.note || null,
        stock: p.stock ?? p.quantity ?? null,
        _raw:p
      }));
      $('#sourceNote').textContent = 'Charg√© depuis : ' + used + ' ‚Äî Images: imageCover ou premi√®re image disponible.';
    }

    function productCard(p){
      const el = document.createElement('article'); el.className='product';
      const imgSrc = firstImage(p);
      el.innerHTML = `
        <img src="${imgSrc}" alt="${p.name}" />
        <div class="meta"><div class="title">${p.name}</div><div class="price">${fmt(p.price)}${p.oldPrice?'<span class="old">'+fmt(p.oldPrice)+'</span>':''}</div></div>
        <div style="color:var(--muted);font-size:.9rem">${p.category||''}</div>
        <div class="badges">${ p.stock!=null && p.stock<=5 ? '<div class="badge-small">Stock: '+p.stock+'</div>' : '' }</div>
        <div class="cta" style="margin-top:auto">
          <button class="info" data-view>Voir</button>
          <button class="add" data-add>Ajouter</button>
        </div>`;
      const img = el.querySelector('img'); safeImg(img);
      el.querySelector('[data-add]').addEventListener('click', ()=> addToCart(p.id, p));
      el.querySelector('[data-view]').addEventListener('click', ()=> openQuickView(p));
      return el;
    }

    function renderProducts(list){ const grid = $('#productsGrid'); grid.innerHTML=''; list.forEach(p=> grid.appendChild(productCard(p))); }

    function renderTop(){ const top = PRODUCTS.slice(0,4); const container = $('#topList'); container.innerHTML=''; top.forEach(t=>{
      const wrap = document.createElement('div'); wrap.style.display='flex'; wrap.style.alignItems='center'; wrap.style.gap='10px';
      const img = document.createElement('img'); img.src = firstImage(t); img.style.width='64px'; img.style.height='64px'; img.style.objectFit='contain'; img.style.borderRadius='8px'; safeImg(img);
      wrap.appendChild(img); const meta = document.createElement('div'); meta.innerHTML = `<div style="font-weight:800">${t.name}</div><div style="color:var(--muted)">${fmt(t.price)}</div>`; wrap.appendChild(meta); container.appendChild(wrap);
    }); }

    // Recherche
    $('#searchInput').addEventListener('input', (e)=>{ const q = e.target.value.trim().toLowerCase(); if(!q){ renderProducts(PRODUCTS); return; } const filtered = PRODUCTS.filter(p=> (p.name||'').toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q)); renderProducts(filtered); });

    /*********************** Quick View ***************************/
    function openQuickView(p){
      $('#modalTitle').textContent = p.name;
      $('#modalDesc').textContent = p.description || '';
      $('#modalPrice').textContent = fmt(p.price) + (p.oldPrice? ' ' + '('+fmt(p.oldPrice)+')':'' );
      const main = $('#modalImage'); main.src = firstImage(p); safeImg(main);
      const thumbs = $('#modalThumbs'); thumbs.innerHTML=''; (p.images||[]).forEach(u=>{ const im = document.createElement('img'); im.src = u; safeImg(im); im.addEventListener('click', ()=>{ main.src = u; }); thumbs.appendChild(im); });
      $('#modalAdd').onclick = ()=> addToCart(p.id, p);
      $('#modalInfo').onclick = ()=> alert(p.name + "\n\n" + (p.description||'Aucune description disponible.'));
      $('#modal').classList.add('open'); $('#modal').setAttribute('aria-hidden','false');
    }
    $('#modalClose').addEventListener('click', ()=>{ $('#modal').classList.remove('open'); $('#modal').setAttribute('aria-hidden','true'); });
    $('#modal').addEventListener('click', (e)=>{ if(e.target.id==='modal') $('#modalClose').click(); });

    /*********************** Flash timer **************************/
    function initFlash(){
      const key = 'gf_flash_end'; let end = localStorage.getItem(key);
      if(!end){ end = Date.now() + FLASH_HOURS*3600*1000; localStorage.setItem(key, end); }
      function tick(){ const remaining = parseInt(end) - Date.now(); if(remaining<=0){ $('#flashTimer').textContent = 'Offre termin√©e'; return; } const h = Math.floor(remaining/3600000); const m = Math.floor((remaining%3600000)/60000); const s = Math.floor((remaining%60000)/1000); $('#flashTimer').textContent = `-${20}% ‚Ä¢ ${h}h ${m}m ${s}s`; }
      tick(); setInterval(tick,1000);
    }

    /*********************** Boot ********************************/
    (async function(){
      await loadProducts();
      renderProducts(PRODUCTS);
      renderTop();
      initFlash();
      // scroll to grid
      document.getElementById('openCatalog').addEventListener('click', ()=> document.getElementById('productsGrid').scrollIntoView({behavior:'smooth'}));
    })();
  </script>
</body>
</html>

