<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paiement — GF Store</title>
  <meta name="description" content="Paiement sécurisé GF Store. Crypto et Virement disponibles. Carte & PayPal temporairement en maintenance.">
  <style>
    :root{
      --w:1200px; --c:#0f172a; --muted:#6b7280; --a:#2563eb; --ok:#16a34a; --warn:#b45309; --line:#e5e7eb; --bg:#f5f7fb; --card:#fff;
      --r:14px; --shadow:0 6px 18px rgba(15,23,42,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--c);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    a{color:inherit;text-decoration:none}

    header{position:sticky;top:0;z-index:30;background:#fff;border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(4px)}
    .hwrap{max-width:var(--w);margin:auto;padding:10px 12px;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand .logo{height:34px;width:auto;display:block}
    .nav{display:flex;gap:8px;align-items:center}
    .nav a,.iconbtn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--line);background:#fff;border-radius:12px;box-shadow:0 1px 0 rgba(0,0,0,.02)}
    .iconbtn{cursor:pointer}
    .ic{width:16px;height:16px;display:inline-block}

    .wrap{max-width:var(--w);margin:12px auto 24px;padding:0 12px}
    .grid{display:grid;gap:14px}
    @media(min-width:980px){.grid{grid-template-columns:1.1fr .9fr}}

    .card{background:var(--card);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}
    .card .hd{padding:14px 16px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
    .card .bd{padding:14px 16px}
    .title{font-weight:800}
    .muted{color:var(--muted);font-size:12px}

    .row{display:grid;gap:10px}
    @media(min-width:680px){.row.cols-2{grid-template-columns:1fr 1fr}}
    label{font-weight:600}
    input,select,textarea{width:100%;padding:11px 12px;border:1px solid var(--line);border-radius:12px;background:#fff}
    input:focus,select:focus,textarea:focus{outline:2px solid rgba(37,99,235,.25)}

    .method-list{display:grid;gap:10px}
    @media(min-width:680px){.method-list{grid-template-columns:repeat(4,1fr)}}
    .method{position:relative;border:1px solid var(--line);border-radius:12px;background:#fff;padding:12px;display:flex;flex-direction:column;gap:10px}
    .method[aria-selected="true"]{border-color:var(--a);box-shadow:0 0 0 3px rgba(37,99,235,.12)}
    .m-logos{display:flex;gap:8px;align-items:center;min-height:22px}
    .m-logos img{height:18px}
    .m-foot{margin-top:auto;display:flex;justify-content:space-between;align-items:center;gap:6px}
    .badge{border:1px solid #e8eef9;border-radius:999px;padding:4px 8px;font-size:11px;background:#f7faff;color:#1f2a44}
    .badge.ok{border-color:#c8f3d0;background:#f1fdf4;color:#166534}
    .badge.warn{border-color:#ffe0b3;background:#fff7e6;color:#9a5b00}
    .pick{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer;font-weight:700}
    .pick.primary{background:linear-gradient(180deg,#2563eb,#1e40af);border-color:#1e40af;color:#fff}

    .panel{display:none}
    .panel.show{display:block}

    .subtle{display:flex;gap:8px;align-items:center;font-size:12px;color:var(--muted)}

    .options{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--line);border-radius:999px;padding:6px 10px;cursor:pointer}
    .chip[aria-checked="true"]{border-color:var(--a);background:#f5f8ff}

    .copyline{display:grid;grid-template-columns:1fr auto;gap:8px}
    .copybtn{border:1px solid var(--line);background:#fff;border-radius:10px;padding:8px 10px;cursor:pointer;font-weight:700}
    .qr{display:grid;place-items:center;height:180px;border:1px dashed #dbe4f3;border-radius:12px;background:#f7faff;color:#6b7280}

    .schedule{width:100%;border-collapse:collapse;border:1px solid var(--line);border-radius:12px;overflow:hidden}
    .schedule th,.schedule td{padding:10px 12px;border-bottom:1px solid var(--line);text-align:left}
    .schedule tr:last-child td{border-bottom:none}
    .sched-mobile{display:none}
    @media(max-width:640px){
      .brand .logo{height:22px}
      .schedule{display:none}
      .sched-mobile{display:grid;gap:6px}
      .sched-item{display:flex;justify-content:space-between;align-items:center;border:1px solid var(--line);border-radius:12px;padding:8px 10px;background:#fff}
      .method-list{grid-template-columns:1fr 1fr}
    }

    .summary-list{display:grid;gap:8px}
    .sum-row{display:flex;justify-content:space-between;align-items:center}
    .total{font-size:16px;font-weight:800}
    .hint{font-size:12px;color:var(--muted)}

    .btn{display:inline-flex;align-items:center;gap:8px;justify-content:center;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:800}
    .btn.primary{background:linear-gradient(180deg,#2563eb,#1e40af);border-color:#1e40af;color:#fff}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .ok{border:1px solid #bbf7d0;background:#f0fdf4;color:#166534;border-radius:12px;padding:10px;display:none}
    .err{border:1px solid #fecaca;background:#fef2f2;color:#991b1b;border-radius:12px;padding:10px;display:none}

    footer{background:#fff;border-top:1px solid var(--line)}
    .fwrap{max-width:var(--w);margin:0 auto;padding:14px 12px;display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;align-items:center;font-size:12px}
    .fwrap a{opacity:.9}
  </style>
</head>
<body>
  <header>
    <div class="hwrap">
      <a href="./index.html" class="brand">
        <img src="./assets/img/logopnggfstore.png" class="logo" alt="GF Store" width="180" height="52" decoding="async">
      </a>
      <nav class="nav">
        <a href="./compte/index.html"><img class="ic" id="icUser" alt=""> Compte</a>
        <a href="./checkout.html" class="iconbtn"><img id="cartIcon" class="ic" alt=""> Panier</a>
        <button class="iconbtn" id="menuBtn" aria-label="Menu"><img class="ic" id="icMenu" alt=""></button>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- Colonne gauche : Infos & Paiement -->
      <section class="card">
        <div class="hd">
          <div class="title">Informations & Paiement</div>
          <span class="subtle"><img class="ic" id="icSSL" alt=""> Paiement sécurisé</span>
        </div>
        <div class="bd">
          <div class="row cols-2">
            <div>
              <label>Prénom</label>
              <input id="firstName" autocomplete="given-name" placeholder="Ex : Marie" required>
            </div>
            <div>
              <label>Nom</label>
              <input id="lastName" autocomplete="family-name" placeholder="Ex : Durand" required>
            </div>
            <div>
              <label>Email</label>
              <input id="email" type="email" autocomplete="email" placeholder="vous@exemple.com" required>
            </div>
            <div>
              <label>Téléphone</label>
              <input id="phone" autocomplete="tel" placeholder="+33 6 12 34 56 78" required>
            </div>
          </div>

          <div class="row cols-2" style="margin-top:10px">
            <div>
              <label>Adresse</label>
              <input id="addr" autocomplete="address-line1" placeholder="10 rue des Lilas" required>
            </div>
            <div>
              <label>Complément (facultatif)</label>
              <input id="addr2" autocomplete="address-line2" placeholder="Bâtiment, étage, etc.">
            </div>
            <div>
              <label>Ville</label>
              <input id="city" autocomplete="address-level2" placeholder="Paris" required>
            </div>
            <div>
              <label>Code postal</label>
              <input id="zip" autocomplete="postal-code" placeholder="75001" required>
            </div>
            <div>
              <label>Pays</label>
              <select id="country" autocomplete="country" required>
                <option>France</option>
                <option>Belgique</option>
                <option>Suisse</option>
                <option>Luxembourg</option>
                <option>Espagne</option>
                <option>Italie</option>
                <option>Allemagne</option>
              </select>
            </div>
            <div>
              <label>Livraison</label>
              <select id="shipping" required>
                <option value="0">Standard — Gratuit (≤ 7 jours)</option>
                <option value="9.9">Express — 9,90 € (2–4 jours)</option>
              </select>
            </div>
          </div>

          <hr style="margin:14px 0;border:none;border-top:1px dashed var(--line)">

          <!-- Méthodes -->
          <div class="title" style="margin-bottom:8px">Méthode de paiement</div>
          <div class="method-list" id="methods" role="tablist">
            <div class="method" role="tab" aria-selected="true" data-method="crypto">
              <div class="m-logos">
                <img src="https://cdn.simpleicons.org/bitcoin" alt="Bitcoin">
                <img src="https://cdn.simpleicons.org/ethereum" alt="Ethereum">
                <img src="https://cdn.simpleicons.org/tether" alt="USDT">
              </div>
              <div class="muted">Envoi sur adresse affichée. Confirmation rapide.</div>
              <div class="m-foot">
                <span class="badge ok">Frais 0 €</span>
                <button class="pick primary" type="button">Choisir</button>
              </div>
            </div>

            <div class="method" role="tab" aria-selected="false" data-method="bank">
              <div class="m-logos">
                <img src="https://cdn.simpleicons.org/sepa" alt="SEPA">
                <img src="https://cdn.simpleicons.org/iban" alt="IBAN">
              </div>
              <div class="muted">Virement SEPA. Référence à indiquer obligatoire.</div>
              <div class="m-foot">
                <span class="badge ok">Frais 0 €</span>
                <button class="pick" type="button">Choisir</button>
              </div>
            </div>

            <div class="method" role="tab" aria-selected="false" data-method="card" aria-disabled="true">
              <div class="m-logos">
                <img src="https://cdn.simpleicons.org/visa" alt="Visa">
                <img src="https://cdn.simpleicons.org/mastercard" alt="Mastercard">
              </div>
              <div class="muted">Indisponible pour le moment.</div>
              <div class="m-foot">
                <span class="badge warn">Maintenance</span>
                <button class="pick" type="button" disabled>Indispo</button>
              </div>
            </div>

            <div class="method" role="tab" aria-selected="false" data-method="paypal" aria-disabled="true">
              <div class="m-logos">
                <img src="https://cdn.simpleicons.org/paypal" alt="PayPal">
              </div>
              <div class="muted">Indisponible pour le moment.</div>
              <div class="m-foot">
                <span class="badge warn">Maintenance</span>
                <button class="pick" type="button" disabled>Indispo</button>
              </div>
            </div>
          </div>

          <!-- PANELS -->
          <div id="panel-crypto" class="panel show" style="margin-top:12px">
            <div class="row cols-2">
              <div>
                <label>Réseau / monnaie</label>
                <select id="ccy">
                  <option value="USDT-TRC20">USDT (TRC20)</option>
                  <option value="USDT-ERC20">USDT (ERC20)</option>
                  <option value="BTC">Bitcoin (BTC)</option>
                  <option value="ETH">Ethereum (ETH)</option>
                </select>
              </div>
              <div>
                <label>Montant à envoyer (<span id="ccyLabel">USDT</span>)</label>
                <input id="amountCcy" readonly>
              </div>
              <div class="copyline" style="grid-column:1/-1">
                <div>
                  <label>Adresse de paiement</label>
                  <input id="wallet" readonly value="TQf3k7s9h2x4y5z6a7b8c9d0e1f2g3h4i">
                </div>
                <button class="copybtn" data-copy="#wallet" type="button">Copier</button>
              </div>
              <div class="row" style="grid-column:1/-1">
                <div class="qr" aria-label="QR Code">QR CODE</div>
                <div class="hint">Scannez pour préremplir l’adresse et le montant.</div>
              </div>
            </div>

            <div style="margin-top:10px">
              <div class="title" style="font-size:14px;margin-bottom:6px">Paiement en plusieurs fois (0 % frais)</div>
              <div class="options" id="inst-crypto" role="radiogroup" aria-label="Échéances crypto">
                <button class="chip" data-n="1" aria-checked="true">1 fois</button>
                <button class="chip" data-n="3">3 fois</button>
                <button class="chip" data-n="4">4 fois</button>
              </div>
            </div>

            <div class="row cols-2" style="margin-top:10px">
              <div>
                <label>Identifiant de transaction (hash)</label>
                <input id="txid" placeholder="Ex : 0x… / TXID" required>
              </div>
              <div>
                <label>Preuve de paiement (image / PDF) — obligatoire</label>
                <input id="proofCrypto" type="file" accept="image/*,.pdf" required>
              </div>
            </div>
          </div>

          <div id="panel-bank" class="panel" style="margin-top:12px">
            <div class="row cols-2">
              <div class="copyline">
                <div>
                  <label>Bénéficiaire</label>
                  <input id="benef" value="GF STORE" readonly>
                </div>
                <button class="copybtn" data-copy="#benef" type="button">Copier</button>
              </div>
              <div class="copyline">
                <div>
                  <label>Banque</label>
                  <input id="bankname" value="Bank Europe Demo" readonly>
                </div>
                <button class="copybtn" data-copy="#bankname" type="button">Copier</button>
              </div>
              <div class="copyline">
                <div>
                  <label>IBAN / Compte</label>
                  <input id="iban" value="FR76 3000 6000 0112 3456 7890 189" readonly>
                </div>
                <button class="copybtn" data-copy="#iban" type="button">Copier</button>
              </div>
              <div class="copyline">
                <div>
                  <label>SWIFT/BIC</label>
                  <input id="swift" value="DIBLFRPP" readonly>
                </div>
                <button class="copybtn" data-copy="#swift" type="button">Copier</button>
              </div>
              <div class="copyline" style="grid-column:1/-1">
                <div>
                  <label>Référence à indiquer</label>
                  <input id="payref" value="GF-" readonly>
                </div>
                <button class="copybtn" data-copy="#payref" type="button">Copier</button>
              </div>
            </div>

            <div style="margin-top:10px">
              <div class="title" style="font-size:14px;margin-bottom:6px">Paiement en plusieurs virements (0 % frais)</div>
              <div class="options" id="inst-bank" role="radiogroup" aria-label="Échéances virement">
                <button class="chip" data-n="1" aria-checked="true">1 fois</button>
                <button class="chip" data-n="2">2 fois</button>
                <button class="chip" data-n="3">3 fois</button>
                <button class="chip" data-n="4">4 fois</button>
              </div>
            </div>

            <div class="row cols-2" style="margin-top:10px">
              <div>
                <label>Preuve de virement (obligatoire)</label>
                <input id="proofBank" type="file" accept="image/*,.pdf" required>
              </div>
              <div>
                <label>Commentaire (facultatif)</label>
                <input id="bankNote" placeholder="Ex : Virement effectué via banque X">
              </div>
            </div>
          </div>

          <div class="ok" id="ok"></div>
          <div class="err" id="err"></div>
        </div>
      </section>

      <!-- Colonne droite : Récap -->
      <aside class="card">
        <div class="hd">
          <div class="title">Récapitulatif commande</div>
          <span class="badge">Livraison sous 7 jours</span>
        </div>
        <div class="bd">
          <div id="cartList" class="summary-list"></div>
          <hr style="border:none;border-top:1px dashed var(--line);margin:10px 0">
          <div class="summary-list">
            <div class="sum-row"><span class="muted">Sous-total</span><span id="subTotal">0 €</span></div>
            <div class="sum-row"><span class="muted">Livraison</span><span id="shipTotal">0 €</span></div>
            <div class="sum-row total"><span>Total à payer</span><span id="grandTotal">0 €</span></div>
          </div>

          <div style="margin-top:14px">
            <div class="title" style="font-size:14px;margin-bottom:6px">Échéancier</div>

            <!-- Tableau PC -->
            <table class="schedule" id="scheduleTable" aria-label="Échéancier">
              <thead><tr><th>Date</th><th>Montant</th></tr></thead>
              <tbody id="scheduleBody"></tbody>
            </table>

            <!-- Liste Mobile -->
            <div class="sched-mobile" id="scheduleList" aria-label="Échéancier (mobile)"></div>

            <div class="hint" style="margin-top:6px" id="feesInfo">Frais de paiement : 0 €</div>
          </div>

          <div style="margin-top:14px;display:grid;gap:8px">
            <button id="confirmBtn" class="btn primary">Confirmer et créer la commande</button>
            <div class="hint">Un email récapitulatif avec les instructions de paiement sera envoyé. Priorité au traitement dès réception du paiement.</div>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer>
    <div class="fwrap">
      <div>© GF Store 2025 — Simplicité, sécurité, crypto-friendly.</div>
      <nav>
        <a href="./pages/a-propos.html">À propos</a> ·
        <a href="./pages/cgv.html">CGV</a> ·
        <a href="./pages/mentions-legales.html">Mentions légales</a> ·
        <a href="./pages/confidentialite.html">Confidentialité</a> ·
        <a href="./pages/contact.html">Contact</a>
      </nav>
    </div>
  </footer>

  <script>
  (async()=>{
    // --- Icônes cohérentes avec ton site
    const ICONS = {
      user:'https://img.icons8.com/?size=100&id=n8DrUm77sR3l&format=png&color=000000',
      menu:'https://img.icons8.com/?size=100&id=RzDomvpIKGI9&format=png&color=000000',
      cart:'https://img.icons8.com/?size=100&id=AaWM1DnCz2bQ&format=png&color=000000',
      cartFull:'https://img.icons8.com/?size=100&id=K5Jv3BfpxPYa&format=png&color=000000',
      ssl:'https://img.icons8.com/?size=100&id=2FIgZJEL88pu&format=png&color=000000'
    };
    const setSrc=(id,src)=>{const el=document.getElementById(id); if(el) el.src=src};
    setSrc('icUser',ICONS.user); setSrc('icMenu',ICONS.menu); setSrc('cartIcon',ICONS.cart); setSrc('icSSL',ICONS.ssl);

    // --- Menu bouton (si tu ajoutes un dropdown plus tard)
    const menuBtn=document.getElementById('menuBtn'); if(menuBtn){ menuBtn.addEventListener('click',()=>location.href='./index.html'); }

    // --- Cart utils
    const KEY='gf_cart';
    const EUR=v=>Number(v).toLocaleString('fr-FR',{style:'currency',currency:'EUR'});
    const getCart=()=>{try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch{return[]}};
    const cart=getCart();
    function cartTotal(){ return cart.reduce((s,x)=>s + (Number(x.price||0)*Number(x.qty||0)), 0); }
    function renderCart(){
      const list=document.getElementById('cartList');
      if(!cart.length){ list.innerHTML='<div class="muted">Votre panier est vide.</div>'; }
      else{
        list.innerHTML = cart.map(x=>`
          <div class="sum-row">
            <span>${x.name} × ${x.qty}</span>
            <span>${EUR(Number(x.price)*Number(x.qty))}</span>
          </div>`).join('');
      }
      document.getElementById('subTotal').textContent = EUR(cartTotal());
    }
    renderCart();

    // --- Livraison
    const shippingSel=document.getElementById('shipping');
    function shippingCost(){ return Number(shippingSel.value||0); }

    // --- Méthodes + panneaux
    const panels={ crypto:document.getElementById('panel-crypto'), bank:document.getElementById('panel-bank') };
    let method='crypto';
    document.getElementById('methods').addEventListener('click',(e)=>{
      const card=e.target.closest('.method'); if(!card || card.getAttribute('aria-disabled')==='true') return;
      method = card.dataset.method;
      document.querySelectorAll('.method').forEach(m=>m.setAttribute('aria-selected', String(m===card)));
      Object.values(panels).forEach(p=>p.classList.remove('show'));
      if(panels[method]) panels[method].classList.add('show');
      updateSchedule(); updateTotals(); validateProofs(false);
    });

    // --- FX crypto (ratios fictifs, cohérents)
    const fx={ 'USDT-TRC20':{symbol:'USDT',rate:1}, 'USDT-ERC20':{symbol:'USDT',rate:1}, 'BTC':{symbol:'BTC', rateEur:54000}, 'ETH':{symbol:'ETH', rateEur:2400} };
    const ccySel=document.getElementById('ccy'); const ccyLabel=document.getElementById('ccyLabel'); const amountCcy=document.getElementById('amountCcy');
    function recalcCryptoAmount(){
      const total = grandTotal();
      const v = ccySel.value;
      if(v.startsWith('USDT')){ ccyLabel.textContent='USDT'; amountCcy.value=(total).toFixed(2); }
      else if(v==='BTC'){ ccyLabel.textContent='BTC'; amountCcy.value=(total / (fx.BTC.rateEur||54000)).toFixed(6).replace(/0+$/,'').replace(/\.$/,''); }
      else if(v==='ETH'){ ccyLabel.textContent='ETH'; amountCcy.value=(total / (fx.ETH.rateEur||2400)).toFixed(6).replace(/0+$/,'').replace(/\.$/,''); }
    }
    ccySel.addEventListener('change', recalcCryptoAmount);

    // --- Échéances
    const instCrypto=document.getElementById('inst-crypto');
    const instBank=document.getElementById('inst-bank');
    let nInst=1;

    function attachInst(container){
      container.addEventListener('click',e=>{
        const b=e.target.closest('.chip'); if(!b) return;
        container.querySelectorAll('.chip').forEach(x=>x.setAttribute('aria-checked','false'));
        b.setAttribute('aria-checked','true');
        nInst = Number(b.dataset.n||1);
        updateSchedule(); updateTotals(); recalcCryptoAmount();
      });
    }
    attachInst(instCrypto); attachInst(instBank);

    // --- Totaux
    function grandTotal(){ return Math.max(0, cartTotal() + shippingCost()); }
    function updateTotals(){
      document.getElementById('shipTotal').textContent = EUR(shippingCost());
      document.getElementById('grandTotal').textContent = EUR(grandTotal());
      recalcCryptoAmount();
    }
    shippingSel.addEventListener('change', ()=>{ updateTotals(); updateSchedule(); });

    // --- Échéancier (dates + montants)
    function addDays(d,days){ const dd=new Date(d); dd.setDate(dd.getDate()+days); return dd; }
    function fmtDate(d){ return d.toLocaleDateString('fr-FR',{day:'2-digit',month:'2-digit',year:'numeric'}); }
    function splitAmount(total,n){
      // Répartit avec arrondis pour que la somme = total
      const cents=Math.round(total*100);
      const base=Math.floor(cents/n);
      const rest=cents - base*n;
      const arr=Array.from({length:n},(_,i)=> (base + (i<rest?1:0))/100 );
      return arr;
    }
    function scheduleDates(n){
      // 0, +30, +60, +90
      const steps=[0,30,60,90]; return steps.slice(0,n).map(d=>addDays(new Date(), d));
    }
    function updateSchedule(){
      const t = grandTotal();
      const parts = splitAmount(t, nInst);
      const dates = scheduleDates(nInst);
      const tbody=document.getElementById('scheduleBody');
      tbody.innerHTML = parts.map((amt,i)=>`<tr><td>${i===0?'Aujourd’hui':fmtDate(dates[i])}</td><td>${EUR(amt)}</td></tr>`).join('');
      const list=document.getElementById('scheduleList');
      list.innerHTML = parts.map((amt,i)=>`<div class="sched-item"><div>${i===0?'Aujourd’hui':fmtDate(dates[i])}</div><strong>${EUR(amt)}</strong></div>`).join('');
      document.getElementById('feesInfo').textContent = 'Frais de paiement : 0 €';
    }

    // --- Copie
    document.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click',async()=>{
        const sel = btn.getAttribute('data-copy');
        const el = document.querySelector(sel); if(!el) return;
        try{
          await navigator.clipboard.writeText(el.value||'');
          showOk('Copié ✓');
        }catch{ showErr('Impossible de copier'); }
      });
    });

    // --- Référence de paiement (inclut date/heure)
    const ref=document.getElementById('payref');
    const refBase='GF-'+String(Date.now()).slice(-6);
    ref.value = refBase;

    // --- Proofs validation
    const proofBank=document.getElementById('proofBank');
    const proofCrypto=document.getElementById('proofCrypto');
    const txid=document.getElementById('txid');

    function validateProofs(show=true){
      let ok=true;
      if(method==='bank'){
        if(!proofBank.files || !proofBank.files.length){ ok=false; if(show) showErr('Veuillez joindre la preuve de virement.'); }
      }
      if(method==='crypto'){
        const tx=(txid.value||'').trim();
        if(!tx || tx.length<8){ ok=false; if(show) showErr('Veuillez renseigner l’identifiant (hash) de transaction.'); }
        if(!proofCrypto.files || !proofCrypto.files.length){ ok=false; if(show) showErr('Veuillez joindre une preuve (capture ou PDF).'); }
      }
      return ok;
    }

    // --- Confirmer
    const confirmBtn=document.getElementById('confirmBtn');
    function requiredFilled(){
      const ids=['firstName','lastName','email','phone','addr','city','zip','country','shipping'];
      return ids.every(id=>String((document.getElementById(id)?.value||'').trim()).length>0);
    }
    function showOk(msg){ const el=document.getElementById('ok'); el.textContent=msg; el.style.display='block'; document.getElementById('err').style.display='none'; }
    function showErr(msg){ const el=document.getElementById('err'); el.textContent=msg; el.style.display='block'; document.getElementById('ok').style.display='none'; }

    confirmBtn.addEventListener('click',()=>{
      if(!cart.length){ showErr('Votre panier est vide.'); return; }
      if(!requiredFilled()){ showErr('Merci de compléter vos informations.'); return; }
      if(!validateProofs(true)) return;

      // À ce stade : créer la commande côté serveur (non inclus ici)
      showOk('Commande créée. Instructions envoyées par email. Merci !');
      window.scrollTo({top:0,behavior:'smooth'});
    });

    // --- Initial
    function initCounts(){
      const count=cart.reduce((s,x)=>s+Number(x.qty||0),0);
      const cartIcon=document.getElementById('cartIcon');
      if(cartIcon) cartIcon.src = count>0 ? ICONS.cartFull : ICONS.cart;
    }
    initCounts(); updateTotals(); updateSchedule(); recalcCryptoAmount();

  })();
  </script>
</body>
</html>
