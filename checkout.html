<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>GF Store — Paiement sécurisé</title>
  <meta name="description" content="Page de paiement GF Store : Virement & Crypto actifs. Carte & PayPal temporairement indisponibles. Livraison prioritaire sous 1 semaine, retours sous 14 jours." />
  <style>
    :root{
      --w:1200px;
      --bg:#f6f8fb; --panel:#ffffff; --line:#e6edf6;
      --text:#0f172a; --muted:#6b7280;
      --brand:#2563eb; --ok:#059669;
      --r:14px;
      --shadow:0 6px 18px rgba(15,23,42,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    /* Header */
    header{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(4px)}
    .hwrap{max-width:var(--w);margin:auto;padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand .logo{height:40px;width:auto}
    .nav{display:flex;gap:10px;align-items:center}
    .nav a,.iconbtn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--line);background:#fff;border-radius:12px;box-shadow:0 1px 0 rgba(0,0,0,.02)}
    .nav a:hover,.iconbtn:hover{box-shadow:0 4px 16px rgba(0,0,0,.06)}
    .iconbtn{cursor:pointer}
    .ic{width:16px;height:16px}
    .dropdown{position:relative}
    .menu{position:absolute;right:0;top:calc(100% + 8px);display:none;background:#fff;border:1px solid var(--line);border-radius:12px;min-width:220px;padding:6px;box-shadow:0 10px 24px rgba(0,0,0,.12)}
    .menu a{display:block;padding:8px 10px;border-radius:8px}
    .menu a:hover{background:#f3f4f6}
    .menu.show{display:block}

    /* Layout */
    .wrap{max-width:var(--w);margin:16px auto;padding:0 12px;display:grid;gap:16px}
    @media (min-width:980px){.wrap{grid-template-columns:1.15fr .85fr}}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--r);box-shadow:var(--shadow)}
    .hd{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--line)}
    .bd{padding:14px 16px}
    .title{font-weight:600;font-size:17px}
    .muted{color:var(--muted);font-size:13px}
    .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid #dbeafe;background:#f5f8ff;color:#2563eb;border-radius:999px;padding:6px 10px;font-size:12px}

    /* Form */
    form{display:grid;gap:10px}
    .row{display:grid;gap:10px}
    .cols-2{grid-template-columns:1fr 1fr}
    @media(max-width:760px){.cols-2{grid-template-columns:1fr}}
    label{display:block;margin:4px 0 6px;color:#0f172a;font-weight:500}
    input,select{width:100%;padding:11px 12px;border:1px solid var(--line);border-radius:12px;background:#fbfdff}
    input::placeholder{color:#9aa3b2}
    input:focus,select:focus{outline:2px solid rgba(37,99,235,.2);box-shadow:0 6px 18px rgba(37,99,235,.08)}

    /* Methods grid */
    .methods{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    @media(max-width:980px){.methods{grid-template-columns:repeat(2,1fr)}}
    .m{position:relative;border:1px solid var(--line);border-radius:12px;background:#fff;padding:12px;display:grid;grid-template-rows:auto 1fr auto;gap:8px;cursor:pointer;transition:transform .08s,box-shadow .18s,border-color .18s}
    .m:hover{transform:translateY(-1px);box-shadow:0 8px 18px rgba(0,0,0,.06)}
    .m[aria-selected="true"]{border-color:var(--brand);box-shadow:0 10px 24px rgba(37,99,235,.12)}
    .mlabel{display:flex;align-items:center;gap:8px}
    .mlabel strong{font-weight:600}
    .logos{margin-top:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .logos img{height:18px;opacity:.9}
    .bubble{margin-top:8px;display:inline-flex;align-items:center;gap:6px;border:1px dashed #bbf7d0;background:#ecfdf5;color:#065f46;padding:4px 8px;border-radius:999px;font-size:12px}
    .disabled{opacity:.5;cursor:not-allowed}
    .disabled .bubble{display:none}

    /* Highlight best */
    .m.best::after{
      content:"MEILLEUR TARIF";
      position:absolute; top:50%; right:12px; transform:translateY(-50%);
      font-size:11px; padding:4px 8px; border-radius:999px;
      background:#f0f9ff; color:#1e40af; border:1px solid #bfdbfe;
      pointer-events:none; letter-spacing:.2px; font-weight:700;
    }

    /* Panels */
    .pm{display:none;margin-top:12px;border:1px dashed var(--line);border-radius:12px;background:#fbfdff;padding:12px}
    .pm.show{display:block}
    .copyline{display:grid;grid-template-columns:1fr auto;gap:8px}
    .copy{padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
    .qr{display:flex;align-items:center;justify-content:center;min-height:190px;border:1px dashed #dbe7ff;border-radius:10px;background:#f3f6ff}
    .qr img{width:220px;height:auto;display:block}

    /* Pay now / split */
    .paytog{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .pt{border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 12px;cursor:pointer;display:inline-flex;align-items:center;gap:8px}
    .pt.on{border-color:var(--brand);box-shadow:0 0 0 3px rgba(37,99,235,.12);background:#f8fbff}
    .pt small{color:var(--muted)}

    /* Segmented control (modal) */
    .seg{display:flex;gap:8px;background:#f8fafc;border:1px solid var(--line);padding:6px;border-radius:12px}
    .segbtn{flex:1;display:grid;place-items:center;gap:2px;padding:10px 12px;border:1px solid transparent;background:#fff;border-radius:10px;cursor:pointer}
    .segbtn[aria-pressed="true"]{border-color:var(--brand);box-shadow:0 0 0 3px rgba(37,99,235,.12);background:#f0f6ff}
    .segbtn .big{font-weight:600}
    .segbtn .small{font-size:12px;color:#6b7280}

    /* Summary */
    .mini{display:flex;flex-direction:column;gap:10px}
    .ci{display:grid;grid-template-columns:60px 1fr auto;gap:8px}
    .ci img{width:60px;height:60px;object-fit:cover;border-radius:10px;border:1px solid var(--line);background:#fff}
    .sum{display:grid;gap:8px;margin-top:10px}
    .rowline{display:flex;align-items:center;justify-content:space-between}
    .due{font-size:18px;font-weight:700}
    .note{font-size:12px;color:#065f46;background:#ecfdf5;border:1px solid #bbf7d0;border-radius:10px;padding:6px 8px}
    .schedule{display:grid;gap:6px;margin-top:6px}
    .sch{display:flex;align-items:center;justify-content:space-between;font-size:13px}

    /* Buttons */
    .btn{display:inline-flex;align-items:center;gap:8px;justify-content:center;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
    .btn.primary{background:linear-gradient(180deg,#2563eb,#1e40af);color:#fff;border-color:#1e40af;box-shadow:0 10px 24px rgba(30,64,175,.25)}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);display:none;z-index:10000}
    .modal.show{display:block}
    .sheet{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(560px,95%);background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:0 18px 38px rgba(0,0,0,.25);display:grid;grid-template-rows:auto 1fr auto}
    .sheet header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
    .sheet .body{padding:12px 14px;display:grid;gap:12px}
    .sheet footer{padding:12px 14px;border-top:1px solid var(--line);display:flex;gap:8px;justify-content:flex-end}
    .x{cursor:pointer;border:1px solid var(--line);background:#fff;border-radius:10px;padding:6px}

    /* Toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#111;color:#fff;padding:10px 14px;border-radius:12px;display:none;z-index:99999}
    .toast.show{display:block}

    /* Uploader (SEPA) */
    .uploader{display:grid;gap:10px}
    .dz{
      position:relative; display:grid; place-items:center; text-align:center; gap:8px;
      padding:18px; border:1px dashed #cfe0ff; border-radius:14px; background:
        radial-gradient(1200px 80px at 50% 0, #f7faff 0,#ffffff 60%);
      transition: .15s border-color, .15s box-shadow, .15s transform;
      cursor:pointer;
    }
    .dz:hover{box-shadow:0 12px 28px rgba(37,99,235,.08)}
    .dz.over{border-color:#93c5fd; box-shadow:0 0 0 4px rgba(37,99,235,.12)}
    .dz svg{width:28px;height:28px;opacity:.8}
    .dz .hint{font-size:12px;color:var(--muted)}
    .dz .cta{display:inline-flex;gap:8px;align-items:center;margin-top:6px}
    .dz .cta .btn{padding:8px 12px}
    .hidden{position:absolute;opacity:0;pointer-events:none;width:0;height:0}
    .filecard{display:flex;align-items:center;gap:12px;border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 12px;box-shadow:0 4px 14px rgba(0,0,0,.04)}
    .filebadge{width:36px;height:36px;border-radius:10px;background:#eef2ff;display:grid;place-items:center;border:1px solid #e5e7eb}
    .filemeta{display:grid}
    .filename{font-weight:600;max-width:320px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .filesub{font-size:12px;color:#6b7280}
    .prog{height:6px;background:#eef2ff;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#60a5fa,#2563eb);transition:width .6s ease}
    .factions{margin-left:auto;display:flex;gap:8px}
    .tag-ok{
      font-size:12px;color:#065f46;background:#ecfdf5;border:1px solid #bbf7d0;border-radius:8px;
      padding:2px 6px; display:inline-flex; align-items:center; justify-content:center;
      min-width:48px; text-align:center;
    }

    /* Full-screen overlays (verification + success) */
    .overlay{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      background:rgba(15,23,42,.28); backdrop-filter:blur(6px);
      z-index:20000;
    }
    .overlay.show{display:flex}
    .loader{
      background:#fff; border:1px solid var(--line); border-radius:14px; padding:18px;
      width:min(520px,92%); box-shadow:0 18px 38px rgba(0,0,0,.25); text-align:center;
      display:grid; gap:12px;
    }
    .spin{width:38px;height:38px;border:3px solid #e5e7eb;border-top-color:#1e40af;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto}
    @keyframes spin{to{transform:rotate(360deg)}}

    footer{background:#fff;border-top:1px solid var(--line);margin-top:16px}
    .fwrap{max-width:var(--w);margin:0 auto;padding:16px 12px;display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;align-items:center;font-size:12px}

    @media(max-width:640px){
      .brand .logo{height:26px}
      .nav a span{display:none}
      .filename{max-width:180px}
    }
  </style>
</head>
<body>
  <header>
    <div class="hwrap">
      <a href="index.html" class="brand" aria-label="Accueil">
        <img src="assets/img/logopnggfstore.png" class="logo" alt="GF Store" width="180" height="52" decoding="async">
      </a>
      <nav class="nav">
        <a href="compte/index.html" title="Compte"><img class="ic" id="icUser" alt=""> <span>Compte</span></a>
        <a href="index.html" title="Continuer les achats"><img class="ic" id="icContinue" alt=""> <span>Continuer les achats</span></a>
        <div class="dropdown">
          <button class="iconbtn" id="menuBtn" aria-label="Ouvrir le menu"><img class="ic" id="icMenu" alt=""></button>
          <div id="menuDrop" class="menu" role="menu">
            <a href="pages/a-propos.html">À propos</a>
            <a href="pages/cgv.html">CGV</a>
            <a href="pages/mentions-legales.html">Mentions légales</a>
            <a href="pages/confidentialite.html">Confidentialité</a>
            <a href="pages/contact.html">Contact</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="wrap" aria-live="polite">
    <!-- Colonne gauche -->
    <section class="card" aria-labelledby="h-checkout">
      <div class="hd">
        <div>
          <div class="title" id="h-checkout">Paiement sécurisé <span id="orderId" class="muted" style="margin-left:8px"></span></div>
          <div class="muted">Livraison prioritaire sous 1 semaine • Retours 14 jours</div>
        </div>
        <span class="pill"><img class="ic" id="icSSL" alt=""> SSL actif</span>
      </div>

      <div class="bd">
        <!-- Adresse -->
        <form id="addrForm" class="row cols-2" novalidate>
          <div><label for="name">Nom complet</label><input id="name" placeholder="Prénom Nom" required></div>
          <div><label for="email">Email</label><input id="email" type="email" placeholder="vous@example.com" required></div>
          <div><label for="phone">Téléphone</label><input id="phone" inputmode="tel" placeholder="+33 6 12 34 56 78"></div>
          <div><label for="country">Pays</label><input id="country" placeholder="France"></div>
          <div class="cols-2">
            <div><label for="address">Adresse</label><input id="address" placeholder="10 Avenue de l’Europe" required></div>
            <div><label for="city">Ville</label><input id="city" placeholder="Paris" required></div>
            <div><label for="zip">Code postal</label><input id="zip" inputmode="numeric" placeholder="75008" required></div>
          </div>
        </form>

        <!-- Méthodes de paiement -->
        <div style="margin:14px 0 8px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
          <div class="title" style="font-size:16px">Mode de paiement</div>
          <span class="muted">Virement & Crypto — Carte & PayPal indisponibles</span>
        </div>

        <div class="methods" role="tablist">
          <button class="m best" role="tab" aria-selected="true" data-method="sepa">
            <div class="mlabel"><strong>Virement SEPA</strong></div>
            <div class="logos">
              <img alt="SEPA" src="https://img.icons8.com/?size=100&id=7IJfqNBSaJ0N&format=png&color=000000">
              <img alt="IBAN" src="https://img.icons8.com/?size=100&id=PpOkzOgNS2tV&format=png&color=000000">
            </div>
            <span class="bubble">Promo -3%</span>
          </button>

          <button class="m" role="tab" aria-selected="false" data-method="crypto">
            <div class="mlabel"><strong>Crypto</strong></div>
            <div class="logos">
              <img alt="Bitcoin" src="https://cdn.simpleicons.org/bitcoin">
              <img alt="Ethereum" src="https://cdn.simpleicons.org/ethereum">
              <img alt="Tether" src="https://cdn.simpleicons.org/tether">
            </div>
            <span class="bubble">Promo -1%</span>
          </button>

          <div class="m disabled" aria-selected="false">
            <div class="mlabel"><strong>Carte bancaire</strong></div>
            <div class="logos">
              <img alt="Visa" src="https://cdn.simpleicons.org/visa">
              <img alt="Mastercard" src="https://cdn.simpleicons.org/mastercard">
              <img alt="American Express" src="https://cdn.simpleicons.org/americanexpress">
            </div>
            <span class="muted" style="margin-top:6px">Indisponible</span>
          </div>

          <div class="m disabled" aria-selected="false">
            <div class="mlabel"><strong>PayPal</strong></div>
            <div class="logos">
              <img alt="PayPal" src="https://cdn.simpleicons.org/paypal">
            </div>
            <span class="muted" style="margin-top:6px">Indisponible</span>
          </div>
        </div>

        <!-- Payer maintenant / Split -->
        <div class="paytog" style="margin-top:12px">
          <button id="btnOnce" class="pt on" type="button"><strong>Payer maintenant</strong></button>
          <button id="btnSplit" class="pt" type="button" aria-haspopup="dialog" aria-controls="splitModal">
            <strong>Payer en plusieurs fois</strong> <small id="splitHint">(désactivé)</small>
          </button>
        </div>

        <!-- Panneau SEPA -->
        <div id="pmSEPA" class="pm show">
          <div class="row">
            <div class="row cols-2">
              <div><label>Noms</label><input readonly value="GF STORE"></div>
              <div><label>Banque</label><input readonly value="Nirio Banque (FR)"></div>
              <div><label for="iban">IBAN</label><input id="iban" readonly value="FR76 1652 8001 3100 0091 7161 081"></div>
              <div><label for="swift">BIC</label><input id="swift" readonly value="SMOEFRP1XXX"></div>
              <div><label for="vref">Référence</label><input id="vref" readonly placeholder="Nom du client (auto)"></div>
              <div><label for="amountNowBank">À virer maintenant (EUR)</label><input id="amountNowBank" readonly value="0"></div>
            </div>

            <!-- Uploader -->
            <div class="uploader" aria-label="Téléverser une preuve de virement">
              <div id="dz" class="dz" tabindex="0" role="button" aria-controls="proofInput">
                <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 18h10a4 4 0 0 0 0-8h-.26A6 6 0 1 0 7 18Zm5-9v6m0-6-2 2m2-2 2 2" fill="none" stroke="#1f2937" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <div>Glissez-déposez votre preuve (tout format accepté)</div>
                <div class="hint">ou</div>
                <div class="cta">
                  <button id="pickProof" type="button" class="btn">Importer</button>
                  <span class="hint">max 10 Mo</span>
                </div>
                <!-- accepte tous les fichiers -->
                <input id="proofInput" class="hidden" type="file" accept="*/*">
              </div>

              <div id="fileWrap" class="filecard" style="display:none">
                <div class="filebadge" aria-hidden="true">
                  <svg viewBox="0 0 24 24" width="18" height="18"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Z" fill="#e5e7eb"/><path d="M14 2v6h6" fill="#dbeafe"/></svg>
                </div>
                <div class="filemeta">
                  <span id="fileName" class="filename"></span>
                  <span id="fileInfo" class="filesub"></span>
                  <div class="prog" aria-hidden="true"><div id="fileBar" class="bar"></div></div>
                </div>
                <div class="factions">
                  <span id="fileOk" class="tag-ok" style="display:none">Prêt</span>
                  <button id="removeProof" type="button" class="btn" title="Retirer">Retirer</button>
                </div>
              </div>
            </div>

            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
              <button class="btn" data-copy="#iban">Copier IBAN</button>
              <button class="btn" data-copy="#swift">Copier BIC</button>
              <button class="btn" data-copy="#vref">Copier Référence</button>
              <button id="confirmBank" class="btn">J’ai effectué le virement</button>
              <small class="muted">Après vérification, vous pourrez finaliser la commande.</small>
            </div>
          </div>
        </div>

        <!-- Panneau CRYPTO -->
        <div id="pmCrypto" class="pm">
          <div class="row cols-2">
            <div>
              <label for="ccy">Monnaie</label>
              <select id="ccy">
                <option value="USDT-BEP20" selected>USDT (BEP20)</option>
                <option value="USDT-TRC20">USDT (TRC20)</option>
                <option value="BTC">Bitcoin (BTC)</option>
                <option value="ETH-ERC20">Ethereum (ERC20)</option>
              </select>
            </div>
            <div>
              <label for="amountNow">À envoyer maintenant (EUR)</label>
              <input id="amountNow" readonly value="0">
            </div>
          </div>

          <div class="copyline">
            <div>
              <label for="wallet">Adresse de paiement</label>
              <input id="wallet" readonly>
            </div>
            <button class="copy" data-copy="#wallet">Copier</button>
          </div>

          <div class="copyline">
            <div>
              <label for="ccyAmt">Montant à envoyer (<span id="ccyLabel">—</span>)</label>
              <input id="ccyAmt" readonly>
            </div>
            <button class="copy" data-copy="#ccyAmt">Copier</button>
          </div>

          <div class="qr" aria-label="QR de paiement">
            <img id="qrImg" alt="QR code paiement" width="220" height="220" decoding="async">
          </div>

          <div>
            <label for="txid">Identifiant de transaction (TxID / Hash)</label>
            <input id="txid" placeholder="0x… / bc1… / TX123…" required>
          </div>

          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="confirmCrypto" class="btn">J’ai envoyé le paiement</button>
            <small class="muted">Vérification rapide du hash avant finalisation.</small>
          </div>
        </div>

        <div style="display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap;margin-top:12px">
          <a href="index.html" class="btn"><img class="ic" id="icBack" alt=""> Continuer les achats</a>
          <button id="placeOrder" class="btn primary" disabled>Finaliser la commande</button>
        </div>
      </div>
    </section>

    <!-- Colonne droite : Récap -->
    <aside class="card" aria-labelledby="h-recap">
      <div class="hd">
        <div class="title" id="h-recap">Récapitulatif</div>
        <span class="pill"><img class="ic" id="icTruck" alt=""> Suivi & assistance</span>
      </div>
      <div class="bd">
        <div id="miniCart" class="mini"></div>
        <hr style="border:none;border-top:1px dashed var(--line);margin:10px 0">
        <div class="sum">
          <div class="rowline"><span class="muted">Sous-total</span><span id="sub">—</span></div>
          <div class="rowline"><span class="muted">Livraison</span><span id="ship">Gratuite</span></div>
          <div class="rowline"><span class="muted">Promo</span><span id="benefit">—</span></div>
          <div class="rowline"><span class="muted">Total</span><span id="total">—</span></div>
          <div class="rowline" id="dueRow"><span class="due">À payer aujourd’hui</span><span class="due" id="dueNow">—</span></div>
          <div id="schedule" class="schedule" style="display:none"></div>
          <div class="note">Livraison prioritaire sous 7 jours. Retours sous 14 jours.</div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Modal split -->
  <div id="splitModal" class="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="splitTitle">
    <div class="sheet">
      <header>
        <div style="font-weight:600" id="splitTitle">Choisir l’échéancier</div>
        <button class="x" id="closeSplit" aria-label="Fermer">✕</button>
      </header>
      <div class="body">
        <div id="segSplit" class="seg" role="group" aria-label="Nombre d’échéances">
          <button type="button" class="segbtn" data-parts="2" aria-pressed="false">
            <span class="big">2×</span><span class="small">mensuel</span>
          </button>
          <button type="button" class="segbtn" data-parts="3" aria-pressed="false">
            <span class="big">3×</span><span class="small">mensuel</span>
          </button>
          <button type="button" class="segbtn" data-parts="4" aria-pressed="true">
            <span class="big">4×</span><span class="small">mensuel</span>
          </button>
        </div>
        <div id="modalPrev" class="schedule" aria-live="polite"></div>
      </div>
      <footer>
        <button class="btn" id="cancelSplit">Annuler</button>
        <button class="btn primary" id="applySplit">Appliquer</button>
      </footer>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <!-- Vérification overlay -->
  <div id="checkOverlay" class="overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="loader" role="status" aria-live="polite">
      <div class="spin" aria-hidden="true"></div>
      <div id="ovTitle" style="font-weight:700">Vérification…</div>
      <div id="ovSub" class="muted">Un instant, nous confirmons votre paiement.</div>
    </div>
  </div>

  <!-- Succès / Merci overlay -->
  <div id="doneOverlay" class="overlay" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="loader" role="status" aria-live="polite">
      <div style="font-size:42px; line-height:1">✅</div>
      <div style="font-weight:700; font-size:18px">Merci ! Votre commande est enregistrée</div>
      <div class="muted">Nous vérifions le paiement et lançons la préparation. Vous recevrez un email de confirmation.</div>
      <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:4px">
        <a href="index.html" class="btn">Découvrir d’autres produits</a>
        <a href="compte/index.html" class="btn primary">Voir ma commande</a>
      </div>
    </div>
  </div>

  <footer>
    <div class="fwrap">
      <div>© GF Store 2025 — Simplicité, sécurité, crypto-friendly.</div>
      <nav>
        <a href="pages/a-propos.html">À propos</a> ·
        <a href="pages/cgv.html">CGV</a> ·
        <a href="pages/mentions-legales.html">Mentions légales</a> ·
        <a href="pages/confidentialite.html">Confidentialité</a> ·
        <a href="pages/contact.html">Contact</a>
      </nav>
    </div>
  </footer>

  <script>
  (async()=>{
    // ——— CONFIG WEBHOOK APPS SCRIPT (→ Telegram) ———
    const WEBHOOK_URL = "https://script.google.com/macros/s/AKfycbypa62g6lhlchWMayVWYyRh2TGc--bBdqNMag2ro1Ne1SDMVT5bHzy7pvooG3ZnsGAx/exec";

    // Icônes
    const ICONS = {
      user:'https://img.icons8.com/?size=100&id=n8DrUm77sR3l&format=png&color=000000',
      continue:'https://img.icons8.com/?size=100&id=26138&format=png&color=000000',
      menu:'https://img.icons8.com/?size=100&id=RzDomvpIKGI9&format=png&color=000000',
      ssl:'https://img.icons8.com/?size=100&id=2FIgZJEL88pu&format=png&color=000000',
      truck:'https://img.icons8.com/?size=100&id=plGFB4oatud2&format=png&color=000000',
      back:'https://img.icons8.com/?size=100&id=26138&format=png&color=000000'
    };
    const setSrc=(id,src)=>{const el=document.getElementById(id); if(el) el.src=src};
    setSrc('icUser',ICONS.user); setSrc('icMenu',ICONS.menu); setSrc('icSSL',ICONS.ssl);
    setSrc('icTruck',ICONS.truck); setSrc('icBack',ICONS.back); setSrc('icContinue',ICONS.continue);

    // Menu
    const menuBtn=document.getElementById('menuBtn'), menuDrop=document.getElementById('menuDrop');
    if(menuBtn&&menuDrop){
      menuBtn.addEventListener('click',e=>{e.stopPropagation();menuDrop.classList.toggle('show')});
      document.addEventListener('click',e=>{ if(!menuDrop.contains(e.target) && e.target!==menuBtn) menuDrop.classList.remove('show'); });
    }

    // Helpers
    const $=s=>document.querySelector(s); const $$=s=>Array.from(document.querySelectorAll(s));
    const toast=msg=>{const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1600);};
    const EUR=v=>Number(v||0).toLocaleString('fr-FR',{style:'currency',currency:'EUR'});

    // Panier localStorage (clé identique au site)
    const KEY='gf_cart';
    const getCart=()=>{try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch{return[]}};
    const setCart=arr=>localStorage.setItem(KEY,JSON.stringify(arr));

    // ID commande visible
    const orderId=(()=>{const d=new Date(); const y=String(d.getFullYear()).slice(2); const mm=String(d.getMonth()+1).padStart(2,'0'); const dd=String(d.getDate()).padStart(2,'0'); const rnd=Math.floor(Math.random()*9000)+1000; return `GF-${y}${mm}${dd}-${rnd}`;})();
    $('#orderId').textContent=orderId;

    // Rendu mini panier (colonne droite)
    function computeSub(cart){ return cart.reduce((s,x)=> s + Number(x.price||0)*Number(x.qty||1), 0); }
    function renderMini(){
      const wrap=$('#miniCart'); const cart=getCart();
      if(!cart.length){ wrap.innerHTML='<div class="muted">Votre panier est vide.</div>'; $('#sub').textContent='—'; $('#benefit').textContent='—'; $('#total').textContent='—'; $('#dueNow').textContent='—'; $('#schedule').style.display='none'; return; }
      wrap.innerHTML=cart.map(x=>`
        <div class="ci">
          <img src="${x.image||''}" alt="${x.name||''}">
          <div>
            <div style="font-weight:600">${x.name||''}</div>
            <div class="muted" style="font-size:12px">${x.brand||''}${x.category?(' • '+x.category):''}</div>
          </div>
          <div style="font-weight:600">${EUR(Number(x.price||0)*Number(x.qty||1))}</div>
        </div>`).join('');
    }

    // Méthodes / promos
    function currentPM(){ return document.querySelector('.m[role="tab"][aria-selected="true"]')?.dataset.method || 'sepa'; }
    function promoRate(){ return currentPM()==='sepa'?0.03 : currentPM()==='crypto'?0.01 : 0; }

    // Taux mock (affichage montant crypto)
    const fx={
      'USDT-TRC20':{symbol:'USDT',rate:1},
      'USDT-BEP20':{symbol:'USDT',rate:1},
      'BTC':{symbol:'BTC',rate:60000},
      'ETH-ERC20':{symbol:'ETH',rate:3000}
    };

    // Adresses crypto + QR
    const WALLET={
      'USDT-BEP20':{
        address:'0x5f1e4fdef890dba03ebfcba79a77aa0ea432f04b',
        qr:'https://api.qrcode-monkey.com/tmp/9c2692034c7a6496eb6d7153da52f854.svg?1755861184316'
      },
      'USDT-TRC20':{
        address:'TMdLMTYGEEZAnoVbi482Zr9QSRgWmRUXXq',
        qr:'https://api.qrcode-monkey.com/tmp/ce476e4409d57ba517ffaf6db6bf25d2.svg?1755861346811'
      },
      'BTC':{
        address:'18npEW9EaKZvVvA9B1z3DcmVEJtuQUdus3',
        qr:'https://api.qrcode-monkey.com/tmp/578f1d0b0e32feece2ae335bb417c7f8.svg?1755861612113'
      },
      'ETH-ERC20':{
        address:'0x5f1e4fdef890dba03ebfcba79a77aa0ea432f04b',
        qr:'https://api.qrcode-monkey.com/tmp/9c2692034c7a6496eb6d7153da52f854.svg?1755861930363'
      }
    };

    function setCryptoAddress(ccy){
      const cfg=WALLET[ccy];
      $('#wallet').value = cfg?.address || '';
      $('#ccyLabel').textContent = fx[ccy]?.symbol || (ccy.includes('USDT')?'USDT':'');
      const img=$('#qrImg'); if(img){ img.src = cfg?.qr || ''; img.alt = 'QR '+ccy; }
    }

    // Échéancier
    function splitAmounts(total, parts){
      const cents=Math.round(total*100);
      const base=Math.floor(cents/parts);
      const first=base + (cents - base*parts);
      const arr=[first]; for(let i=1;i<parts;i++) arr.push(base);
      return arr.map(c=>c/100);
    }
    function scheduleLines(total, parts){
      const amts=splitAmounts(total, parts);
      const today=new Date(); const steps=[0,30,60,90];
      return amts.map((amt,i)=>{
        const d=new Date(today); d.setDate(d.getDate()+steps[i]);
        const label = i===0 ? 'Aujourd’hui' : (i===1?'Dans 30 jours': i===2?'Dans 60 jours':'Dans 90 jours');
        return {label,date:d.toLocaleDateString('fr-FR'),amt};
      });
    }

    // Split
    let selectedSplit=1; let modalParts=4;
    const modal=$('#splitModal');
    const openModal=()=>{ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); setModalParts(modalParts); updateModalPreview(); };
    const closeModal=()=>{ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); };
    function updateSplitHint(){ $('#splitHint').textContent = selectedSplit>1 ? `(${selectedSplit}× mensuel)` : '(désactivé)'; }
    function updateModalPreview(){
      const cart=getCart(); const sub=computeSub(cart); const promo=sub*promoRate(); const total=Math.max(0,sub - promo);
      const lines=scheduleLines(total, modalParts);
      $('#modalPrev').innerHTML = lines.map(l=>`<div class="sch"><span>${l.label} (${l.date})</span><span>${EUR(l.amt)}</span></div>`).join('');
    }
    function setModalParts(n){
      modalParts=Number(n);
      $$('#segSplit .segbtn').forEach(b=>b.setAttribute('aria-pressed', String(Number(b.dataset.parts)===modalParts)));
      updateModalPreview();
    }
    $$('#segSplit .segbtn').forEach(b=>b.addEventListener('click',()=>setModalParts(b.dataset.parts)));
    $('#closeSplit').addEventListener('click',closeModal);
    $('#cancelSplit').addEventListener('click',closeModal);
    $('#applySplit').addEventListener('click',()=>{ selectedSplit=modalParts; $('#btnSplit').classList.add('on'); $('#btnOnce').classList.remove('on'); closeModal(); updateSplitHint(); updateSummary(); });

    // Référence courte basée sur le nom
    const slugRefFromName = (n)=>{
      const base=(n||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').toUpperCase().replace(/[^A-Z0-9]+/g,'').slice(0,16);
      if(base) return base;
      const short=orderId.replace('GF-','').split('-')[0];
      return 'GF'+short;
    };
    const syncRef=()=>{ const name=$('#name')?.value||''; $('#vref').value=slugRefFromName(name); };
    $('#name').addEventListener('input', syncRef);

    // Récap global
    const SHIPPING=0;
    function updateSummary(){
      const cart=getCart(); if(!cart.length){ renderMini(); return; }
      const sub=computeSub(cart);
      const promo=sub*promoRate();
      const total=Math.max(0, sub + SHIPPING - promo);
      const parts = selectedSplit;
      const amts=splitAmounts(total,parts);
      const dueNow=amts[0];

      $('#sub').textContent=EUR(sub);
      $('#benefit').textContent= promo>0 ? '–'+EUR(promo) : '—';
      $('#total').textContent=EUR(total);
      $('#dueNow').textContent=EUR(dueNow);

      const scheduleBox=$('#schedule');
      if(parts>1){
        const lines=scheduleLines(total, parts);
        scheduleBox.style.display='grid';
        scheduleBox.innerHTML = lines.map(l=>`<div class="sch"><span>${l.label} (${l.date})</span><span>${EUR(l.amt)}</span></div>`).join('');
      }else{
        scheduleBox.style.display='none';
      }

      if(currentPM()==='crypto'){
        $('#amountNow').value = dueNow.toFixed(2);
        const ccy=$('#ccy').value; const r=fx[ccy]?.rate||1;
        const amt=(dueNow/r);
        $('#ccyAmt').value = (amt>0?amt:0).toFixed(6).replace(/0+$/,'').replace(/\.$/,'');
      }
      if(currentPM()==='sepa'){
        $('#amountNowBank').value = dueNow.toFixed(2);
      }
    }
    function currentDueNow(){
      const cart=getCart(); const sub=computeSub(cart); const promo=sub*promoRate(); const total=Math.max(0, sub - promo);
      return splitAmounts(total, selectedSplit)[0]||0;
    }

    // Overlays
    const overlay = document.getElementById('checkOverlay');
    const ovTitle = document.getElementById('ovTitle');
    const ovSub = document.getElementById('ovSub');
    const showOverlay = (title, sub) => {
      ovTitle.textContent = title || 'Vérification…';
      ovSub.textContent = sub || 'Un instant, nous confirmons votre paiement.';
      overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');
    };
    const hideOverlay = () => { overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); };

    const doneOverlay = document.getElementById('doneOverlay');
    const showDone = () => { doneOverlay.classList.add('show'); doneOverlay.setAttribute('aria-hidden','false'); };

    // États de vérification
    let bankVerified=false, cryptoVerified=false;

    function updateCTA(){
      const pm=currentPM();
      const btn=$('#placeOrder');
      btn.disabled = (pm==='sepa' ? !bankVerified : pm==='crypto' ? !cryptoVerified : false);
    }

    // ---------- ENVOI WEBHOOK COMPATIBLE (JSON + QS alias) ----------
    function legacyMap(payload){
      return {
        order: payload.orderId,
        mode: payload.method,
        amount: payload.amount,
        reference: payload.ref || payload.txid || '',
        name: payload.name,
        email: payload.email,
        phone: payload.phone,
        address: payload.address,
        city: payload.city,
        zip: payload.zip,
        country: payload.country,
        txid: payload.txid || '',
        ccy: payload.ccy || ''
      };
    }
    function toQS(obj){
      return Object.entries(obj)
        .filter(([k,v])=> v!==undefined && v!==null && String(v).length<1800)
        .map(([k,v])=> `${encodeURIComponent(k)}=${encodeURIComponent(String(v))}`)
        .join('&');
    }
    async function postCompat(url, payload){
      const qs = toQS(legacyMap(payload));
      const full = qs ? `${url}?${qs}` : url;
      try{
        await fetch(full, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        return;
      }catch{}
      try{
        const fd = new FormData(); fd.append('_json', JSON.stringify(payload));
        await fetch(full, { method:'POST', body: fd });
        return;
      }catch{}
      try{
        await fetch(full, { method:'POST', mode:'no-cors', headers:{'Content-Type':'text/plain;charset=utf-8'}, body: JSON.stringify(payload) });
      }catch{}
    }
    function cartForWebhook(){
      try{
        const cart = JSON.parse(localStorage.getItem('gf_cart')||'[]');
        return cart.map(x=>({name:x.name, qty:Number(x.qty||1), price:Number(x.price||0)}));
      }catch{ return []; }
    }
    async function fileToBase64(file){
      const buf = await file.arrayBuffer();
      let binary=''; const bytes=new Uint8Array(buf); const chunk=0x8000;
      for(let i=0;i<bytes.length;i+=chunk){ binary += String.fromCharCode.apply(null, bytes.subarray(i,i+chunk)); }
      return btoa(binary);
    }
    async function sendCryptoToWebhook(dueNow){
      const payload = {
        orderId,
        method:'crypto',
        amount: Number(dueNow||0).toFixed(2),
        txid: $('#txid').value.trim(),
        ccy: $('#ccy').value,
        name: $('#name').value, email: $('#email').value, phone: $('#phone').value,
        address: $('#address').value, city: $('#city').value, zip: $('#zip').value, country: $('#country').value,
        cart: cartForWebhook(),
        ts_client: new Date().toISOString()
      };
      await postCompat(WEBHOOK_URL, payload);
    }
    async function sendSepaToWebhook(dueNow, proofFile){
      const payload = {
        orderId,
        method:'sepa',
        amount: Number(dueNow||0).toFixed(2),
        ref: $('#vref').value.trim(),
        name: $('#name').value, email: $('#email').value, phone: $('#phone').value,
        address: $('#address').value, city: $('#city').value, zip: $('#zip').value, country: $('#country').value,
        cart: cartForWebhook(),
        ts_client: new Date().toISOString()
      };
      if(proofFile){
        payload.file_name = proofFile.name;
        payload.mime_type = proofFile.type || 'application/octet-stream';
        payload.file_b64 = await fileToBase64(proofFile);
      }
      await postCompat(WEBHOOK_URL, payload);
    }

    // Init affichages
    renderMini(); updateSummary(); updateSplitHint(); setCryptoAddress($('#ccy').value); syncRef(); updateCTA();

    // Interactions tab méthodes
    $$('.m[role="tab"]').forEach(card=>{
      card.addEventListener('click', ()=>{
        $$('.m[role="tab"]').forEach(c=>c.setAttribute('aria-selected', String(c===card)));
        const m=card.dataset.method;
        $('#pmCrypto').classList.toggle('show', m==='crypto');
        $('#pmSEPA').classList.toggle('show', m==='sepa');
        if(m==='sepa'){ cryptoVerified=false; }
        if(m==='crypto'){ bankVerified=false; }
        updateSummary();
        updateCTA();
      });
    });

    // Split toggle
    $('#btnOnce').addEventListener('click',()=>{ selectedSplit=1; $('#btnOnce').classList.add('on'); $('#btnSplit').classList.remove('on'); updateSplitHint(); updateSummary(); });
    $('#btnSplit').addEventListener('click',()=>{ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); setModalParts(modalParts); updateModalPreview(); });

    // Crypto change
    $('#ccy').addEventListener('change', ()=>{ setCryptoAddress($('#ccy').value); updateSummary(); });

    // Copier
    const copySel=sel=>{const el=$(sel); if(!el) return; const txt=el.value||''; if(navigator.clipboard?.writeText){navigator.clipboard.writeText(txt).then(()=>toast('Copié'));} else {el.select(); document.execCommand('copy'); toast('Copié');}};
    $$('[data-copy]').forEach(b=>b.addEventListener('click',()=>copySel(b.getAttribute('data-copy'))));

    // Validation adresse
    function validateAddress(){
      const req=['name','email','address','city','zip'];
      for(const id of req){ const el=$('#'+id); if(!el || !el.value.trim()){ el?.focus(); toast('Veuillez compléter vos informations.'); return false; } }
      return true;
    }

    /* ====== Uploader (SEPA) — version robuste ====== */
    const MAX_SIZE = 10 * 1024 * 1024; // 10 Mo
    const dz = document.getElementById('dz');
    const input = document.getElementById('proofInput');
    const fileWrap = document.getElementById('fileWrap');
    const fileName = document.getElementById('fileName');
    const fileInfo = document.getElementById('fileInfo');
    const fileBar = document.getElementById('fileBar');
    const fileOk = document.getElementById('fileOk');
    const removeProof = document.getElementById('removeProof');
    const pickBtn = document.getElementById('pickProof');

    function fmtBytes(b){
      if(b===0) return '0 o';
      if(!b && b!==0) return '';
      const u=['o','Ko','Mo','Go']; let i=0;
      while(b>=1024 && i<u.length-1){ b/=1024; i++; }
      return b.toFixed(b<10&&i?1:0)+' '+u[i];
    }
    function reasonForRefusal(f){
      if(!f) return 'Aucun fichier détecté.';
      if(f.size === 0) return 'Fichier vide (0 octet).';
      if(f.size > MAX_SIZE) return 'Fichier trop volumineux (>10 Mo).';
      return '';
    }
    let proofFile = null;
    function showFile(f){
      proofFile = f;
      fileName.textContent = f.name || 'Fichier';
      fileInfo.textContent = `${f.type || 'Type inconnu'} • ${fmtBytes(f.size)}`;
      fileBar.style.width = '0%';
      fileOk.style.display = 'none';
      fileWrap.style.display = 'flex';
      let p = 0;
      const step = ()=> {
        p += Math.random()*35 + 20;
        if (p >= 100) { p = 100; fileBar.style.width = '100%'; fileOk.style.display = 'inline-flex'; return; }
        fileBar.style.width = p+'%';
        setTimeout(step, 150);
      };
      setTimeout(step, 150);
    }
    function clearFile(){
      proofFile = null;
      if (input) input.value = '';
      fileWrap.style.display = 'none';
    }
    if (removeProof) removeProof.addEventListener('click', clearFile);

    if (pickBtn) pickBtn.addEventListener('click', () => {
      if (!input) return;
      input.value = '';
      input.click();
    });
    if (dz) {
      dz.addEventListener('click', () => {
        if (!input) return;
        input.value = '';
        input.click();
      });
      dz.addEventListener('keydown', e => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); if (!input) return; input.value = ''; input.click(); }
      });
      ['dragenter','dragover'].forEach(ev => dz.addEventListener(ev, e => {
        e.preventDefault(); e.stopPropagation();
        dz.classList.add('over');
        if (e.dataTransfer) e.dataTransfer.dropEffect = 'copy';
      }));
      ['dragleave','drop'].forEach(ev => dz.addEventListener(ev, e => {
        e.preventDefault(); e.stopPropagation();
        dz.classList.remove('over');
      }));
      dz.addEventListener('drop', e => {
        let f = null;
        if (e.dataTransfer?.items && e.dataTransfer.items.length) {
          for (const item of e.dataTransfer.items) {
            if (item.kind === 'file') { f = item.getAsFile(); break; }
          }
        } else if (e.dataTransfer?.files && e.dataTransfer.files.length) {
          f = e.dataTransfer.files[0];
        }
        const reason = reasonForRefusal(f);
        if (reason) { toast(reason); return; }
        showFile(f);
      });
    }
    if (input) input.addEventListener('change', e => {
      const f = e.target.files && e.target.files[0];
      const reason = reasonForRefusal(f);
      if (reason) { toast(reason); input.value=''; return; }
      showFile(f);
    });
    /* ====== /Uploader robuste ====== */

    // Confirmer crypto : vérifie + ENVOIE au webhook
    document.getElementById('confirmCrypto').addEventListener('click', async ()=>{
      if(!validateAddress()) return;
      const tx = document.getElementById('txid').value.trim();
      if(!tx){ document.getElementById('txid').focus(); toast('TxID requis.'); return; }
      showOverlay('Vérification de la transaction crypto…', 'Nous validons le hash fourni.');
      const dueNow = currentDueNow();
      try{ await sendCryptoToWebhook(dueNow); }catch{}
      setTimeout(()=>{
        hideOverlay();
        cryptoVerified=true;
        updateCTA();
        toast('Transaction enregistrée — vous pouvez finaliser');
        $('#placeOrder').focus();
      }, 1200);
    });

    // Confirmer SEPA : vérifie + ENVOIE au webhook (avec pièce jointe)
    document.getElementById('confirmBank').addEventListener('click', async ()=>{
      if(!validateAddress()) return;
      if(!$('#vref').value.trim()){ syncRef(); }
      if(!proofFile){ dz.scrollIntoView({behavior:'smooth',block:'center'}); toast('Preuve de virement requise.'); return; }
      showOverlay('Vérification du virement…', 'Nous confirmons la réception auprès de la banque.');
      const dueNow = currentDueNow();
      try{ await sendSepaToWebhook(dueNow, proofFile); }catch{}
      setTimeout(()=>{
        hideOverlay();
        bankVerified=true;
        updateCTA();
        toast('Virement enregistré — vous pouvez finaliser');
        $('#placeOrder').focus();
      }, 1300);
    });

    // Finaliser la commande (stocke côté client + écran succès)
    document.getElementById('placeOrder').addEventListener('click', ()=>{
      if(!validateAddress()) return;
      const cart=getCart(); if(!cart.length){ toast('Votre panier est vide.'); return; }
      const pm=currentPM();
      if(pm==='crypto' && !cryptoVerified){ toast('Veuillez terminer la vérification crypto.'); return; }
      if(pm==='sepa' && !bankVerified){ toast('Veuillez terminer la vérification du virement.'); return; }

      const sub=computeSub(cart), promo=sub*promoRate(), total=Math.max(0, sub - promo);
      const order={
        id:orderId, date:new Date().toISOString(), status:'En préparation',
        items:cart, pricing:{sub,ship:0,promo,total,currency:'EUR'},
        shipping:{name:$('#name').value,email:$('#email').value,phone:$('#phone').value,address:$('#address').value,city:$('#city').value,zip:$('#zip').value,country:$('#country').value},
        payment:{
          method:pm, split:selectedSplit,
          details: pm==='crypto'
            ? {ccy:$('#ccy').value,address:$('#wallet').value,txid:$('#txid').value,amountNow:$('#amountNow').value}
            : {iban:$('#iban').value,ref:$('#vref').value,amountNow:$('#amountNowBank').value,proofName:proofFile?.name||''}
        }
      };
      try{ const all=JSON.parse(localStorage.getItem('gf_orders')||'[]'); all.push(order); localStorage.setItem('gf_orders', JSON.stringify(all)); }catch{}

      setCart([]);
      showDone();
    });

    // Fermer modal en cliquant le fond
    document.getElementById('splitModal').addEventListener('click',e=>{ if(e.target.id==='splitModal') e.currentTarget.classList.remove('show'); });

    // Init
    renderMini();
    updateSummary();
  })();
  </script>
</body>
</html>
