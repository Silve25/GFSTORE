<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>GF Store — Liste produits (simple)</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:0;padding:20px;background:#f6f7fb}
    h1{margin:0 0 16px}
    #status{margin:8px 0 16px;color:#444}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:12px}
    .card img{width:100%;height:150px;object-fit:contain;background:#fafafa;border-radius:8px}
    .title{font-weight:600;margin:8px 0 4px}
    .price{font-weight:700}
    .muted{color:#6b7280;font-size:.9rem}
  </style>
</head>
<body>
  <h1>GF Store — Produits</h1>
  <div id="status">Chargement…</div>
  <div id="grid" class="grid"></div>

  <script>
    // 1) Essaie JSON à la racine de ton repo
    const CANDIDATES = [
      'data/products.json',       // <-- mets ton fichier ici
      './data/products.json',
      'produits.json',
      './produits.json'
    ];

    // Helpers pour récupérer les champs même si les noms varient
    const g = (o, keys) => {
      for (const k of keys) { if (o && o[k] != null) return o[k]; }
      return undefined;
    };

    async function loadProducts() {
      const status = document.getElementById('status');

      // 1) Tenter JSON
      for (const url of CANDIDATES) {
        try {
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) continue;
          const data = await res.json();
          const products = Array.isArray(data) ? data : (Array.isArray(data.products) ? data.products : null);
          if (products) {
            console.log('Produits chargés depuis', url);
            status.textContent = `OK: chargés depuis ${url}`;
            return products;
          }
        } catch(e) {/* essaie suivant */}
      }

      // 2) Fallback (optionnel) : si tu tiens à rester en .js qui pose problème,
      //    tu peux créer un fichier data/products-global.js qui définit window.PRODUCTS,
      //    puis décommenter le bloc ci-dessous pour l’injecter dynamiquement.
      /*
      try {
        await new Promise((resolve, reject)=>{
          const s=document.createElement('script');
          s.src='data/products-global.js'; // ce fichier DOIT faire: window.PRODUCTS = [ ... ];
          s.onload=()=>resolve();
          s.onerror=()=>reject(new Error('Echec chargement products-global.js'));
          document.head.appendChild(s);
        });
        if (Array.isArray(window.PRODUCTS)) {
          status.textContent = 'OK: chargés depuis data/products-global.js';
          return window.PRODUCTS;
        }
      } catch(e) {}
      */

      status.textContent = 'Échec du chargement des produits (aucun JSON valide trouvé).';
      throw new Error('Aucun fichier JSON valide trouvé');
    }

    function render(products){
      const grid = document.getElementById('grid');
      grid.innerHTML = '';

      products.forEach(p=>{
        const name = g(p, ['Nom du Produit','name','title']) || 'Sans nom';
        const price = g(p, ['Prix (€)','price','prix']);
        const category = g(p, ['Catégorie','category']);
        const images = g(p, ['Images','images']) || [];
        const imageUrl = g(p, ['Image URL','image','image_url']) || images[0] || 'assets/img/opengraph-default.jpg';

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${imageUrl}" alt="">
          <div class="title">${name}</div>
          <div class="muted">${category || ''}</div>
          <div class="price">${(typeof price === 'number') ? price.toFixed(2).replace('.',',')+' €' : (price || '')}</div>
        `;
        grid.appendChild(card);
      });

      if (products.length === 0) {
        document.getElementById('status').textContent = 'Aucun produit à afficher.';
      }
    }

    (async function(){
      try {
        const products = await loadProducts();
        render(products);
      } catch (e) {
        console.error(e);
      }
    })();
  </script>
</body>
</html>
