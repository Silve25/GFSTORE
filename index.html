<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GF Store — Produits (simple)</title>
  <style>
    body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial; margin:16px;}
    h1{margin:0 0 10px}
    #status{margin:0 0 12px; color:#555}
    .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:12px}
    .card{border:1px solid #ddd; border-radius:8px; padding:10px}
    .card img{width:100%; height:150px; object-fit:contain; background:#f5f5f5; border-radius:6px}
    .name{font-weight:600; margin:8px 0 4px}
    .muted{color:#666; font-size:0.9rem; margin-bottom:6px}
    .price{font-weight:700}
  </style>
</head>
<body>
  <h1>Produits</h1>
  <div id="status">Chargement…</div>
  <div id="grid" class="grid"></div>

  <script type="module">
    // ⚠️ Nécessite data/products.js avec: export default PRODUCTS;
    import PRODUCTS from './data/products.js';

    const grid = document.getElementById('grid');
    const status = document.getElementById('status');

    // Image de secours déjà présente dans ton repo
    const FALLBACK = 'assets/img/opengraph-default.jpg';

    // Renvoie une image "propre" à partir des champs possibles
    function pickImage(p){
      // priorité à p.image, sinon 1ère de p.images, sinon colonnes Excel, sinon fallback
      const candidates = [];
      if (typeof p.image === 'string') candidates.push(p.image);
      if (Array.isArray(p.images)) candidates.push(...p.images);
      if (typeof p.imageUrl === 'string') candidates.push(p.imageUrl);
      if (typeof p['Image URL'] === 'string') candidates.push(p['Image URL']);

      for (const raw of candidates){
        if (!raw || typeof raw !== 'string') continue;
        const u = raw.trim();
        // http(s) direct
        if (/^https?:\/\//i.test(u)) return u;
        // chemins locaux → garder la partie "assets/..."
        if (u.includes('assets/')) return u.slice(u.indexOf('assets/'));
        if (u.includes('\\assets\\')) return u.slice(u.indexOf('\\assets\\')).replaceAll('\\','/');
        // anciens file:///C:/.../gf-store/assets/... → "assets/..."
        if (/^file:\/\//i.test(u) && u.toLowerCase().includes('/gf-store/')){
          const rest = u.slice(u.toLowerCase().indexOf('/gf-store/') + '/gf-store/'.length);
          if (rest.startsWith('assets/')) return rest;
        }
      }
      return FALLBACK;
    }

    function euro(v){
      if (typeof v === 'number' && Number.isFinite(v)) return v.toFixed(2).replace('.', ',') + ' €';
      if (typeof v === 'string' && v.trim() !== '') return v;
      return '—';
    }

    // Récupère le tableau depuis products.js (sans injecter de faux produits)
    const data = Array.isArray(PRODUCTS) ? PRODUCTS
                : (Array.isArray(PRODUCTS?.products) ? PRODUCTS.products : []);

    let shown = 0;
    let skipped = 0;

    data.forEach(p=>{
      if (!p || typeof p !== 'object'){ skipped++; return; }
      const name = p.name || p['Nom du Produit'] || p.title || p.slug || '';
      if (!name){ skipped++; return; }

      const price = (p.price ?? p['Prix (€)'] ?? p.promoPrice ?? p['Prix Promo (€)']);
      const img = pickImage(p);
      const brand = p.brand || p['Marque'] || '';
      const model = p.model || p['Modèle'] || '';
      const category = p.category || p['Catégorie'] || '';

      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${img}" alt="">
        <div class="name">${name}</div>
        <div class="muted">${brand} ${model}</div>
        <div class="muted">${category}</div>
        <div class="price">${euro(Number(price))}</div>
      `;
      grid.appendChild(card);
      shown++;
    });

    status.textContent = `Affichés: ${shown} • Ignorés: ${skipped}`;
    if (skipped > 0) {
      console.warn('Certains items ont été ignorés (ex: nom manquant ou entrée non-objet). Compteur ignorés =', skipped);
    }
  </script>
</body>
</html>
