<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SAMSUNG Galaxy S24 Ultra Ambre 1To â€” GF Store</title>
  <style>
    :root{--w:1200px;--c:#0f172a;--a:#2563eb;--g:#10b981;--bg:#f5f7fb;--r:16px}
    *{box-sizing:border-box} body{margin:0;font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;color:var(--c);background:var(--bg)}
    a{color:inherit}
    header{position:sticky;top:0;z-index:50;background:#fff;backdrop-filter:saturate(140%) blur(4px);border-bottom:1px solid #e5e7eb}
    .hwrap{max-width:var(--w);margin:auto;padding:10px 12px;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .brand .logo{height:40px;width:auto;display:block}
    .nav{display:flex;gap:10px;align-items:center}
    .nav a,.iconbtn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid #e5e7eb;background:#fff;border-radius:12px;text-decoration:none;color:inherit;box-shadow:0 1px 0 rgba(0,0,0,.02)}
    .nav a:hover,.iconbtn:hover{box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .iconbtn{cursor:pointer}
    .ic{width:16px;height:16px;display:inline-block}
    .dropdown{position:relative}
    .menu{position:absolute;right:0;top:calc(100% + 8px);background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:6px;min-width:220px;box-shadow:0 10px 24px rgba(0,0,0,.12);display:none;z-index:60}
    .menu.show{display:block}
    .menu a{display:block;padding:8px 10px;border-radius:8px;text-decoration:none}
    .menu a:hover{background:#f3f4f6}

    .banner{background:linear-gradient(90deg,#1e3a8a,#2563eb,#0ea5e9);color:#fff;text-align:center;padding:10px 14px}
    .banner .timer{font-weight:700;border-radius:999px;padding:2px 8px;background:rgba(255,255,255,.15);display:inline-block}
    .banner .sep{opacity:.6;padding:0 6px}

    .pwrap{max-width:var(--w);margin:10px auto 24px;padding:0 12px;display:grid;gap:16px;grid-template-columns:1.1fr 1fr}
    .gallery{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:10px;display:grid;gap:10px}
    .gmain{border:1px solid #e5e7eb;border-radius:14px;display:grid;place-items:center;padding:10px;background:#fff}
    .gmain img{max-width:100%;max-height:520px;width:auto;height:auto;display:block;border-radius:10px}
    .thumbs{display:flex;gap:10px;overflow:auto}
    .thumbs button{border:1px solid #e5e7eb;background:#fff;border-radius:10px;padding:4px;cursor:pointer;min-width:70px}
    .thumbs img{width:64px;height:64px;object-fit:cover;border-radius:8px;display:block}

    .pinfo{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:12px;display:flex;flex-direction:column;gap:10px}
    .title{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    h1{font-size:20px;margin:0}
    .rating{display:inline-flex;align-items:center;gap:6px;font-size:12px}
    .stars{--s:16px;display:inline-grid;grid-auto-flow:column;gap:2px}
    .stars i{width:var(--s);height:var(--s);background:linear-gradient(180deg,#fbbf24,#f59e0b);mask:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 17.27 18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg>') no-repeat center/contain;display:block;opacity:.9}
    .brandchip{font-size:11px;padding:2px 6px;border-radius:999px;background:#f1f5f9;border:1px solid #e5e7eb}

    .pricebox{display:flex;align-items:baseline;gap:10px}
    .price{font-size:22px;font-weight:800}
    .del{opacity:.55;text-decoration:line-through}
    .badge{background:var(--g);color:#fff;border-radius:999px;padding:2px 8px;font-size:12px}

    .opts{display:grid;gap:10px}
    .opt-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .opt-row strong{min-width:120px}
    .pill{border:2px solid #e5e7eb;border-radius:12px;padding:10px 14px;cursor:pointer;background:#fff;min-width:96px;display:inline-flex;align-items:center;justify-content:center;font-weight:600;transition:box-shadow .15s,border-color .15s,transform .06s}
    .pill:hover{box-shadow:0 6px 16px rgba(0,0,0,.06)}
    .pill:active{transform:translateY(1px)}
    .pill[aria-checked="true"]{border-color:var(--a);box-shadow:0 0 0 3px rgba(37,99,235,.15);background:#f8fbff}
    .pill:focus-visible{outline:2px solid var(--a);outline-offset:2px}

    .cta{display:grid;gap:10px}
    .cta .btn{position:relative;z-index:2;display:inline-flex;align-items:center;gap:8px;justify-content:center;width:100%;text-align:center;padding:12px;border:0;border:1px solid #1e40af;background:linear-gradient(180deg,#2563eb,#1e40af);color:#fff;border-radius:12px;cursor:pointer;box-shadow:0 6px 14px rgba(30,64,175,.25);text-decoration:none}
    .cta .btn:hover{transform:translateY(-1px);box-shadow:0 10px 22px rgba(30,64,175,.28);text-decoration:none}
    .cta .btn:focus-visible{outline:2px solid var(--a);outline-offset:2px;text-decoration:none}
    .btn.paynow{font-size:16px;padding:14px 16px;border:1px solid #0f766e;background:linear-gradient(180deg,#10b981,#047857)}
    .trust{display:grid;gap:6px;font-size:12px}
    .trust .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .trust .row span{display:inline-flex;align-items:center;gap:6px;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;background:#fff}

    .tabs{max-width:var(--w);margin:0 auto 18px;padding:0 12px}
    .tabheads{display:flex;gap:8px;border-bottom:1px solid #e5e7eb}
    .tabheads button{border:1px solid #e5e7eb;border-bottom:none;background:#fff;border-radius:12px 12px 0 0;padding:8px 12px;cursor:pointer}
    .tabheads button[aria-selected="true"]{background:#f8fbff}
    .tab{display:none;background:#fff;border:1px solid #e5e7eb;border-top:none;border-radius:0 0 12px 12px;padding:12px}
    .tab.show{display:block}
    .specs{display:grid;grid-template-columns:1fr 2fr;gap:8px}
    .specs div{padding:6px 8px;border-bottom:1px dashed #e5e7eb}
    .rev{border-bottom:1px dashed #e5e7eb;padding:10px 0}
    .rv-head{display:flex;gap:8px;align-items:center;font-size:13px}
    .rv-stars{letter-spacing:2px;opacity:.9}
    .rv-date{margin-left:auto;opacity:.6;font-size:12px}

    .rel{max-width:var(--w);margin:0 auto 32px;padding:0 12px}
    .rel h3{margin:10px 0}
    .grid{display:grid;gap:14px;grid-template-columns:repeat(auto-fill,minmax(220px,1fr))}
    .card{position:relative;background:#fff;border:1px solid #e5e7eb;border-radius:16px;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 1px 0 rgba(0,0,0,.02)}
    .card .hit{position:absolute;inset:0}
    .img{aspect-ratio:1/1;background:#fff;display:grid;place-items:center;padding:10px;border:1px solid #e5e7eb;border-radius:14px;margin:10px}
    .img img{width:100%;height:100%;object-fit:cover;border-radius:12px;border:1px solid #e5e7eb;background:#fff}
    .box{padding:12px}

    .fab{position:fixed;right:16px;bottom:16px;z-index:10000;background:linear-gradient(180deg,#2563eb,#1e40af);color:#fff;border:0;border-radius:999px;display:inline-flex;align-items:center;gap:8px;padding:12px 14px;box-shadow:0 12px 28px rgba(30,64,175,.35);cursor:pointer;text-decoration:none}
    .fab .badge{min-width:18px;border-radius:999px;background:#111;color:#fff;padding:2px 6px;font-size:12px}
    .fab img.ic{filter:invert(1)}

    .panel{position:fixed;inset:0;display:none;background:rgba(0,0,0,.45);backdrop-filter:blur(2px);z-index:10010}
    .panel.show{display:block}
    .sheet{position:absolute;right:0;top:0;height:100%;width:min(420px,95%);background:#fff;border-left:1px solid #e5e7eb;display:flex;flex-direction:column;transform:translateX(100%);transition:transform .25s ease}
    .panel.show .sheet{transform:translateX(0)}
    .sheet header{margin:0;padding:12px;border-bottom:1px solid #e5e7eb;display:flex;justify-content:space-between;align-items:center}
    .sheet .items{padding:12px;overflow:auto;display:flex;flex-direction:column;gap:10px}
    .ci{display:grid;grid-template-columns:72px 1fr auto;gap:8px;border:1px solid #e5e7eb;border-radius:12px;padding:8px}
    .ci img{width:72px;height:72px;object-fit:cover;border-radius:8px;background:#f1f5f9}
    .qty{display:flex;align-items:center;gap:6px}
    .qty button{border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:2px 6px;cursor:pointer;font-size:12px}
    .sum{margin-top:auto;border-top:1px solid #e5e7eb;padding:12px;display:flex;justify-content:space-between;align-items:center}
    .checkout{display:inline-flex;align-items:center;gap:8px;background:var(--a);color:#fff;text-decoration:none;padding:10px 14px;border-radius:12px}
    .x{cursor:pointer;border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:6px}
    .ic-sm{width:12px;height:12px}
    body.lock{overflow:hidden}

    footer{background:#fff;border-top:1px solid #e5e7eb}
    .fwrap{max-width:var(--w);margin:0 auto;padding:16px 12px;display:flex;flex-wrap:wrap;gap:10px;justify-content:space-between;align-items:center;font-size:12px}

    .mobile-only{display:none}
    .desktop-only{display:initial}
    @media (max-width:860px){
      .pwrap{grid-template-columns:1fr}
      .brand .logo{height:22px}
      .thumbs{gap:8px}
      .thumbs img{width:56px;height:56px}
      .gmain img{max-height:380px}
      .desktop-only{display:none!important}
      .mobile-only{display:block}
    }
  </style>
</head>
<body>
  <div class="banner">ðŸŽ‰ Promo spÃ©ciale rentrÃ©e : <b>-25% Ã  -30%</b> sur PC, tÃ©lÃ©phones et consoles <span class="sep">â€¢</span> <span id="countdown" class="timer" aria-live="polite"></span></div>

  <header>
    <div class="hwrap">
      <a href="https://silve25.github.io/GFSTORE/" class="brand">
        <img src="https://silve25.github.io/GFSTORE/assets/img/logopnggfstore.png" class="logo" alt="GF Store" width="180" height="52" decoding="async">
      </a>
      <nav class="nav">
        <a href="../compte/index.html"><img class="ic" id="icUser" alt=""> Compte</a>
        <a id="cartBtn" class="iconbtn" href="../checkout.html"><img id="cartIcon" class="ic" alt=""> Panier</a>
        <div class="dropdown">
          <button class="iconbtn" id="menuBtn" aria-label="Menu"><img class="ic" id="icMenu" alt=""></button>
          <div id="menuDrop" class="menu">
            <a href="../pages/a-propos.html">Ã€ propos</a>
            <a href="../pages/cgv.html">CGV</a>
            <a href="../pages/mentions-legales.html">Mentions lÃ©gales</a>
            <a href="../pages/confidentialite.html">Politique de confidentialitÃ©</a>
            <a href="../pages/contact.html">Contact</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <section class="pwrap" id="pwrap" aria-live="polite">
    <div class="gallery">
      <div class="gmain"><img id="gMain" alt="SAMSUNG Galaxy S24 Ultra Ambre 1To" loading="eager" fetchpriority="high"></div>
      <div class="thumbs" id="thumbs"></div>
    </div>
    <aside class="pinfo">
      <div class="title">
        <h1 id="pName">SAMSUNG Galaxy S24 Ultra Ambre 1To</h1>
        <span class="brandchip" id="pBrand">Samsung</span>
        <span class="rating"><span class="stars" id="pStars"></span><span id="pRatingText"></span></span>
      </div>

      <div class="pricebox">
        <div class="price" id="pPrice">0 â‚¬</div>
        <div class="del" id="pDel"></div>
        <span class="badge" id="pBadge"></span>
      </div>
      <div id="stockInfo" style="font-size:12px"></div>

      <div class="opts" id="opts"></div>

      <div class="cta">
        <button id="addBtn" class="btn"><img class="ic" id="icBuy" alt=""> Ajouter au panier</button>
        <div class="trust">
          <div class="row">
            <span><img class="ic" id="icTruck" alt=""> Livraison en 1 semaine</span>
            <span><img class="ic" id="icReturn" alt=""> Retours 14 jours</span>
            <span><img class="ic" id="icRefund" alt=""> Remboursement garanti</span>
            <span><img class="ic" id="ic4x" alt=""> Paiement en 4x</span>
          </div>
          <a id="payNowBtn" href="../checkout.html" class="btn paynow"><img class="ic" id="icPayNow" alt=""> Payer maintenant</a>
        </div>
      </div>
    </aside>
  </section>

  <section class="tabs" id="tabs">
    <div class="tabheads" role="tablist">
      <button role="tab" aria-selected="true" aria-controls="tab-desc" id="th-desc">Description</button>
      <button role="tab" aria-selected="false" aria-controls="tab-spec" id="th-spec">SpÃ©cifications</button>
      <button role="tab" aria-selected="false" aria-controls="tab-rev" id="th-rev">Avis</button>
    </div>
    <div class="tab show" id="tab-desc" role="tabpanel" aria-labelledby="th-desc"></div>
    <div class="tab" id="tab-spec" role="tabpanel" aria-labelledby="th-spec">
      <div class="specs" id="specs"></div>
    </div>
    <div class="tab" id="tab-rev" role="tabpanel" aria-labelledby="th-rev">
      <div id="reviews"></div>
    </div>
  </section>

  <section class="rel" id="rel">
    <h3>Produits similaires</h3>
    <div class="grid" id="relGrid"></div>
  </section>

  <!-- Mini fenÃªtre panier -->
  <div id="cartPanel" class="panel" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-label="Mon panier">
      <header>
        <strong>Mon panier</strong>
        <button id="closeCart" class="x" aria-label="Fermer">âœ•</button>
      </header>
      <div id="cartItems" class="items"></div>
      <div class="sum">
        <div>Total <strong id="cartTotal">0 â‚¬</strong></div>
        <a href="../checkout.html" class="checkout"><img class="ic" id="icCheckout" alt=""> Effectuer un paiement</a>
      </div>
    </div>
  </div>

  <!-- Bulle panier -->
  <button id="fabCart" class="fab" type="button" aria-label="Ouvrir le panier">
    <img class="ic" id="icFabCart" alt=""> <span id="fabCount" class="badge">0</span>
  </button>

  <footer>
    <div class="fwrap">
      <div>Â© GF Store 2025 â€” SimplicitÃ©, sÃ©curitÃ©, crypto-friendly.</div>
      <nav>
        <a href="../pages/a-propos.html">Ã€ propos</a> Â· 
        <a href="../pages/cgv.html">CGV</a> Â· 
        <a href="../pages/mentions-legales.html">Mentions lÃ©gales</a> Â· 
        <a href="../pages/confidentialite.html">ConfidentialitÃ©</a> Â· 
        <a href="../pages/contact.html">Contact</a>
      </nav>
    </div>
  </footer>

  <script>
  (async()=>{
    // ---- Compte Ã  rebours (48h)
    const countdownEl=document.getElementById('countdown');
    const SALE_END=new Date(Date.now()+48*60*60*1000);
    const two=n=>String(n).padStart(2,'0');
    function tick(){
      if(!countdownEl) return;
      const now=new Date(); let diff=SALE_END-now;
      if(diff<=0){countdownEl.textContent='DerniÃ¨res heures !';return}
      const d=Math.floor(diff/86400000); diff%=86400000;
      const h=Math.floor(diff/3600000); diff%=3600000;
      const m=Math.floor(diff/60000); const s=Math.floor((diff%60000)/1000);
      countdownEl.textContent=`${d?d+'j ':''}${two(h)}:${two(m)}:${two(s)} restants`;
    }
    tick(); setInterval(tick,1000);

    // ---- IcÃ´nes
    const ICONS = {
      buy:'https://img.icons8.com/?size=100&id=ditUhfRlUOQg&format=png&color=000000',
      cart:'https://img.icons8.com/?size=100&id=AaWM1DnCz2bQ&format=png&color=000000',
      cartFull:'https://img.icons8.com/?size=100&id=K5Jv3BfpxPYa&format=png&color=000000',
      checkout:'https://img.icons8.com/?size=100&id=qVsd2YOgeizO&format=png&color=000000',
      truck:'https://img.icons8.com/?size=100&id=plGFB4oatud2&format=png&color=000000',
      logout:'https://img.icons8.com/?size=100&id=IKneRwT2PRjz&format=png&color=000000',
      user:'https://img.icons8.com/?size=100&id=n8DrUm77sR3l&format=png&color=000000',
      menu:'https://img.icons8.com/?size=100&id=RzDomvpIKGI9&format=png&color=000000',
      trash:'https://img.icons8.com/?size=100&id=xGanKhWh8MxC&format=png&color=000000',
      fourx:'https://img.icons8.com/?size=100&id=3c0Tk1f266bf&format=png&color=000000',
      ssl:'https://img.icons8.com/?size=100&id=2FIgZJEL88pu&format=png&color=000000',
      refund:'https://img.icons8.com/?size=100&id=lRNQ5N7CjFht&format=png&color=000000',
      search:'https://img.icons8.com/?size=100&id=7964&format=png&color=000000'
    };
    const setSrc=(id,src)=>{const el=document.getElementById(id); if(el) el.src=src};
    setSrc('icUser',ICONS.user); setSrc('icMenu',ICONS.menu); setSrc('icBuy',ICONS.buy);
    setSrc('icTruck',ICONS.truck); setSrc('icReturn',ICONS.logout); setSrc('icRefund',ICONS.refund); setSrc('ic4x',ICONS.fourx);
    setSrc('icPayNow',ICONS.checkout); setSrc('icFabCart',ICONS.cart); setSrc('icCheckout', ICONS.checkout);

    // ---- Menu
    const menuBtn=document.getElementById('menuBtn'); const menuDrop=document.getElementById('menuDrop');
    if(menuBtn&&menuDrop){
      menuBtn.addEventListener('click',e=>{e.stopPropagation();menuDrop.classList.toggle('show')});
      document.addEventListener('click',e=>{ if(!menuDrop.contains(e.target) && e.target!==menuBtn) menuDrop.classList.remove('show'); });
    }

    // ---- Panier (localStorage)
    const KEY='gf_cart';
    const getCart=()=>{try{return JSON.parse(localStorage.getItem(KEY)||'[]')}catch{return[]}};
    const setCart=arr=>{localStorage.setItem(KEY,JSON.stringify(arr)); updateCartCount(); if(typeof renderCart==='function'){renderCart();}};
    const cartCount=()=>getCart().reduce((s,x)=>s+x.qty,0);
    const updateCartCount=()=>{
      const count=cartCount();
      const icon=document.getElementById('cartIcon'); if(icon) icon.src=count>0?ICONS.cartFull:ICONS.cart;
      const fbc=document.getElementById('fabCount'); if(fbc) fbc.textContent=count;
      const fbi=document.getElementById('icFabCart'); if(fbi) fbi.src=count>0?ICONS.cartFull:ICONS.cart;
    };

    // ---- Root GitHub Pages + fix images locales
    const GH_ROOT = (()=>{ const parts = location.pathname.split('/').filter(Boolean); return (location.host.endsWith('github.io') && parts.length) ? `/${parts[0]}/` : '/'; })();
    const fixImg=(src)=>src && src.startsWith('assets/') ? (GH_ROOT+src) : src;

    // ---- Helpers
    function getProductId(){
      const q=new URLSearchParams(location.search);
      if(q.get('id')) return String(q.get('id'));
      const fname=(location.pathname.split('/').pop()||'').toLowerCase();
      const m=fname.match(/-(\d+)\.html?$/);
      return m?m[1]:null;
    }
    const slugify=str=>String(str||'').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

    // ---- Chargement du catalogue
    async function loadProducts(){
      const urls=[
        '../data/products.json',
        GH_ROOT+'data/products.json',
        GH_ROOT+'products.json',
        'https://silve25.github.io/GFSTORE/data/products.json'
      ];
      for(const u of urls){
        try{
          const r=await fetch(u,{cache:'no-store'});
          if(r.ok){ return await r.json(); }
        }catch(e){}
      }
      return null;
    }

    // ---- Fallback produit (SAMSUNG Galaxy S24 Ultra Ambre 1To)
    const fallback={
      id:"1032",
      sku:"GF-SAMSUNG-GALAXY-S24-ULTRA-AMBRE-1TO-031",
      name:"SAMSUNG Galaxy S24 Ultra Ambre 1To",
      category:"Smartphone",
      brand:"Samsung",
      model:"SAMSUNG Galaxy S24 Ultra Ambre 1To",
      description:"SAMSUNG Galaxy S24 Ultra Ambre 1To â€” Un concentrÃ© de puissance et de photo pour votre quotidien. Pourquoi vous allez lâ€™adorer : Ã©cran haute rÃ©solution â€¢ appareil photo avancÃ© â€¢ batterie longue durÃ©e â€¢ 5G. Promo spÃ©ciale rentrÃ©e : -25 % Ã  -30 % sur PC, tÃ©lÃ©phones et consoles* â€” Stock limitÃ© : profitez-en tant que câ€™est disponible. GF Store : paiement sÃ©curisÃ© (CB) + crypto acceptÃ©es (rapide, pratique, quasi anonyme) ; livraison sous 1 semaine maximum ; retours acceptÃ©s sous 14 jours ; remboursement garanti sur produits neufs. Avantages GF Store : SimplicitÃ© et sÃ©curitÃ© dâ€™achat â€¢ Tarifs compÃ©titifs â€¢ FlexibilitÃ© des paiements.",
      price:1809.0,
      promoPrice:1158.99,
      stock:25,
      images:[
        "https://boulanger.scene7.com/is/image/Boulanger/8806095414317_h_f_l_0?wid=1016&hei=1016&resMode=sharp2&op_usm=1.75",
        "https://boulanger.scene7.com/is/image/Boulanger/8806095414317_h_f_l_1?wid=1016&hei=1016&resMode=sharp2&op_usm=1.75",
        "https://boulanger.scene7.com/is/image/Boulanger/8806095414317_h_f_l_2?wid=1016&hei=1016&resMode=sharp2&op_usm=1.75",
        "https://boulanger.scene7.com/is/image/Boulanger/8806095414317_h_f_l_3?wid=1016&hei=1016&resMode=sharp2&op_usm=1.75",
        "https://boulanger.scene7.com/is/image/Boulanger/8806095414317_h_r_l_0?wid=1016&hei=1016&resMode=sharp2&op_usm=1.75",
        "https://boulanger.scene7.com/is/image/Boulanger/8806095414317_h_r_l_1?wid=1016&hei=1016&resMode=sharp2&op_usm=1.75",
        "https://boulanger.scene7.com/is/image/Boulanger/8806095414317_h_b_l_0?wid=1016&hei=1016&resMode=sharp2&op_usm=1.75"
      ],
      imageCover:"https://boulanger.scene7.com/is/image/Boulanger/8806095414317_h_f_l_0?wid=1016&hei=1016&resMode=sharp2&op_usm=1.75",
      supplier:"Distributeur EU",
      cost:1302.48,
      marginPct:-12.38,
      status:"En stock",
      createdAt:"2025-08-16T00:00:00",
      warrantyMonths:24,
      rating:4.5,
      ratingCount:0,
      options:{
        "Stockage":[
          {"value":"128 Go","priceDelta":0},
          {"value":"256 Go","priceDelta":100},
          {"value":"512 Go","priceDelta":250},
          {"value":"1 To","priceDelta":400}
        ],
        "Couleur":[
          {"value":"Noir","priceDelta":0},
          {"value":"Blanc","priceDelta":0},
          {"value":"Bleu","priceDelta":0},
          {"value":"Titane","priceDelta":200}
        ],
        "Garantie":[
          {"value":"24 mois","priceDelta":0},
          {"value":"36 mois","priceDelta":80}
        ]
      }
    };

    // ---- RÃ©cupÃ©ration produit
    const dataset = await loadProducts();
    const pid = getProductId() || fallback.id;
    let product = fallback;
    if(Array.isArray(dataset)){
      const found = dataset.find(p=>String(p.id||p.sku||p._id)===String(pid));
      if(found) product={...fallback,...found};
    }

    // ---- Rendu produit
    const EUR=v=>Number(v).toLocaleString('fr-FR',{style:'currency',currency:'EUR'});
    const gMain=document.getElementById('gMain');
    const thumbs=document.getElementById('thumbs');
    const pName=document.getElementById('pName');
    const pBrand=document.getElementById('pBrand');
    const pPrice=document.getElementById('pPrice');
    const pDel=document.getElementById('pDel');
    const pBadge=document.getElementById('pBadge');
    const stockInfo=document.getElementById('stockInfo');

    pName.textContent=product.name;
    pBrand.textContent=product.brand||'';

    const imgs=(product.images&&product.images.length?product.images:[product.imageCover]).filter(Boolean).map(fixImg);
    gMain.src=imgs[0]; gMain.alt=product.name;
    thumbs.innerHTML=imgs.map((src,i)=>`<button data-i="${i}" aria-label="Voir image ${i+1}"><img loading="lazy" decoding="async" src="${src}" alt="${product.name} ${i+1}"></button>`).join('');
    thumbs.addEventListener('click',e=>{
      const b=e.target.closest('button[data-i]'); if(!b) return;
      const i=Number(b.dataset.i); gMain.src=imgs[i];
    });

    // Avis (exemple)
    const stars=document.getElementById('pStars'); const rTxt=document.getElementById('pRatingText');
    const reviews=[
      {name:'Nora â€” Lyon, FR',stars:5,date:'2025-08-18',text:"Photos superbes et batterie qui tient la journÃ©e. TrÃ¨s satisfait.e."},
      {name:'Idriss â€” Lausanne, CH',stars:4,date:'2025-08-17',text:"Bel Ã©cran, perf au top. Bon prix en promo."},
      {name:'Camille â€” Paris, FR',stars:5,date:'2025-08-16',text:"1 To câ€™est royal, envoi rapide."}
    ];
    const avg=reviews.reduce((s,r)=>s+r.stars,0)/reviews.length;
    const full=Math.round(avg);
    stars.innerHTML=Array.from({length:5},(_,i)=>'<i style="opacity:'+(i<full?1:.2)+'"></i>').join('');
    rTxt.textContent=avg.toFixed(1)+' / 5 ('+reviews.length+' avis)';
    document.getElementById('reviews').innerHTML=reviews.map(r=>`<div class="rev"><div class="rv-head"><strong>${r.name}</strong><span class="rv-stars">${'â˜…'.repeat(r.stars)}${'â˜†'.repeat(5-r.stars)}</span><span class="rv-date">${r.date}</span></div><p>${r.text}</p></div>`).join('');

    // Prix + remise
    const promoActive = Number.isFinite(product.promoPrice)&&product.promoPrice>0&&product.promoPrice<product.price;
    let base = promoActive ? product.promoPrice : product.price;
    const disc = promoActive ? Math.round((1-(base/product.price))*100) : 0;
    pPrice.textContent = EUR(base);
    pDel.textContent   = promoActive ? EUR(product.price) : '';
    pBadge.textContent = promoActive ? `-${disc}%` : '';

    // Stock
    stockInfo.innerHTML=product.stock>0?`<span style="color:#16a34a">En stock</span> â€¢ ${product.stock} piÃ¨ces`:`<span style="color:#dc2626">Rupture</span>`;

    // ---- Options dynamiques
    const optsWrap = document.getElementById('opts');
    const selOpts = {};
    function buildOptions(){
      if(!product.options || typeof product.options!=='object'){ optsWrap.innerHTML=''; return; }
      for(const [k,arr] of Object.entries(product.options)){
        if(!selOpts[k] && Array.isArray(arr) && arr.length){
          selOpts[k] = {value: arr[0].value, priceDelta: Number(arr[0].priceDelta||0)};
        }
      }
      renderOptions();
    }
    function renderOptions(){
      optsWrap.innerHTML = Object.entries(product.options).map(([k,arr])=>{
        const pills = (arr||[]).map(o=>{
          const on = selOpts[k]?.value===o.value;
          const d = Number(o.priceDelta||0);
          return `<button class="pill" role="radio" aria-checked="${on}" data-opt="${k}" data-v="${o.value}" data-d="${d}">
            ${o.value}${d?` (+${EUR(d)})`:''}
          </button>`;
        }).join('');
        return `<div class="opt-row"><strong>${k}</strong><div>${pills}</div></div>`;
      }).join('');
    }
    function totalDelta(){ return Object.values(selOpts).reduce((s,o)=>s + Number(o.priceDelta||0), 0); }
    function updatePrice(){ pPrice.textContent = EUR(base + totalDelta()); }

    optsWrap.addEventListener('click',e=>{
      const b=e.target.closest('.pill'); if(!b) return;
      const opt=b.dataset.opt; const val=b.dataset.v; const d=Number(b.dataset.d||0);
      selOpts[opt] = {value: val, priceDelta: d};
      renderOptions(); updatePrice();
    });

    buildOptions(); updatePrice();

    // Description
    const mkDesc=(product.description||'').split('\n').map(p=>p?`<span>${p}</span>`:'').join('<br>');
    document.getElementById('tab-desc').innerHTML = `<p style="margin-top:0">${mkDesc}</p>
    <ul style="margin:8px 0 0 18px;line-height:1.6">
      <li>Achat simple et sÃ©curisÃ© chez <strong>GF Store</strong> â€” assistance rapide.</li>
      <li>Livraison sous 1 semaine â€¢ Retours 14 jours â€¢ <em>Remboursement garanti</em>.</li>
      <li>Paiement classique et <strong>crypto</strong> acceptÃ©s.</li>
      <li>Garantie <strong>${product.warrantyMonths||24} mois</strong>.</li>
    </ul>`;

    // SpÃ©cifications (gÃ©nÃ©riques)
    const specs=[
      ['Ã‰cran','Haute rÃ©solution, taux de rafraÃ®chissement fluide'],
      ['Photo','Module avancÃ© (ultra grand-angle / zoom)'],
      ['RÃ©seaux','5G, Wi-Fi, Bluetooth'],
      ['Batterie','Longue durÃ©e, charge rapide'],
      ['Stockage', 'Jusquâ€™Ã  1 To selon options'],
      ['SÃ©curitÃ©','DÃ©verrouillage biomÃ©trique'],
      ['Garantie', `${product.warrantyMonths||24} mois chez GF Store`]
    ];
    document.getElementById('specs').innerHTML=specs.map(([k,v])=>`<div style="opacity:.7">${k}</div><div>${v}</div>`).join('');

    // Produits similaires
    const relGrid=document.getElementById('relGrid');
    if(Array.isArray(dataset)){
      const sims=dataset.filter(p=>p.category===product.category && String(p.id)!==String(product.id)).slice(0,4);
      relGrid.innerHTML=sims.map(p=>{
        const simPromo = Number.isFinite(p.promoPrice)&&p.promoPrice>0&&p.promoPrice<p.price;
        const newP=simPromo?p.promoPrice:p.price;
        const simDisc=simPromo?Math.round((1-(newP/p.price))*100):0;
        const url=`./${slugify(p.name)}-${encodeURIComponent(p.id||p.sku||p._id)}.html`;
        const img=(p.imageCover||(p.images&&p.images[0])||'');
        const fixed=fixImg(img);
        return `<article class="card">
          <a class="hit" href="${url}" aria-label="Voir ${p.name}"></a>
          <div class="img"><img loading="lazy" src="${fixed}" alt="${p.name}"></div>
          <div class="box">
            <div style="font-weight:600">${p.name}</div>
            <div style="opacity:.7;font-size:12px">${p.brand||''} â€¢ ${p.category||''}</div>
            <div style="margin-top:6px">${EUR(newP)} ${simPromo?`<span style="opacity:.6;text-decoration:line-through">${EUR(p.price)}</span> <span class="badge">-${simDisc}%</span>`:''}</div>
          </div>
        </article>`;
      }).join('');
    }

    // Ajouter au panier
    document.getElementById('addBtn').addEventListener('click',()=>{
      const parts=[]; for(const [k,v] of Object.entries(selOpts)){ if(v?.value) parts.push(`${k}: ${v.value}`); }
      const nameWithVar = product.name + (parts.length? ` (${parts.join(', ')})` : '');
      const finalPrice  = (promoActive?product.promoPrice:product.price) + totalDelta();

      const cart=getCart();
      const id=String(product.id||product.sku||'');
      const idx=cart.findIndex(x=>x.id===id && x.name===nameWithVar);
      const image=(product.imageCover||(product.images&&product.images[0])||'');
      if(idx>-1){ cart[idx].qty+=1; } else { cart.push({id,name:nameWithVar,price:finalPrice,qty:1,image,brand:product.brand||'',category:product.category||''}); }
      setCart(cart);
      // openCart();
    });

    updateCartCount();

    // ---- Mini-panneau panier
    function cartTotal(){ return getCart().reduce((s,x)=>s + (x.qty * Number(x.price||0)), 0); }
    function renderCart(){
      const wrap=document.getElementById('cartItems'); if(!wrap) return;
      const list=getCart();
      wrap.innerHTML=list.length ? list.map(x=>`
        <div class="ci" data-id="${x.id}">
          <img src="${x.image||''}" alt="${x.name}">
          <div>
            <div style="font-weight:600">${x.name}</div>
            <div style="opacity:.7;font-size:12px">${x.brand||''}${x.category?` â€¢ ${x.category}`:''}</div>
            <div style="margin-top:6px">${EUR(x.price||0)}</div>
          </div>
          <div class="qty">
            <button data-act="dec" aria-label="Diminuer">â€“</button>
            <span>${x.qty}</span>
            <button data-act="inc" aria-label="Augmenter">+</button>
            <button data-act="del" title="Retirer" style="margin-left:6px">
              <img class="ic-sm" src="${ICONS.trash}" alt="Supprimer">
            </button>
          </div>
        </div>`).join('')
      : '<div style="opacity:.7">Votre panier est vide.</div>';
      const totalEl=document.getElementById('cartTotal'); if(totalEl) totalEl.textContent=EUR(cartTotal());
    }
    function openCart(){
      const p=document.getElementById('cartPanel'); if(!p) return;
      renderCart(); p.classList.add('show'); p.setAttribute('aria-hidden','false'); document.body.classList.add('lock');
      const fab=document.getElementById('fabCart'); if(fab){fab.style.display='none'}
    }
    function closeCart(){
      const p=document.getElementById('cartPanel'); if(!p) return;
      p.classList.remove('show'); p.setAttribute('aria-hidden','true'); document.body.classList.remove('lock');
      const fab=document.getElementById('fabCart'); if(fab){fab.style.display=''}
    }
    const fabBtn=document.getElementById('fabCart'); if(fabBtn){ fabBtn.addEventListener('click',(e)=>{ e.preventDefault(); openCart(); }); }
    const hdrCart=document.getElementById('cartBtn'); if(hdrCart){ hdrCart.addEventListener('click',(e)=>{ e.preventDefault(); openCart(); }); }
    const panel=document.getElementById('cartPanel'); if(panel){ panel.addEventListener('click',(e)=>{ if(e.target.id==='cartPanel') closeCart(); }); }
    const closeX=document.getElementById('closeCart'); if(closeX){ closeX.addEventListener('click', closeCart); }

    const itemsBox=document.getElementById('cartItems');
    if(itemsBox){
      itemsBox.addEventListener('click',(e)=>{
        const row=e.target.closest('ci, .ci'); if(!row) return;
        const id=row.getAttribute('data-id');
        const act=e.target.getAttribute('data-act') || e.target.closest('[data-act]')?.getAttribute('data-act');
        if(!act) return;
        if(act==='inc' || act==='dec'){
          const c=getCart(); const it=c.find(x=>x.id===id);
          if(it){ it.qty=Math.max( act==='inc' ? it.qty+1 : it.qty-1 , 1); setCart(c); }
        }
        if(act==='del'){ const c=getCart().filter(x=>x.id!==id); setCart(c); }
      });
    }

    // Tabs
    const tabEls={desc:document.getElementById('tab-desc'), spec:document.getElementById('tab-spec'), rev:document.getElementById('tab-rev')};
    const headEls={desc:document.getElementById('th-desc'), spec:document.getElementById('th-spec'), rev:document.getElementById('th-rev')};
    Object.values(headEls).forEach(h=>h.addEventListener('click',()=>{
      Object.values(headEls).forEach(x=>x.setAttribute('aria-selected','false'));
      h.setAttribute('aria-selected','true');
      Object.values(tabEls).forEach(t=>t.classList.remove('show'));
      const id=h.id.split('-')[1]; document.getElementById('tab-'+id).classList.add('show');
    }));

    // JSON-LD SEO
    const imgsForLd=(product.images&&product.images.length?product.images:[product.imageCover]).map(fixImg).filter(Boolean);
    const ld={"@context":"https://schema.org","@type":"Product","name":product.name,"image":imgsForLd,"sku":product.sku||product.id,"brand":{"@type":"Brand","name":product.brand||'GF Store'},"description":(product.description||'').slice(0,500),"offers":{"@type":"Offer","priceCurrency":"EUR","price":(promoActive?product.promoPrice:product.price),"availability":"https://schema.org/InStock","url":location.href}};
    const s=document.createElement('script'); s.type='application/ld+json'; s.textContent=JSON.stringify(ld); document.head.appendChild(s);

    renderCart(); // init
  })();
  </script>
</body>
</html>
