<!doctype html>
<html lang="fr" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="color-scheme" content="light only" />
  <meta name="description" content="GF Store ‚Äì √âlectronique haut de gamme accessible : PC, consoles, montres connect√©es, √©couteurs, accessoires. Livraison rapide et gratuite, assistance 24/7, paiement s√©curis√©, garantie minimum 1 an." />
  <title>GF Store ‚Äì Premium tech, prix justes</title>
  <style>
    :root{--bg:#0b0f1a;--ink:#0f172a;--muted:#475569;--card:#fff;--ui:#e2e8f0;--brand:#2563eb;--brand-2:#0ea5e9;--radius:14px;--container:1100px}
    *{box-sizing:border-box}html,body{margin:0;padding:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica Neue,Arial;color:var(--ink);background:#f8fafc}
    img{max-width:100%;display:block}a{text-decoration:none;color:inherit}button{cursor:pointer;border:0;background:transparent}
    .wrap{max-width:var(--container);margin:auto;padding:0 1rem}
    .topbar{background:linear-gradient(90deg,var(--bg),#111827);color:#fff;font-size:14px}
    .topbar .row{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;padding:.55rem 0}
    .pill{display:inline-flex;align-items:center;gap:.45rem;padding:.3rem .65rem;border-radius:999px;background:rgba(255,255,255,.08)}

    header.nav{background:#fff;border-bottom:1px solid var(--ui)}
    .nav .row{display:flex;align-items:center;gap:12px;padding:.8rem 0;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:.55rem;font-weight:800}
    .brand .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--brand-2));display:grid;place-items:center;color:#fff}
    .search{display:flex;align-items:center;gap:8px;background:#f1f5f9;border:1px solid #e5e7eb;border-radius:999px;padding:.5rem .8rem;flex:1;min-width:210px}
    .search input{flex:1;border:0;background:transparent;outline:0;font-size:.95rem}
    .nav-actions{display:flex;gap:8px;align-items:center;margin-left:auto}
    .icon-btn{display:grid;place-items:center;width:40px;height:40px;border-radius:10px;background:#f1f5f9}
    .icon-btn .badge{position:absolute;transform:translate(12px,-12px);background:#111827;color:#fff;border-radius:999px;font-size:.7rem;padding:.1rem .35rem}

    .hero{background:linear-gradient(180deg,#ffffff 0%,#f6fafe 100%)}
    .hero .row{display:grid;grid-template-columns:1.2fr .8fr;gap:20px;padding:1.8rem 0}
    .hero h1{font-size:clamp(1.4rem,3vw,2.2rem);line-height:1.15;margin:.2rem 0 .6rem}
    .hero p{color:var(--muted);font-size:clamp(.96rem,1.25vw,1.05rem);margin:.2rem 0 1rem}
    .cta{display:flex;gap:10px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:.55rem;padding:.7rem 1rem;border-radius:12px;font-weight:700}
    .btn.primary{background:#111827;color:#fff}
    .btn.secondary{background:#fff;color:#111827;border:1px solid #e5e7eb}
    .hero-card{background:#fff;border:1px solid var(--ui);padding:1rem;border-radius:var(--radius)}

    .toolbar{background:#fff;border-top:1px solid var(--ui);border-bottom:1px solid var(--ui)}
    .toolbar .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;padding:.6rem 0}
    .chip{display:inline-flex;align-items:center;gap:.4rem;padding:.45rem .7rem;border-radius:999px;border:1px solid var(--ui);background:#fff}
    .chip[aria-pressed="true"]{background:#eef2ff;border-color:#c7d2fe}
    .select{display:flex;align-items:center;gap:.5rem;border:1px solid var(--ui);padding:.45rem .65rem;border-radius:10px;background:#fff}
    .price-range{display:flex;align-items:center;gap:.6rem;margin-left:auto}

    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;padding:1rem 0}
    .card{background:#fff;border:1px solid #e9eef5;border-radius:16px;overflow:hidden;display:flex;flex-direction:column;transition:transform .15s ease}
    .card:hover{transform:translateY(-2px)}
    .media{aspect-ratio:1/1;background:#f8fafc;display:grid;place-items:center;border-bottom:1px solid #eef2f7}
    .content{padding:.85rem}
    .badge-row{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:.45rem}
    .badge{font-size:.72rem;padding:.2rem .45rem;border-radius:999px;border:1px solid var(--ui);background:#fff}
    .badge.success{background:#ecfdf5;border-color:#bbf7d0;color:#047857}
    .badge.promo{background:#fffbeb;border-color:#fde68a;color:#854d0e}
    .badge.low{background:#fef2f2;border-color:#fecaca;color:#991b1b}
    .title{font-size:1rem;font-weight:700;margin:.1rem 0 .25rem;min-height:2.6em}
    .brand-line{color:var(--muted);font-size:.9rem}
    .rating{display:flex;align-items:center;gap:6px;color:#334155;font-size:.86rem;margin:.3rem 0}
    .price{display:flex;align-items:baseline;gap:8px}
    .price .now{font-size:1.08rem;font-weight:800}
    .price .old{text-decoration:line-through;color:var(--muted)}
    .actions{margin-top:.7rem;display:grid;grid-template-columns:1fr 1fr;gap:8px}

    .drawer{position:fixed;inset:auto 0 0 auto;width:min(420px,100%);background:#fff;box-shadow:0 18px 60px rgba(2,6,23,.18);transform:translateY(100%);transition:transform .25s ease;z-index:60;display:flex;flex-direction:column;border-top-left-radius:16px;border-top-right-radius:16px}
    .drawer.open{transform:translateY(0)}
    .drawer .head{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid var(--ui)}
    .drawer .items{flex:1;overflow:auto;padding:1rem;display:flex;flex-direction:column;gap:10px}
    .cart-item{display:grid;grid-template-columns:64px 1fr auto;gap:10px;border:1px solid var(--ui);border-radius:12px;padding:.6rem}
    .qty{display:inline-flex;align-items:center;border:1px solid var(--ui);border-radius:10px}
    .qty button{width:30px;height:30px}.qty input{width:40px;border:0;text-align:center}
    .summary{padding:1rem;border-top:1px solid var(--ui);display:grid;gap:8px}
    .row{display:flex;justify-content:space-between}

    .mini-cart{position:fixed;left:50%;transform:translateX(-50%);bottom:14px;background:#111827;color:#fff;border-radius:999px;padding:.5rem .9rem;display:flex;align-items:center;gap:10px;z-index:50}

    footer{background:#0b0f1a;color:#cbd5e1;margin-top:1.4rem}
    footer .grid{display:grid;grid-template-columns:2fr 1fr 1fr;gap:20px}
    footer h4{margin:.4rem 0 1rem;color:#fff}
    .credits{border-top:1px solid #1e293b;padding:1rem;text-align:center;color:#94a3b8}

    /* Page produit simple */
    #productPage{display:none;padding:1rem 0}
    #productPage.active{display:block}
    #listPage.hidden{display:none}
    .prod-layout{display:grid;grid-template-columns:1fr 1fr;gap:20px}

    @media (max-width:1024px){.grid{grid-template-columns:repeat(3,1fr)}.hero .row{grid-template-columns:1fr}.prod-layout{grid-template-columns:1fr}}
    @media (max-width:720px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:420px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="topbar" role="region" aria-label="Promotions temporis√©es">
    <div class="wrap"><div class="row">
      <span class="pill">üöö Livraison gratuite <strong>< 7 jours</strong></span>
      <span class="pill">üí¨ Assistance <strong>24/7</strong></span>
      <span class="pill">üîê Paiement <strong>s√©curis√©</strong></span>
      <span class="pill">üî• Offres flash <span class="counter" id="promoCounter">00:00:00</span></span>
    </div></div>
  </div>

  <header class="nav" role="banner">
    <div class="wrap"><div class="row">
      <a class="brand" href="./" aria-label="GF Store ‚Äì Accueil"><span class="logo" aria-hidden="true">GF</span><span>GF Store</span></a>
      <label class="search" aria-label="Recherche de produits">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.3-4.3" stroke="#334155" stroke-width="2" stroke-linecap="round"/><circle cx="11" cy="11" r="7" stroke="#334155" stroke-width="2"/></svg>
        <input id="q" type="search" placeholder="Rechercher (ex. iPhone, PC, PS5)" autocomplete="off" inputmode="search" />
      </label>
      <div class="nav-actions">
        <button class="icon-btn" id="openCart" aria-label="Ouvrir le panier" style="position:relative">
          <img alt="Panier" width="22" height="22" src="https://img.icons8.com/?size=22&id=AaWM1DnCz2bQ&format=png"/>
          <span class="badge" id="cartCount">0</span>
        </button>
      </div>
    </div></div>
  </header>

  <section class="hero">
    <div class="wrap"><div class="row">
      <div>
        <h1>La tech <span style="color:var(--brand)">premium</span>, livr√©e vite. üéØ</h1>
        <p>PC, consoles, montres connect√©es, √©couteurs et accessoires. Des prix justes, la <strong>livraison gratuite</strong> < 7 jours, une <strong>assistance 24/7</strong> et un <strong>paiement s√©curis√©</strong>.</p>
        <div class="cta">
          <a href="#produits" class="btn primary" id="ctaNew">Nouveaut√©s</a>
          <a href="#promos" class="btn secondary" id="ctaPromo">Promos</a>
        </div>
      </div>
      <div class="hero-card" aria-hidden="true">
        <img src="https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?q=80&w=1200&auto=format&fit=crop" alt="S√©lection de produits high-tech" style="border-radius:12px" />
        <div style="display:flex;gap:8px;margin-top:10px;align-items:center;justify-content:space-between">
          <div style="display:flex;gap:8px;align-items:center;color:#334155"><span class="badge success">Garantie min. 12 mois</span><span class="badge">Retours 14 j</span></div>
          <div style="display:flex;gap:8px;align-items:center"><img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Visa.svg" alt="Visa" width="40" height="14"><img src="https://upload.wikimedia.org/wikipedia/commons/2/2a/Mastercard-logo.svg" alt="Mastercard" width="36" height="22"><img src="https://upload.wikimedia.org/wikipedia/commons/3/39/PayPal_logo.svg" alt="PayPal" width="56" height="16"></div>
        </div>
      </div>
    </div></div>
  </section>

  <div class="toolbar" role="region" aria-label="Filtres et tri">
    <div class="wrap"><div class="row">
      <button class="chip" id="filterAll" aria-pressed="true">Tous</button>
      <button class="chip" id="filterPromo" aria-pressed="false">Promos</button>
      <div id="categoryChips" style="display:flex;gap:8px;flex-wrap:wrap"></div>
      <div class="select" title="Tri"><label for="sort">Trier</label>
        <select id="sort" aria-label="Trier les produits">
          <option value="featured">Recommand√©s</option><option value="new">Nouveaut√©s</option>
          <option value="priceAsc">Prix : croissant</option><option value="priceDesc">Prix : d√©croissant</option>
          <option value="rating">Mieux not√©s</option>
        </select>
      </div>
      <div class="select" title="Marques"><label for="brand">Marque</label>
        <select id="brand" aria-label="Filtrer par marque"><option value="">Toutes</option></select>
      </div>
      <div class="price-range"><label for="price">Prix max</label>
        <input type="range" id="price" min="0" max="3000" step="10" value="3000" />
        <span id="priceValue">3000‚Ç¨</span>
      </div>
      <div class="row" style="margin-left:auto;color:#334155;font-size:.9rem"><span id="resultCount"></span></div>
    </div></div>
  </div>

  <!-- LISTE PRODUITS -->
  <main id="listPage" aria-live="polite">
    <div class="wrap">
      <section id="produits" class="grid" aria-busy="true"></section>
    </div>
  </main>

  <!-- PAGE PRODUIT (rendue dynamiquement) -->
  <section id="productPage" class="wrap">
    <nav style="margin:.8rem 0">
      <a href="./" id="backToList" class="chip">‚Üê Retour √† la boutique</a>
    </nav>
    <div id="prodZone" class="prod-layout"></div>
  </section>

  <!-- PANIER -->
  <aside class="drawer" id="cartDrawer" aria-hidden="true" aria-label="Panier">
    <div class="head"><strong>Votre panier</strong><button id="closeCart" aria-label="Fermer le panier">‚úï</button></div>
    <div class="items" id="cartItems"></div>
    <div class="summary">
      <div class="row"><span>Sous-total</span><strong id="subTotal">0‚Ç¨</strong></div>
      <div class="row"><span>Livraison</span><strong style="color:#10b981">Gratuite</strong></div>
    </div>
    <div style="padding:1rem;display:grid;gap:10px">
      <button class="btn primary" id="checkoutBtn"><img class="ico" width="18" height="18" alt="Payer" src="https://img.icons8.com/?size=18&id=qVsd2YOgeizO&format=png"/> Payer en toute s√©curit√©</button>
      <div style="color:var(--muted);font-size:.9rem">üîê Paiement 3‚ÄëD Secure, Visa/Mastercard/PayPal. Donn√©es chiffr√©es TLS.</div>
    </div>
  </aside>

  <div class="mini-cart" id="miniCart" role="button" aria-label="Ouvrir le panier" style="display:none">
    üõí <strong id="miniCartCount">0</strong> ‚Äî <span id="miniCartTotal">0‚Ç¨</span>
  </div>

  <footer>
    <div class="wrap">
      <div class="grid" style="padding:1.2rem 0">
        <div>
          <h4>GF Store</h4>
          <p>Votre destination pour la technologie <em>haut de gamme accessible</em>. Livraison gratuite < 7 jours, support 24/7, garantie minimum 1 an, paiement s√©curis√©.</p>
        </div>
        <div>
          <h4>Service client</h4>
          <ul style="list-style:none;padding:0;margin:0;display:grid;gap:8px">
            <li>üìû <a href="tel:+22900000000">+229 00 00 00 00</a></li>
            <li>‚úâÔ∏è <a href="mailto:support@gfstore.example">support@gfstore.example</a></li>
          </ul>
        </div>
        <div>
          <h4>Informations</h4>
          <ul style="list-style:none;padding:0;margin:0;display:grid;gap:8px">
            <li><a href="#">CGV & retours</a></li>
            <li><a href="#">Livraison</a></li>
            <li><a href="#">Garanties</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="credits">¬© <span id="year"></span> GF Store. Tous droits r√©serv√©s.</div>
  </footer>

  <script>
  // ‚Äî‚Äî‚Äî‚Äî‚Äî Utilitaires & √©tat ‚Äî‚Äî‚Äî‚Äî‚Äî
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const h = (t,a={},...kids)=>{const e=document.createElement(t);for(const[k,v]of Object.entries(a)){
    if(k==='class') e.className=v; else if(k==='html') e.innerHTML=v; else if(k.startsWith('on')) e.addEventListener(k.slice(2),v); else e.setAttribute(k,v)}
    kids.flat().filter(Boolean).forEach(k=>e.append(k.nodeType? k: document.createTextNode(k)));return e}

  const ICONS = { buy:'https://img.icons8.com/?size=100&id=ditUhfRlUOQg&format=png&color=000000', cart:'https://img.icons8.com/?size=100&id=AaWM1DnCz2bQ&format=png&color=000000', cartFull:'https://img.icons8.com/?size=100&id=K5Jv3BfpxPYa&format=png&color=000000', checkout:'https://img.icons8.com/?size=100&id=qVsd2YOgeizO&format=png&color=000000', truck:'https://img.icons8.com/?size=100&id=plGFB4oatud2&format=png&color=000000', logout:'https://img.icons8.com/?size=100&id=IKneRwT2PRjz&format=png&color=000000', user:'https://img.icons8.com/?size=100&id=n8DrUm77sR3l&format=png&color=000000'};

  const state = {
    all: [], view: [],
    filters: { q:"", cat:"", brand:"", priceMax: 3000, promo:false },
    sort: "featured",
    cart: JSON.parse(localStorage.getItem("gf_cart_v2") || "[]"),
  };

  const money = n => new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'}).format(n||0);
  const pct = (a,b) => b? Math.max(0, 100-Math.round((a/b)*100)) : 0;
  const toSlug = s => (s||'prod').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

  // ‚Äî‚Äî‚Äî‚Äî‚Äî Donn√©es ‚Äî‚Äî‚Äî‚Äî‚Äî
  async function loadProducts(){
    const override=new URLSearchParams(location.search).get('data');
    const C=[override,'data/products.json','data/produits.json','/data/products.json','/data/produits.json','products.json','produits.json'].filter(Boolean);
    for(const url of C){ try{ const r=await fetch(url,{cache:'no-store'}); if(!r.ok) continue; const j=await r.json(); const arr = Array.isArray(j)? j : (j.products||j.items||j.data); if(Array.isArray(arr)){ state.all=arr; document.body.dataset.productsSource=url; return } }catch(e){} }
    // Fallback : d√©mo minimale si aucun JSON trouv√©
    state.all=[{sku:'DEMO-1',name:'Casque Bluetooth Pro',category:'Audio',brand:'GF',price:129, promoPrice:99, rating:4.6, stock:8, images:['https://images.unsplash.com/photo-1518444075434-686b2c70a766?q=80&w=1200&auto=format&fit=crop'], createdAt:Date.now()}, {sku:'DEMO-2',name:'Montre Connect√©e X',category:'Wearables',brand:'GF',price:199,rating:4.3,stock:12, images:['https://images.unsplash.com/photo-1518085250887-2f903c200fee?q=80&w=1200&auto=format&fit=crop'], createdAt:Date.now()}];
  }

  // ‚Äî‚Äî‚Äî‚Äî‚Äî Rendu liste ‚Äî‚Äî‚Äî‚Äî‚Äî
  function hydrateFilters(){
    const cats=[...new Set(state.all.map(p=>p.category).filter(Boolean))].sort();
    const brands=[...new Set(state.all.map(p=>p.brand).filter(Boolean))].sort();

    const zone=$('#categoryChips'); zone.innerHTML='';
    cats.forEach(c=>{
      const count=state.all.filter(p=>p.category===c).length;
      zone.append(h('button',{class:'chip',role:'button','aria-pressed':'false',onClick:()=>{ $$('#categoryChips .chip').forEach(x=>x.setAttribute('aria-pressed','false')); $('#filterAll').setAttribute('aria-pressed','false'); $('#filterPromo').setAttribute('aria-pressed','false'); event.currentTarget.setAttribute('aria-pressed','true'); state.filters.cat=c; state.filters.promo=false; applyFilters(); }},`${c} (${count})`));
    });

    $('#filterAll').onclick=()=>{ state.filters.cat=''; state.filters.promo=false; $$('#categoryChips .chip').forEach(x=>x.setAttribute('aria-pressed','false')); $('#filterAll').setAttribute('aria-pressed','true'); $('#filterPromo').setAttribute('aria-pressed','false'); applyFilters(); }
    $('#filterPromo').onclick=()=>{ state.filters.cat=''; state.filters.promo=true; $$('#categoryChips .chip').forEach(x=>x.setAttribute('aria-pressed','false')); $('#filterAll').setAttribute('aria-pressed','false'); $('#filterPromo').setAttribute('aria-pressed','true'); applyFilters(); }

    const sel=$('#brand'); sel.innerHTML='<option value="">Toutes</option>'+brands.map(b=>`<option>${b}</option>`).join('');
  }

  function applyFilters(){
    const q=state.filters.q.trim().toLowerCase();
    const {cat,brand,priceMax,promo}=state.filters;
    let items=state.all.filter(p=>{
      const inQ=!q||(`${p.name||''} ${p.description||''} ${p.brand||''} ${p.model||''}`).toLowerCase().includes(q);
      const inCat=!cat||p.category===cat; const inBrand=!brand||p.brand===brand;
      const price=+ (p.promoPrice??p.price??0); const inPrice=price<=priceMax;
      const inPromo=!promo || (p.promoPrice && +p.promoPrice < + (p.price||0));
      return inQ&&inCat&&inBrand&&inPrice&&inPromo;
    });

    items.sort((a,b)=>{const pa=+(a.promoPrice??a.price??0), pb=+(b.promoPrice??b.price??0);
      switch(state.sort){case 'priceAsc':return pa-pb;case 'priceDesc':return pb-pa;case 'rating':return (b.rating||0)-(a.rating||0);case 'new':return new Date(b.createdAt||0)-new Date(a.createdAt||0);default:return featuredScore(b)-featuredScore(a);}});

    state.view=items; renderBrandCounts(); renderGrid(); $('#resultCount').textContent=`${items.length} produit${items.length>1?'s':''}`;
  }

  function featuredScore(p){ const now=Date.now(); const price=+(p.promoPrice??p.price??0); return 0 + (p.promoPrice&&+(p.promoPrice)<+(p.price||0)?40:0) + (+(p.rating||0)*6) + (p.stock>0?8:-50) + Math.max(0,20-Math.min(20,(now-new Date(p.createdAt||0))/864e5)) - price/1000 }

  function renderBrandCounts(){ const {cat,promo}=state.filters; const brands=[...new Set(state.all.map(p=>p.brand).filter(Boolean))].sort(); const sel=$('#brand'); const opts=['<option value="">Toutes</option>']; brands.forEach(b=>{ const count=state.all.filter(p=>(!cat||p.category===cat)&&(!promo||(p.promoPrice&&+p.promoPrice<+(p.price||0)))&&p.brand===b).length; opts.push(`<option ${state.filters.brand===b?'selected':''}>${b} (${count})</option>`); }); sel.innerHTML=opts.join(''); }

  function renderGrid(){ const grid=$('#produits'); grid.innerHTML=''; if(!state.view.length){ grid.append(h('div',{class:'card'},h('div',{class:'content'},h('h3',{html:'Aucun produit trouv√©'}),h('div',{class:'brand-line',html:"Essayez d'√©largir les filtres ou supprimez la recherche."}))); return }
    for(const p of state.view){ grid.append(renderCard(p)) }
    grid.setAttribute('aria-busy','false');
  }

  function starRow(n=0){ const full=Math.round(n*2)/2; const box=h('span',{ariaLabel:`${(+n).toFixed(1)} sur 5`}); for(let i=1;i<=5;i++){ const t=i<=Math.floor(full)?'‚òÖ':(i-0.5===full?'‚òÜ':'‚ú©'); box.append(h('span',{html:`<span style="font-weight:900">${t}</span>`})) } return box }

  function cardBadges(p){ const row=h('div',{class:'badge-row'}); const price=+(p.promoPrice??p.price??0); const hasPromo=p.promoPrice && +p.promoPrice < +(p.price||0); if(hasPromo) row.append(h('span',{class:'badge promo'},`-${pct(price,+(p.price||0))}%`)); row.append(h('span',{class:'badge success'},'Livraison gratuite')); if(p.stock!=null&&p.stock<=5) row.append(h('span',{class:'badge low'},'Stock bas')); return row }

  function renderCard(p){
    const price=+(p.promoPrice??p.price??0); const hasPromo=p.promoPrice && +p.promoPrice < +(p.price||0); const placeholder='https://images.unsplash.com/photo-1510557880182-3f8c5f7b4a49?q=80&w=800&auto=format&fit=crop';
    const imgSrc=p.imageCover || (p.images&&p.images[0]) || placeholder; const slug=toSlug(p.name||p.sku||'prod');
    const card=h('article',{class:'card'});
    const media=h('div',{class:'media'}, h('img',{loading:'lazy',alt:p.name||'Produit',src:imgSrc,onError:e=>{e.target.src=placeholder}}));
    const content=h('div',{class:'content'});
    content.append(cardBadges(p));
    content.append(h('div',{class:'title'},p.name||'Produit'));
    content.append(h('div',{class:'brand-line'},`${p.brand||''} ‚Ä¢ ${p.category||''}`));
    content.append(h('div',{class:'rating'}, starRow(p.rating||0), h('span',{},(+(p.rating||0)).toFixed(1)) ));
    const pr=h('div',{class:'price'}, h('div',{class:'now'},money(price)), hasPromo? h('div',{class:'old'},money(+(p.price||0))) : null );
    const actions=h('div',{class:'actions'});
    // VOIR ‚Äî vers page produit (slug.html affich√©, rendu SPA pour compatibilit√©)
    const aVoir=h('a',{class:'btn secondary',href:`${slug}.html`,'data-slug':slug,'data-sku':p.sku||''}, 'Voir');
    // AJOUTER ‚Äî direct
    const aAdd=h('button',{class:'btn primary',onClick:()=>{ addToCart(p,1); toast('Ajout√© au panier üõí'); }}, h('img',{alt:'Ajouter',width:18,height:18,src:ICONS.buy}), ' Ajouter');
    actions.append(aVoir,aAdd);

    content.append(pr,actions);
    card.append(media,content); return card;
  }

  // ‚Äî‚Äî‚Äî‚Äî‚Äî Page produit (SPA) ‚Äî‚Äî‚Äî‚Äî‚Äî
  function renderProductPage(prod){ if(!prod){ showList(); return }
    $('#listPage').classList.add('hidden'); $('#productPage').classList.add('active');
    const price=+(prod.promoPrice??prod.price??0); const hasPromo=prod.promoPrice && +prod.promoPrice < +(prod.price||0);
    const imgs=(prod.images&&prod.images.length?prod.images:[prod.imageCover]).filter(Boolean);
    const zone=$('#prodZone'); zone.innerHTML='';
    const gal=h('div',{}, imgs.length? h('img',{alt:prod.name||'Produit',src:imgs[0],style:'border-radius:12px'}) : null,
      imgs.length>1? h('div',{style:'display:flex;gap:6px;margin-top:8px;flex-wrap:wrap'}, ...imgs.map((src,i)=> h('img',{src,alt:`${prod.name||'Produit'} ${i+1}`,style:'width:72px;height:72px;object-fit:cover;border-radius:8px;opacity:.85;cursor:pointer',onClick:()=>{ zone.querySelector('img[alt="'+(prod.name||'Produit')+'"]').src=src }}) )) : null );

    const meta=h('div',{}, h('h2',{},prod.name||'Produit'), h('div',{class:'brand-line'},`${prod.brand||''} ‚Ä¢ ${prod.category||''}`), h('div',{class:'rating'}, starRow(prod.rating||0), h('span',{}, (+(prod.rating||0)).toFixed(1)) ),
      h('div',{class:'price'}, h('div',{class:'now'}, money(price)), hasPromo? h('div',{class:'old'}, money(+(prod.price||0))) : null ),
      h('div',{style:'display:flex;gap:8px;margin:.8rem 0'},
        h('button',{class:'btn primary',onClick:()=>{ addToCart(prod,1); toast('Ajout√© au panier üõí'); }}, h('img',{alt:'Ajouter',width:18,height:18,src:ICONS.cart}), ' Ajouter au panier'),
        h('button',{class:'btn secondary',onClick:()=>{ openDrawer(true) }}, h('img',{alt:'Panier',width:18,height:18,src:ICONS.checkout}), ' Voir le panier')
      ),
      h('p',{class:'brand-line',html:'‚úÖ Garantie 12 mois ‚Ä¢ üöö Livraison < 7 jours ‚Ä¢ üîê Paiement s√©curis√©'})
    );

    zone.append(h('div',{class:'prod-layout'}, gal, meta));
  }

  function showList(){ $('#productPage').classList.remove('active'); $('#listPage').classList.remove('hidden'); }

  // ‚Äî‚Äî‚Äî‚Äî‚Äî Panier ‚Äî‚Äî‚Äî‚Äî‚Äî
  function persistCart(){ localStorage.setItem('gf_cart_v2', JSON.stringify(state.cart)); }
  function addToCart(p,qty=1){ const id=(p.sku||toSlug(p.name)||'itm'); const it=state.cart.find(i=>i.id===id); const price=+(p.promoPrice??p.price??0); if(it) it.qty+=qty; else state.cart.push({id,sku:p.sku||'',name:p.name||'Produit',image:(p.imageCover||(p.images&&p.images[0]))||'',price,qty}); renderCart(); persistCart(); }
  function removeFromCart(id){ state.cart=state.cart.filter(i=>i.id!==id); renderCart(); persistCart(); }
  function changeQty(id,q){ const it=state.cart.find(i=>i.id===id); if(!it) return; it.qty=Math.max(1,q); renderCart(); persistCart(); }
  function renderCart(){ const zone=$('#cartItems'); zone.innerHTML=''; let sub=0,count=0; const ph='https://images.unsplash.com/photo-1510557880182-3f8c5f7b4a49?q=80&w=800&auto=format&fit=crop';
    for(const it of state.cart){ sub += (+it.price||0) * (+it.qty||1); count += (+it.qty||0);
      const row=h('div',{class:'cart-item'}, h('img',{src:it.image||ph,alt:it.name||'Produit',loading:'lazy',onError:e=>{e.target.src=ph}}),
        h('div',{}, h('div',{class:'title'},it.name||'Produit'), h('div',{class:'brand-line'},it.sku||'') ),
        h('div',{style:'display:flex;flex-direction:column;gap:6px;align-items:end'}, h('div',{class:'now'},money(+it.price||0)),
          h('label',{class:'qty'}, h('button',{onClick:()=>changeQty(it.id,(+it.qty||1)-1)},'‚àí'), h('input',{type:'number',value:it.qty,min:'1',onChange:e=>changeQty(it.id,+e.target.value||1)}), h('button',{onClick:()=>changeQty(it.id,(+it.qty||1)+1)},'+') ),
          h('button',{class:'chip',onClick:()=>removeFromCart(it.id)},'Retirer') )
      ); zone.append(row); }
    $('#subTotal').textContent=money(sub); $('#cartCount').textContent=count; $('#miniCartCount').textContent=count; $('#miniCartTotal').textContent=money(sub); $('#miniCart').style.display=count? 'flex':'none'; }

  // ‚Äî‚Äî‚Äî‚Äî‚Äî Routing ("Voir" -> slug.html mais SPA) ‚Äî‚Äî‚Äî‚Äî‚Äî
  function navigateToSlug(slug, push=true){ const prod = state.all.find(p=>toSlug(p.name||p.sku||'')===slug||(p.sku||'').toLowerCase()===slug); if(push) history.pushState({slug},'', `${slug}.html`); renderProductPage(prod); }
  function detectInitialRoute(){ const qp=new URLSearchParams(location.search).get('p'); if(qp){ navigateToSlug(qp,false); return }
    const m=location.pathname.match(/([^\/]+)\.html$/); if(m && !/index\.html$/.test(m[0])){ navigateToSlug(m[1],false) } }
  window.addEventListener('popstate',()=>{ const m=location.pathname.match(/([^\/]+)\.html$/); if(m && !/index\.html$/.test(m[0])) navigateToSlug(m[1],false); else showList(); });

  // ‚Äî‚Äî‚Äî‚Äî‚Äî Divers ‚Äî‚Äî‚Äî‚Äî‚Äî
  function toast(msg){ clearTimeout(toast._t); let t=$('#toast'); if(!t){ t=h('div',{id:'toast',style:'position:fixed;bottom:22px;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:.55rem 1rem;border-radius:999px;z-index:80'}); document.body.append(t) } t.textContent=msg; t.style.opacity='1'; toast._t=setTimeout(()=>t.style.opacity='0',1600) }
  function startCountdown(){ const end=new Date(); end.setHours(23,59,59,999); const tick=()=>{ const d=Math.max(0,end-new Date()); const h=String(Math.floor(d/3.6e6)).padStart(2,'0'); const m=String(Math.floor(d%3.6e6/6e4)).padStart(2,'0'); const s=String(Math.floor(d%6e4/1e3)).padStart(2,'0'); $('#promoCounter').textContent=`${h}:${m}:${s}` }; tick(); setInterval(tick,1000) }
  function openDrawer(v){ const d=$('#cartDrawer'); if(v){ d.classList.add('open'); d.setAttribute('aria-hidden','false') } else { d.classList.remove('open'); d.setAttribute('aria-hidden','true') } }

  // ‚Äî‚Äî‚Äî‚Äî‚Äî Events ‚Äî‚Äî‚Äî‚Äî‚Äî
  $('#q').addEventListener('input', (e)=>{ state.filters.q=e.target.value; applyFilters() });
  $('#brand').addEventListener('change', (e)=>{ state.filters.brand=e.target.value.replace(/ \(.*/,''); applyFilters() });
  $('#sort').addEventListener('change', (e)=>{ state.sort=e.target.value; applyFilters() });
  $('#price').addEventListener('input', (e)=>{ state.filters.priceMax=+e.target.value; $('#priceValue').textContent = state.filters.priceMax + '‚Ç¨'; applyFilters() });
  $('#filterAll').addEventListener('click',()=>{ $('#brand').value=''; state.filters.brand=''; applyFilters() });
  $('#ctaNew').addEventListener('click',()=>{ state.sort='new'; $('#sort').value='new'; applyFilters() });
  $('#ctaPromo').addEventListener('click',(e)=>{ e.preventDefault(); state.filters.promo=true; $('#filterAll').setAttribute('aria-pressed','false'); $('#filterPromo').setAttribute('aria-pressed','true'); applyFilters(); document.getElementById('produits').scrollIntoView({behavior:'smooth'}) });

  $('#openCart').onclick=()=>openDrawer(true);
  $('#closeCart').onclick=()=>openDrawer(false);
  $('#miniCart').onclick=()=>openDrawer(true);
  $('#checkoutBtn').onclick=()=>{ if(!state.cart.length){ toast('Votre panier est vide üòø'); return } const order={ id:'GF-'+Math.random().toString(36).slice(2,8).toUpperCase(), ts:Date.now(), items:state.cart, amount: $('#miniCartTotal').textContent }; localStorage.setItem('gf_last_order', JSON.stringify(order)); state.cart=[]; persistCart(); renderCart(); openDrawer(false); toast('‚úÖ Commande '+order.id+' confirm√©e ! (d√©mo)') };
  $('#backToList').addEventListener('click', (e)=>{ e.preventDefault(); history.pushState({},'', './'); showList() });

  // Intercepter les clics "Voir" pour rendre la page produit en SPA et afficher slug.html
  document.addEventListener('click', (e)=>{ const a=e.target.closest('a[data-slug]'); if(a){ e.preventDefault(); navigateToSlug(a.dataset.slug,true) } });

  // ‚Äî‚Äî‚Äî‚Äî‚Äî Bootstrap ‚Äî‚Äî‚Äî‚Äî‚Äî
  (async function init(){ startCountdown(); await loadProducts(); hydrateFilters(); state.filters.priceMax = +$('#price').value; $('#priceValue').textContent = state.filters.priceMax + '‚Ç¨'; applyFilters(); renderCart(); $('#year').textContent = new Date().getFullYear(); detectInitialRoute();})();

  </script>
</body>
</html>
